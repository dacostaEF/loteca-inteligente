<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raio-X da Loteca - Planilha dos Clubes de Futebol</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 15px;
            right: 20px;
            height: 60px;
            width: auto;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .tab {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .tab.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .tab.serie-a {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
        }

        .tab.serie-b {
            background: linear-gradient(135deg, #ffd700, #ffb347);
        }

        .export-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .export-btn {
            background: linear-gradient(135deg, #48c6ef, #6f86d6);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(72, 198, 239, 0.4);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 198, 239, 0.6);
        }

        .export-btn.serie-a {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
        }

        .export-btn.serie-b {
            background: linear-gradient(135deg, #ffd700, #ffb347);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            text-align: center;
        }

        .info-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .info-box.blue {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
        }

        .info-box.yellow {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #333;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .table-container.serie-b-scroll {
            max-height: 500px;
            overflow-y: scroll;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.9rem;
        }

        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        table.serie-a th {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
        }

        table.serie-b th {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #333;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
        }

        tr:hover {
            background-color: #f8f9ff;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:nth-child(even):hover {
            background-color: #f0f4ff;
        }

        .editable {
            background: rgba(72, 198, 239, 0.15) !important;
            border: 1px solid #48c6ef !important;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: text;
            min-height: 20px;
            position: relative;
        }

        .locked {
            background: rgba(239, 68, 68, 0.15) !important;
            border: 1px solid #ef4444 !important;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: not-allowed;
            color: #fca5a5 !important;
            position: relative;
        }

        .cell-lock {
            position: absolute;
            right: 2px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 12px;
            color: #00E38C;
            background: rgba(0, 0, 0, 0.8);
            padding: 3px 5px;
            border-radius: 3px;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid #00E38C;
            min-width: 20px;
            text-align: center;
        }

        .cell-lock.locked {
            color: #ef4444;
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
        }

        .cell-lock:hover {
            background: rgba(0, 0, 0, 0.95);
            transform: translateY(-50%) scale(1.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .cell-lock.locked:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        .edit-btn {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #5a2d91;
            transform: scale(1.05);
        }

        .save-btn {
            background: linear-gradient(135deg, #48c6ef, #6f86d6);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(72, 198, 239, 0.4);
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 198, 239, 0.6);
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 2px solid #e0e0e0;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .tabs {
                flex-direction: column;
                align-items: center;
            }

            .tab {
                margin-bottom: 10px;
                width: 80%;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 8px 5px;
            }

            .logo {
                height: 40px;
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="../../static/Logo_loteraisinteligente.png" alt="Logo Loterias Inteligente - Visite nosso site" class="logo">
            <h1>Raio-X da Loteca</h1>
            <p>Planilha dos Clubes de Futebol<br>
            Dados atualizados - Observat√≥rio do Futebol e Transfermarkt</p>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('top100', event)">
                Top 100 Clubes Mais Valiosos
            </button>
            <button class="tab" onclick="showTab('serieA', event)">
                S√©rie A Brasileir√£o
            </button>
            <button class="tab" onclick="showTab('serieB', event)">
                S√©rie B Brasileir√£o
            </button>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <button class="export-btn" id="exportBtn" onclick="exportCurrentTab()">
                üì• Baixar Dados (CSV)
            </button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Top 100 Tab -->
            <div id="top100" class="tab-content active">
                <h2>Top 100 Clubes Mais Valiosos do Mundo
                    <span style="font-size: 0.8rem; color: #6b7280; margin-left: 10px;">(Observat√≥rio do Futebol - 17/09/2025)</span>
                </h2>
                <div class="table-container">
                    <table id="top100Table">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>Clube</th>
                                <th>Pa√≠s</th>
                                <th>Valor de Mercado</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="top100Body">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- S√©rie A Tab -->
            <div id="serieA" class="tab-content">
                <h2>S√©rie A do Campeonato Brasileiro
                    <span style="font-size: 0.8rem; color: #6b7280; margin-left: 10px;">(Transfermarkt - Valores em Euros)</span>
                </h2>
                <div class="info-box blue">
                    <p><strong>Resumo:</strong> 658 jogadores, idade m√©dia de 27.6 anos, 154 estrangeiros, valor m√©dio de ‚Ç¨ 2.76 mi. por jogador</p>
                    <p style="margin-top: 5px;"><strong>Valor total:</strong> ‚Ç¨ 1.82 bilh√µes</p>
                </div>
                <div class="table-container">
                    <table id="serieATable" class="serie-a">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>Clube</th>
                                <th>Plantel</th>
                                <th>Idade M√©dia</th>
                                <th>Estrangeiros</th>
                                <th>Valor M√©dio</th>
                                <th>Valor Total</th>
                                <th>Posse Bola (%)</th>
                                <th>Passes Certos</th>
                                <th>Chutes/Jogo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="serieABody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- S√©rie B Tab -->
            <div id="serieB" class="tab-content">
                <h2>S√©rie B do Campeonato Brasileiro
                    <span style="font-size: 0.8rem; color: #6b7280; margin-left: 10px;">(Transfermarkt - Valores em Euros)</span>
                </h2>
                <div class="info-box yellow">
                    <p><strong>Resumo:</strong> 714 jogadores, idade m√©dia de 27.7 anos, 72 estrangeiros, valor m√©dio de ‚Ç¨ 324 mil por jogador</p>
                    <p style="margin-top: 5px;"><strong>Valor total:</strong> ‚Ç¨ 231.60 milh√µes</p>
                </div>
                <div class="table-container serie-b-scroll">
                    <table id="serieBTable" class="serie-b">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>Clube</th>
                                <th>Plantel</th>
                                <th>Idade M√©dia</th>
                                <th>Estrangeiros</th>
                                <th>Valor M√©dio</th>
                                <th>Valor Total</th>
                                <th>Posse Bola (%)</th>
                                <th>Passes Certos</th>
                                <th>Chutes/Jogo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="serieBBody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <button class="save-btn" onclick="saveChanges()">
            üíæ Salvar Altera√ß√µes
        </button>

        <!-- Footer -->
        <div class="footer">
            <p>Dados compilados do Observat√≥rio do Futebol (17/09/2025) e Transfermarkt.com.br</p>
            <p style="margin-top: 5px;">Planilha edit√°vel - Clique nos valores para editar</p>
        </div>
    </div>

    <script>
/* === Dados (mesmos objetos que voc√™ j√° tinha) === */
const top100Clubs = [
    { posicao: 1, clube: "Real Madrid", pais: "Espanha", valor: "‚Ç¨ 1.726 M" },
    { posicao: 2, clube: "Manchester City", pais: "Inglaterra", valor: "‚Ç¨ 1.538 M" },
    { posicao: 3, clube: "Barcelona FC", pais: "Espanha", valor: "‚Ç¨ 1.508 M" },
    { posicao: 4, clube: "Manchester United", pais: "Inglaterra", valor: "‚Ç¨ 1.394 M" },
    { posicao: 5, clube: "Liverpool FC", pais: "Inglaterra", valor: "‚Ç¨ 1.363 M" },
    { posicao: 6, clube: "Arsenal FC", pais: "Inglaterra", valor: "‚Ç¨ 1.262 M" },
    { posicao: 7, clube: "Chelsea FC", pais: "Inglaterra", valor: "‚Ç¨ 1.174 M" },
    { posicao: 8, clube: "PSG", pais: "Fran√ßa", valor: "‚Ç¨ 1.137 M" },
    { posicao: 9, clube: "Tottenham", pais: "Inglaterra", valor: "‚Ç¨ 1.108 M" },
    { posicao: 10, clube: "Bayern Munich", pais: "Alemanha", valor: "‚Ç¨ 1.074 M" },
    { posicao: 11, clube: "Newcastle United", pais: "Inglaterra", valor: "‚Ç¨ 945 M" },
    { posicao: 12, clube: "Atletico Madrid", pais: "Espanha", valor: "‚Ç¨ 939 M" },
    { posicao: 13, clube: "Juventus FC", pais: "It√°lia", valor: "‚Ç¨ 936 M" },
    { posicao: 14, clube: "Borussia Dortmund", pais: "Alemanha", valor: "‚Ç¨ 913 M" },
    { posicao: 15, clube: "AC Milan", pais: "It√°lia", valor: "‚Ç¨ 893 M" },
    { posicao: 16, clube: "West Ham United", pais: "Inglaterra", valor: "‚Ç¨ 859 M" },
    { posicao: 17, clube: "Brighton & Hove Albion", pais: "Inglaterra", valor: "‚Ç¨ 849 M" },
    { posicao: 18, clube: "Aston Villa", pais: "Inglaterra", valor: "‚Ç¨ 838 M" },
    { posicao: 19, clube: "Napoli", pais: "It√°lia", valor: "‚Ç¨ 831 M" },
    { posicao: 20, clube: "Inter Milan", pais: "It√°lia", valor: "‚Ç¨ 818 M" },
    { posicao: 21, clube: "Bayer Leverkusen", pais: "Alemanha", valor: "‚Ç¨ 803 M" },
    { posicao: 22, clube: "Crystal Palace", pais: "Inglaterra", valor: "‚Ç¨ 743 M" },
    { posicao: 23, clube: "RB Leipzig", pais: "Alemanha", valor: "‚Ç¨ 733 M" },
    { posicao: 24, clube: "Fulham FC", pais: "Inglaterra", valor: "‚Ç¨ 712 M" },
    { posicao: 25, clube: "Wolverhampton", pais: "Inglaterra", valor: "‚Ç¨ 706 M" },
    { posicao: 26, clube: "AS Roma", pais: "It√°lia", valor: "‚Ç¨ 700 M" },
    { posicao: 27, clube: "Everton FC", pais: "Inglaterra", valor: "‚Ç¨ 697 M" },
    { posicao: 28, clube: "Brentford FC", pais: "Inglaterra", valor: "‚Ç¨ 694 M" },
    { posicao: 29, clube: "Leicester City", pais: "Inglaterra", valor: "‚Ç¨ 664 M" },
    { posicao: 30, clube: "Valencia CF", pais: "Espanha", valor: "‚Ç¨ 647 M" },
    { posicao: 31, clube: "Sevilla FC", pais: "Espanha", valor: "‚Ç¨ 639 M" },
    { posicao: 32, clube: "Brighton & Hove Albion", pais: "Inglaterra", valor: "‚Ç¨ 637 M" },
    { posicao: 33, clube: "Leeds United", pais: "Inglaterra", valor: "‚Ç¨ 632 M" },
    { posicao: 34, clube: "AFC Bournemouth", pais: "Inglaterra", valor: "‚Ç¨ 630 M" },
    { posicao: 35, clube: "Lazio", pais: "It√°lia", valor: "‚Ç¨ 627 M" },
    { posicao: 36, clube: "Eintracht Frankfurt", pais: "Alemanha", valor: "‚Ç¨ 623 M" },
    { posicao: 37, clube: "Atalanta BC", pais: "It√°lia", valor: "‚Ç¨ 618 M" },
    { posicao: 38, clube: "Nottingham Forest", pais: "Inglaterra", valor: "‚Ç¨ 606 M" },
    { posicao: 39, clube: "Sheffield United", pais: "Inglaterra", valor: "‚Ç¨ 594 M" },
    { posicao: 40, clube: "Burnley FC", pais: "Inglaterra", valor: "‚Ç¨ 584 M" },
    { posicao: 41, clube: "Fiorentina", pais: "It√°lia", valor: "‚Ç¨ 575 M" },
    { posicao: 42, clube: "Real Sociedad", pais: "Espanha", valor: "‚Ç¨ 569 M" },
    { posicao: 43, clube: "Luton Town", pais: "Inglaterra", valor: "‚Ç¨ 564 M" },
    { posicao: 44, clube: "FC Porto", pais: "Portugal", valor: "‚Ç¨ 558 M" },
    { posicao: 45, clube: "Southampton FC", pais: "Inglaterra", valor: "‚Ç¨ 554 M" },
    { posicao: 46, clube: "Olympique Marseille", pais: "Fran√ßa", valor: "‚Ç¨ 547 M" },
    { posicao: 47, clube: "Athletic Bilbao", pais: "Espanha", valor: "‚Ç¨ 531 M" },
    { posicao: 48, clube: "AS Monaco", pais: "Fran√ßa", valor: "‚Ç¨ 527 M" },
    { posicao: 49, clube: "VfL Wolfsburg", pais: "Alemanha", valor: "‚Ç¨ 524 M" },
    { posicao: 50, clube: "Real Betis", pais: "Espanha", valor: "‚Ç¨ 519 M" },
    { posicao: 51, clube: "Olympique Lyon", pais: "Fran√ßa", valor: "‚Ç¨ 514 M" },
    { posicao: 52, clube: "Villarreal CF", pais: "Espanha", valor: "‚Ç¨ 508 M" },
    { posicao: 53, clube: "FC Salzburg", pais: "√Åustria", valor: "‚Ç¨ 503 M" },
    { posicao: 54, clube: "Union Berlin", pais: "Alemanha", valor: "‚Ç¨ 501 M" },
    { posicao: 55, clube: "Sporting CP", pais: "Portugal", valor: "‚Ç¨ 497 M" },
    { posicao: 56, clube: "Ajax Amsterdam", pais: "Holanda", valor: "‚Ç¨ 487 M" },
    { posicao: 57, clube: "FC Copenhagen", pais: "Dinamarca", valor: "‚Ç¨ 484 M" },
    { posicao: 58, clube: "Celta Vigo", pais: "Espanha", valor: "‚Ç¨ 473 M" },
    { posicao: 59, clube: "Girona FC", pais: "Espanha", valor: "‚Ç¨ 470 M" },
    { posicao: 60, clube: "Getafe CF", pais: "Espanha", valor: "‚Ç¨ 465 M" },
    { posicao: 61, clube: "FC Twente", pais: "Holanda", valor: "‚Ç¨ 462 M" },
    { posicao: 62, clube: "Hertha BSC", pais: "Alemanha", valor: "‚Ç¨ 456 M" },
    { posicao: 63, clube: "Schalke 04", pais: "Alemanha", valor: "‚Ç¨ 453 M" },
    { posicao: 64, clube: "FC Koln", pais: "Alemanha", valor: "‚Ç¨ 447 M" },
    { posicao: 65, clube: "VfB Stuttgart", pais: "Alemanha", valor: "‚Ç¨ 441 M" },
    { posicao: 66, clube: "SC Freiburg", pais: "Alemanha", valor: "‚Ç¨ 438 M" },
    { posicao: 67, clube: "TSG Hoffenheim", pais: "Alemanha", valor: "‚Ç¨ 435 M" },
    { posicao: 68, clube: "Borussia M'gladbach", pais: "Alemanha", valor: "‚Ç¨ 432 M" },
    { posicao: 69, clube: "FSV Mainz 05", pais: "Alemanha", valor: "‚Ç¨ 429 M" },
    { posicao: 70, clube: "FC Augsburg", pais: "Alemanha", valor: "‚Ç¨ 423 M" },
    { posicao: 71, clube: "SV Werder Bremen", pais: "Alemanha", valor: "‚Ç¨ 420 M" },
    { posicao: 72, clube: "FC St. Pauli", pais: "Alemanha", valor: "‚Ç¨ 416 M" },
    { posicao: 73, clube: "Hamburger SV", pais: "Alemanha", valor: "‚Ç¨ 413 M" },
    { posicao: 74, clube: "Hannover 96", pais: "Alemanha", valor: "‚Ç¨ 410 M" },
    { posicao: 75, clube: "Fortuna D√ºsseldorf", pais: "Alemanha", valor: "‚Ç¨ 407 M" },
    { posicao: 76, clube: "1. FC N√ºrnberg", pais: "Alemanha", valor: "‚Ç¨ 404 M" },
    { posicao: 77, clube: "Karlsruher SC", pais: "Alemanha", valor: "‚Ç¨ 401 M" },
    { posicao: 78, clube: "SV Darmstadt 98", pais: "Alemanha", valor: "‚Ç¨ 398 M" },
    { posicao: 79, clube: "Eintracht Braunschweig", pais: "Alemanha", valor: "‚Ç¨ 395 M" },
    { posicao: 80, clube: "FC Hansa Rostock", pais: "Alemanha", valor: "‚Ç¨ 392 M" },
    { posicao: 81, clube: "1. FC Magdeburg", pais: "Alemanha", valor: "‚Ç¨ 389 M" },
    { posicao: 82, clube: "SC Paderborn 07", pais: "Alemanha", valor: "‚Ç¨ 386 M" },
    { posicao: 83, clube: "SpVgg Greuther F√ºrth", pais: "Alemanha", valor: "‚Ç¨ 383 M" },
    { posicao: 84, clube: "SSV Jahn Regensburg", pais: "Alemanha", valor: "‚Ç¨ 380 M" },
    { posicao: 85, clube: "SV Sandhausen", pais: "Alemanha", valor: "‚Ç¨ 377 M" },
    { posicao: 86, clube: "Dynamo Dresden", pais: "Alemanha", valor: "‚Ç¨ 374 M" },
    { posicao: 87, clube: "FC Erzgebirge Aue", pais: "Alemanha", valor: "‚Ç¨ 371 M" },
    { posicao: 88, clube: "1. FC Heidenheim", pais: "Alemanha", valor: "‚Ç¨ 368 M" },
    { posicao: 89, clube: "SV Wehen Wiesbaden", pais: "Alemanha", valor: "‚Ç¨ 365 M" },
    { posicao: 90, clube: "TSV 1860 M√ºnchen", pais: "Alemanha", valor: "‚Ç¨ 362 M" },
    { posicao: 91, clube: "FC Ingolstadt 04", pais: "Alemanha", valor: "‚Ç¨ 359 M" },
    { posicao: 92, clube: "MSV Duisburg", pais: "Alemanha", valor: "‚Ç¨ 356 M" },
    { posicao: 93, clube: "W√ºrzburger Kickers", pais: "Alemanha", valor: "‚Ç¨ 353 M" },
    { posicao: 94, clube: "KFC Uerdingen 05", pais: "Alemanha", valor: "‚Ç¨ 350 M" },
    { posicao: 95, clube: "Viktoria K√∂ln", pais: "Alemanha", valor: "‚Ç¨ 347 M" },
    { posicao: 96, clube: "SC Verl", pais: "Alemanha", valor: "‚Ç¨ 344 M" },
    { posicao: 97, clube: "FC Bayern M√ºnchen II", pais: "Alemanha", valor: "‚Ç¨ 341 M" },
    { posicao: 98, clube: "FC Schalke 04 II", pais: "Alemanha", valor: "‚Ç¨ 338 M" },
    { posicao: 99, clube: "Borussia Dortmund II", pais: "Alemanha", valor: "‚Ç¨ 335 M" },
    { posicao: 100, clube: "Dynamo Dresden", pais: "Alemanha", valor: "‚Ç¨ 332 M" }
];

const serieAClubs = [
    { posicao: 1, clube: "SE Palmeiras", plantel: 29, idadeMedia: 26.3, estrangeiros: 8, valorMedio: "‚Ç¨ 7.32 mi.", valorTotal: "‚Ç¨ 212.15 mi.", posseBola: "58.2%", passesCertos: "385", chutesJogo: "13.4" },
    { posicao: 2, clube: "CR Flamengo", plantel: 31, idadeMedia: 28.4, estrangeiros: 10, valorMedio: "‚Ç¨ 6.32 mi.", valorTotal: "‚Ç¨ 195.90 mi.", posseBola: "59.8%", passesCertos: "412", chutesJogo: "14.7" },
    { posicao: 3, clube: "Botafogo FR", plantel: 31, idadeMedia: 27.4, estrangeiros: 11, valorMedio: "‚Ç¨ 4.46 mi.", valorTotal: "‚Ç¨ 138.35 mi.", posseBola: "56.1%", passesCertos: "368", chutesJogo: "12.9" },
    { posicao: 4, clube: "Cruzeiro EC", plantel: 31, idadeMedia: 26.6, estrangeiros: 6, valorMedio: "‚Ç¨ 4.05 mi.", valorTotal: "‚Ç¨ 125.65 mi.", posseBola: "55.3%", passesCertos: "354", chutesJogo: "11.8" },
    { posicao: 5, clube: "SC Corinthians", plantel: 32, idadeMedia: 26.3, estrangeiros: 8, valorMedio: "‚Ç¨ 3.45 mi.", valorTotal: "‚Ç¨ 110.45 mi.", posseBola: "53.7%", passesCertos: "342", chutesJogo: "10.9" },
    { posicao: 6, clube: "CR Vasco da Gama", plantel: 36, idadeMedia: 26.5, estrangeiros: 9, valorMedio: "‚Ç¨ 3.00 mi.", valorTotal: "‚Ç¨ 108.15 mi.", posseBola: "54.2%", passesCertos: "348", chutesJogo: "11.3" },
    { posicao: 7, clube: "EC Bahia", plantel: 29, idadeMedia: 27.6, estrangeiros: 5, valorMedio: "‚Ç¨ 3.50 mi.", valorTotal: "‚Ç¨ 101.50 mi.", posseBola: "52.8%", passesCertos: "335", chutesJogo: "10.4" },
    { posicao: 8, clube: "Atl√©tico Mineiro", plantel: 32, idadeMedia: 26.8, estrangeiros: 6, valorMedio: "‚Ç¨ 3.04 mi.", valorTotal: "‚Ç¨ 97.40 mi.", posseBola: "57.1%", passesCertos: "378", chutesJogo: "12.1" },
    { posicao: 9, clube: "Fluminense FC", plantel: 34, idadeMedia: 28.9, estrangeiros: 11, valorMedio: "‚Ç¨ 2.77 mi.", valorTotal: "‚Ç¨ 94.10 mi.", posseBola: "56.4%", passesCertos: "371", chutesJogo: "11.7" },
    { posicao: 10, clube: "RB Bragantino", plantel: 36, idadeMedia: 25.1, estrangeiros: 8, valorMedio: "‚Ç¨ 2.52 mi.", valorTotal: "‚Ç¨ 90.70 mi.", posseBola: "54.8%", passesCertos: "356", chutesJogo: "11.2" },
    { posicao: 11, clube: "S√£o Paulo FC", plantel: 34, idadeMedia: 27.9, estrangeiros: 11, valorMedio: "‚Ç¨ 2.64 mi.", valorTotal: "‚Ç¨ 89.85 mi.", posseBola: "55.6%", passesCertos: "362", chutesJogo: "11.5" },
    { posicao: 12, clube: "Gr√™mio FBPA", plantel: 38, idadeMedia: 27.7, estrangeiros: 12, valorMedio: "‚Ç¨ 2.28 mi.", valorTotal: "‚Ç¨ 86.45 mi.", posseBola: "53.2%", passesCertos: "339", chutesJogo: "10.6" },
    { posicao: 13, clube: "SC Internacional", plantel: 29, idadeMedia: 27.0, estrangeiros: 9, valorMedio: "‚Ç¨ 2.97 mi.", valorTotal: "‚Ç¨ 86.00 mi.", posseBola: "52.5%", passesCertos: "331", chutesJogo: "10.2" },
    { posicao: 14, clube: "Santos FC", plantel: 33, idadeMedia: 26.6, estrangeiros: 9, valorMedio: "‚Ç¨ 2.51 mi.", valorTotal: "‚Ç¨ 82.80 mi.", posseBola: "51.9%", passesCertos: "326", chutesJogo: "9.8" },
    { posicao: 15, clube: "Fortaleza EC", plantel: 37, idadeMedia: 29.2, estrangeiros: 10, valorMedio: "‚Ç¨ 1.28 mi.", valorTotal: "‚Ç¨ 47.18 mi.", posseBola: "49.3%", passesCertos: "298", chutesJogo: "8.7" },
    { posicao: 16, clube: "Sport Recife", plantel: 31, idadeMedia: 29.1, estrangeiros: 6, valorMedio: "‚Ç¨ 1.27 mi.", valorTotal: "‚Ç¨ 39.25 mi.", posseBola: "48.1%", passesCertos: "287", chutesJogo: "8.2" },
    { posicao: 17, clube: "EC Vit√≥ria", plantel: 34, idadeMedia: 28.2, estrangeiros: 6, valorMedio: "‚Ç¨ 985 mil", valorTotal: "‚Ç¨ 33.50 mi.", posseBola: "47.6%", passesCertos: "282", chutesJogo: "7.9" },
    { posicao: 18, clube: "Cear√° SC", plantel: 32, idadeMedia: 29.2, estrangeiros: 3, valorMedio: "‚Ç¨ 1.03 mi.", valorTotal: "‚Ç¨ 32.85 mi.", posseBola: "46.8%", passesCertos: "276", chutesJogo: "7.6" },
    { posicao: 19, clube: "EC Juventude", plantel: 36, idadeMedia: 28.1, estrangeiros: 5, valorMedio: "‚Ç¨ 644 mil", valorTotal: "‚Ç¨ 23.20 mi.", posseBola: "45.2%", passesCertos: "268", chutesJogo: "7.1" },
    { posicao: 20, clube: "Mirassol FC", plantel: 33, idadeMedia: 29.2, estrangeiros: 1, valorMedio: "‚Ç¨ 683 mil", valorTotal: "‚Ç¨ 22.53 mi.", posseBola: "44.7%", passesCertos: "264", chutesJogo: "6.8" }
];

const serieBClubs = [
    { posicao: 1, clube: "Athletico Paranaense", plantel: 33, idadeMedia: 26.5, estrangeiros: 10, valorMedio: "‚Ç¨ 1.17 mi.", valorTotal: "‚Ç¨ 38.48 mi.", posseBola: "54.8%", passesCertos: "356", chutesJogo: "11.2" },
    { posicao: 2, clube: "Clube do Remo", plantel: 40, idadeMedia: 27.4, estrangeiros: 7, valorMedio: "‚Ç¨ 408 mil", valorTotal: "‚Ç¨ 16.30 mi.", posseBola: "48.3%", passesCertos: "289", chutesJogo: "8.4" },
    { posicao: 3, clube: "Coritiba FC", plantel: 30, idadeMedia: 28.9, estrangeiros: 4, valorMedio: "‚Ç¨ 529 mil", valorTotal: "‚Ç¨ 15.88 mi.", posseBola: "49.7%", passesCertos: "302", chutesJogo: "8.9" },
    { posicao: 4, clube: "Am√©rica Mineiro", plantel: 38, idadeMedia: 27.5, estrangeiros: 4, valorMedio: "‚Ç¨ 382 mil", valorTotal: "‚Ç¨ 14.53 mi.", posseBola: "47.2%", passesCertos: "278", chutesJogo: "7.8" },
    { posicao: 5, clube: "Cuiab√° EC", plantel: 31, idadeMedia: 26.6, estrangeiros: 3, valorMedio: "‚Ç¨ 445 mil", valorTotal: "‚Ç¨ 13.80 mi.", posseBola: "48.6%", passesCertos: "294", chutesJogo: "8.3" },
    { posicao: 6, clube: "Atl√©tico Goianiense", plantel: 34, idadeMedia: 27.2, estrangeiros: 4, valorMedio: "‚Ç¨ 382 mil", valorTotal: "‚Ç¨ 12.98 mi.", posseBola: "46.8%", passesCertos: "275", chutesJogo: "7.5" },
    { posicao: 7, clube: "Gr√™mio Novorizontino", plantel: 30, idadeMedia: 29.9, estrangeiros: 1, valorMedio: "‚Ç¨ 423 mil", valorTotal: "‚Ç¨ 12.70 mi.", posseBola: "45.1%", passesCertos: "265", chutesJogo: "7.0" },
    { posicao: 8, clube: "Goi√°s EC", plantel: 29, idadeMedia: 29.2, estrangeiros: 3, valorMedio: "‚Ç¨ 417 mil", valorTotal: "‚Ç¨ 12.10 mi.", posseBola: "44.9%", passesCertos: "262", chutesJogo: "6.9" },
    { posicao: 9, clube: "Crici√∫ma EC", plantel: 49, idadeMedia: 26.4, estrangeiros: 1, valorMedio: "‚Ç¨ 227 mil", valorTotal: "‚Ç¨ 11.10 mi.", posseBola: "42.6%", passesCertos: "241", chutesJogo: "6.2" },
    { posicao: 10, clube: "CRB", plantel: 28, idadeMedia: 28.0, estrangeiros: 2, valorMedio: "‚Ç¨ 369 mil", valorTotal: "‚Ç¨ 10.33 mi.", posseBola: "43.8%", passesCertos: "248", chutesJogo: "6.5" },
    { posicao: 11, clube: "Ponte Preta", plantel: 35, idadeMedia: 27.8, estrangeiros: 3, valorMedio: "‚Ç¨ 295 mil", valorTotal: "‚Ç¨ 10.33 mi.", posseBola: "42.1%", passesCertos: "235", chutesJogo: "6.1" },
    { posicao: 12, clube: "Ava√≠ FC", plantel: 32, idadeMedia: 28.5, estrangeiros: 2, valorMedio: "‚Ç¨ 321 mil", valorTotal: "‚Ç¨ 10.27 mi.", posseBola: "41.8%", passesCertos: "232", chutesJogo: "5.9" },
    { posicao: 13, clube: "Oper√°rio PR", plantel: 30, idadeMedia: 29.0, estrangeiros: 1, valorMedio: "‚Ç¨ 342 mil", valorTotal: "‚Ç¨ 10.26 mi.", posseBola: "41.5%", passesCertos: "228", chutesJogo: "5.8" },
    { posicao: 14, clube: "Guarani FC", plantel: 33, idadeMedia: 28.7, estrangeiros: 2, valorMedio: "‚Ç¨ 306 mil", valorTotal: "‚Ç¨ 10.10 mi.", posseBola: "40.9%", passesCertos: "225", chutesJogo: "5.6" },
    { posicao: 15, clube: "Paysandu SC", plantel: 31, idadeMedia: 27.9, estrangeiros: 1, valorMedio: "‚Ç¨ 325 mil", valorTotal: "‚Ç¨ 10.08 mi.", posseBola: "40.6%", passesCertos: "222", chutesJogo: "5.5" },
    { posicao: 16, clube: "Vila Nova FC", plantel: 29, idadeMedia: 28.3, estrangeiros: 2, valorMedio: "‚Ç¨ 345 mil", valorTotal: "‚Ç¨ 10.01 mi.", posseBola: "40.2%", passesCertos: "218", chutesJogo: "5.3" },
    { posicao: 17, clube: "Londrina EC", plantel: 34, idadeMedia: 29.1, estrangeiros: 1, valorMedio: "‚Ç¨ 294 mil", valorTotal: "‚Ç¨ 9.996 mi.", posseBola: "39.8%", passesCertos: "215", chutesJogo: "5.2" },
    { posicao: 18, clube: "Chapecoense", plantel: 32, idadeMedia: 28.8, estrangeiros: 0, valorMedio: "‚Ç¨ 312 mil", valorTotal: "‚Ç¨ 9.984 mi.", posseBola: "39.4%", passesCertos: "212", chutesJogo: "5.0" },
    { posicao: 19, clube: "Brusque FC", plantel: 30, idadeMedia: 29.5, estrangeiros: 1, valorMedio: "‚Ç¨ 330 mil", valorTotal: "‚Ç¨ 9.90 mi.", posseBola: "39.1%", passesCertos: "208", chutesJogo: "4.9" },
    { posicao: 20, clube: "Ituano FC", plantel: 28, idadeMedia: 30.2, estrangeiros: 0, valorMedio: "‚Ç¨ 353 mil", valorTotal: "‚Ç¨ 9.884 mi.", posseBola: "38.7%", passesCertos: "205", chutesJogo: "4.7" }
];

let currentTab = 'top100';

/* === Utilidade: chave para localStorage === */
function cellKey(tableId, row, col) {
    return `${tableId}::r${row}::c${col}`;
}

/* === showTab (corrigido para receber event) === */
function showTab(tabName, ev) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active','serie-a','serie-b'));
    document.getElementById(tabName).classList.add('active');

    if (ev && ev.currentTarget) {
        const activeBtn = ev.currentTarget;
        activeBtn.classList.add('active');
        if (tabName === 'serieA') {
            activeBtn.classList.add('serie-a');
            document.getElementById('exportBtn').className = 'export-btn serie-a';
        } else if (tabName === 'serieB') {
            activeBtn.classList.add('serie-b');
            document.getElementById('exportBtn').className = 'export-btn serie-b';
        } else {
            document.getElementById('exportBtn').className = 'export-btn';
        }
    }
    currentTab = tabName;
}

/* === Cria c√©lula de cadeado (reutiliz√°vel) === */
function createLockIcon(isLocked) {
    const span = document.createElement('span');
    span.className = 'cell-lock' + (isLocked ? ' locked' : '');
    span.innerHTML = isLocked ? 'üîí' : 'üîì';
    span.title = isLocked ? 'Clique para destravar este campo' : 'Clique para travar este campo';
    // estilo inline pequeno para garantir posicionamento (o CSS j√° cobre a maior parte)
    span.style.zIndex = '1000';
    span.style.position = 'absolute';
    span.style.right = '4px';
    span.style.top = '50%';
    span.style.transform = 'translateY(-50%)';
    span.style.cursor = 'pointer';
    return span;
}

/* === Toggle lock: usa data-row/data-col para persist√™ncia === */
function toggleCellLockByElement(cell) {
    if (!cell) return;
    const table = cell.closest('table');
    const tableId = table.id;
    const row = parseInt(cell.dataset.row, 10);
    const col = cell.dataset.col;

    const key = cellKey(tableId, row, col);
    const isLocked = cell.classList.contains('locked');

    if (isLocked) {
        // desbloquear
        cell.classList.remove('locked');
        cell.classList.add('editable');
        cell.contentEditable = "true";
        const lock = cell.querySelector('.cell-lock');
        if (lock) {
            lock.classList.remove('locked');
            lock.innerHTML = 'üîì';
            lock.title = 'Clique para travar este campo';
            lock.style.color = '#00E38C';
            lock.style.borderColor = '#00E38C';
        }
        localStorage.removeItem(key);
        alert('üîì Campo desbloqueado! Agora voc√™ pode editar.');
    } else {
        // bloquear
        cell.classList.remove('editable');
        cell.classList.add('locked');
        cell.contentEditable = "false";
        const lock = cell.querySelector('.cell-lock');
        if (lock) {
            lock.classList.add('locked');
            lock.innerHTML = 'üîí';
            lock.title = 'Clique para destravar este campo';
            lock.style.color = '#ef4444';
            lock.style.borderColor = '#ef4444';
        }
        // salvar estado
        const payload = {
            tableId, row, col,
            value: cell.textContent.trim(),
            ts: new Date().toISOString()
        };
        localStorage.setItem(key, JSON.stringify(payload));
        alert('üîí Campo travado! Protegido contra edi√ß√£o.');
    }
}

/* === Delegation: handler para cliques nas tabelas === */
function onTableBodyClick(e) {
    // Se clicou no √≠cone do cadeado
    const lock = e.target.closest('.cell-lock');
    if (lock) {
        // impedir que o click "abra" a c√©lula
        e.stopPropagation();
        const cell = lock.closest('td');
        toggleCellLockByElement(cell);
        return;
    }

    // se clicou numa c√©lula (td) v√°lida
    const cell = e.target.closest('td');
    if (!cell) return;
    // N√£o habilitar o td da √∫ltima coluna de A√ß√µes
    if (cell.closest('tr').querySelector('td:last-child') === cell) return;

    // N√£o editar a coluna 'posicao' (manter comportamento anterior)
    if (cell.dataset.col === 'posicao') {
        return;
    }

    // Se est√° travado, alerta
    if (cell.classList.contains('locked')) {
        alert('üîí Esta c√©lula est√° travada! Clique no cadeado para desbloquear.');
        return;
    }

    // Tornar edit√°vel
    if (!cell.classList.contains('editable')) {
        cell.classList.add('editable');
        cell.contentEditable = "true";
        // adicionar icon se n√£o existir
        if (!cell.querySelector('.cell-lock')) {
            const lk = createLockIcon(false);
            // listener no lock icon (n√£o delegado para evitar duplicidade)
            lk.addEventListener('click', function(ev){
                ev.stopPropagation();
                toggleCellLockByElement(cell);
            }, true);
            cell.style.position = 'relative';
            cell.appendChild(lk);
        }
        // foco e sele√ß√£o
        cell.focus();
        const range = document.createRange();
        range.selectNodeContents(cell);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
    }
}

/* === Salvar edi√ß√£o: Enter ou blur === */
function attachEditSavingHandlers(tbody) {
    // delega√ß√£o de keydown via document (mais simples)
    tbody.addEventListener('keydown', function(e){
        const cell = document.activeElement.closest && document.activeElement.closest('td');
        if (!cell) return;
        if (e.key === 'Enter') {
            e.preventDefault();
            cell.blur();
        } else if (e.key === 'Escape') {
            // desfazer edi√ß√£o: aqui apenas removemos a classe edit√°vel (n√£o restaura valor antigo)
            cell.blur();
        }
    });

    // blur: remove classe editable (se ainda n√£o foi bloqueado)
    tbody.addEventListener('focusout', function(e){
        const cell = e.target.closest && e.target.closest('td');
        if (!cell) return;
        // se n√£o est√° locked, desligar edi√ß√£o
        if (!cell.classList.contains('locked')) {
            cell.contentEditable = "false";
            cell.classList.remove('editable');
        }
    }, true);
}

/* === Save / export / coletar dados (mantive sua l√≥gica com pequenas adapta√ß√µes) === */
function saveChanges() {
    const lockedCells = document.querySelectorAll('.locked');
    let lockedCount = lockedCells.length;
    let unlockedCount = 0;

    document.querySelectorAll('td').forEach(cell => {
        if (!cell.classList.contains('locked')) {
            if (cell.classList.contains('editable') || cell.contentEditable === "true") unlockedCount++;
        }
    });

    const plantelData = {
        timestamp: new Date().toISOString(),
        usuario: 'admin',
        dadosEditados: {},
        celulasProtegidas: lockedCount
    };

    ['serieATable', 'serieBTable'].forEach(tableId => {
        const table = document.getElementById(tableId);
        if (table && table.closest('.tab-content').classList.contains('active')) {
            const dados = [];
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            for (let r = 0; r < rows.length; r++) {
                const cells = rows[r].getElementsByTagName('td');
                const clubeData = {
                    clube: cells[1]?.textContent || '',
                    plantel: cells[2]?.textContent || '',
                    valorTotal: cells[6]?.textContent || '',
                    posseBola: cells[7]?.textContent || '',
                    passesCertos: cells[8]?.textContent || '',
                    chutesJogo: cells[9]?.textContent || '',
                    protegido: !!rows[r].querySelector('.locked')
                };
                dados.push(clubeData);
            }
            plantelData.dadosEditados[tableId] = dados;
        }
    });

    localStorage.setItem('estatisticasPlantel', JSON.stringify(plantelData));
    alert(`üíæ Altera√ß√µes salvas com sucesso!\n\nüìä Dados protegidos: ${lockedCount} campos\nüîì Dados edit√°veis: ${unlockedCount} campos\n\n‚úÖ Dados sincronizados com a Central Admin!`);
    console.log('üìä Dados salvos para Central Admin:', plantelData);
}

/* === Fun√ß√µes para persistir/restaurar cadeados por key est√°vel === */
function persistLockState(cell) {
    const table = cell.closest('table');
    const key = cellKey(table.id, parseInt(cell.dataset.row,10), cell.dataset.col);
    const payload = { val: cell.textContent.trim(), ts: new Date().toISOString() };
    localStorage.setItem(key, JSON.stringify(payload));
}
function restoreLocksForTable(tableId) {
    const table = document.getElementById(tableId);
    if (!table) return;
    const tbody = table.querySelector('tbody');
    const rows = tbody.rows;
    for (let r=0; r<rows.length; r++) {
        const cells = rows[r].cells;
        for (let c=0; c<cells.length-1; c++) { // -1 para pular coluna de A√ß√µes
            const cell = cells[c];
            const key = cellKey(tableId, r, cell.dataset.col);
            const stored = localStorage.getItem(key);
            if (stored) {
                // restaurar lock
                cell.classList.add('locked');
                cell.contentEditable = "false";
                cell.style.position = 'relative';
                // remover lock antigo se houver
                const existing = cell.querySelector('.cell-lock');
                if (existing) existing.remove();
                const lk = createLockIcon(true);
                lk.addEventListener('click', function(ev){ ev.stopPropagation(); toggleCellLockByElement(cell); }, true);
                cell.appendChild(lk);
            } else {
                // adicionar lock icon aberto para UX (opcional)
                if (!cell.querySelector('.cell-lock')) {
                    const lk = createLockIcon(false);
                    lk.addEventListener('click', function(ev){ ev.stopPropagation(); toggleCellLockByElement(cell); }, true);
                    cell.appendChild(lk);
                }
            }
        }
    }
}

/* === Popula tabelas ‚Äî adiciona data attributes nas c√©lulas === */
function populateTable(tablePrefix, data, columns) {
    const tbody = document.getElementById(tablePrefix + 'Body');
    tbody.innerHTML = '';
    data.forEach((item, rowIndex) => {
        const row = document.createElement('tr');
        columns.forEach((col, colIndex) => {
            const cell = document.createElement('td');
            // valor de exibi√ß√£o (mesma chave do objeto)
            cell.textContent = item[col];
            // identificadores
            cell.dataset.row = rowIndex;
            // use a chave 'col' como identificador (por ex.: 'posicao','clube','plantel'...)
            cell.dataset.col = col;
            cell.style.position = 'relative';
            row.appendChild(cell);
        });

        // A√ß√µes: bot√£o editar (mantive sua ideia, mas agora delegamos clicks nas c√©lulas)
        const actionCell = document.createElement('td');
        const editBtn = document.createElement('button');
        editBtn.textContent = '‚úèÔ∏è Editar';
        editBtn.className = 'edit-btn';
        editBtn.addEventListener('click', function(){
            // ao clicar no bot√£o, abrimos edi√ß√£o na primeira c√©lula edit√°vel da linha (exceto posi√ß√£o)
            const cells = row.querySelectorAll('td:not(:last-child)');
            for (let i=0;i<cells.length;i++) {
                const c = cells[i];
                if (c.dataset.col !== 'posicao' && !c.classList.contains('locked')) {
                    // simula clique para entrar em edi√ß√£o
                    c.click();
                    break;
                }
            }
        });
        actionCell.appendChild(editBtn);
        row.appendChild(actionCell);

        tbody.appendChild(row);
    });

    // Anexar delega√ß√£o local ao tbody
    // remover listeners duplicados, se houver
    tbody.removeEventListener('click', onTableBodyClick);
    tbody.addEventListener('click', onTableBodyClick);
    attachEditSavingHandlers(tbody);
}

/* === Export CSV (mantive sua l√≥gica, mas voc√™ pode adaptar) === */
function exportCurrentTab() {
    let data, filename, headers;
    if (currentTab === 'top100') {
        data = top100Clubs;
        filename = 'top_100_clubes_mais_valiosos.csv';
        headers = ['Posi√ß√£o','Clube','Pa√≠s','Valor'];
    } else if (currentTab === 'serieA') {
        data = serieAClubs;
        filename = 'serie_a_brasileirao.csv';
        headers = ['Posi√ß√£o','Clube','Plantel','Idade M√©dia','Estrangeiros','Valor M√©dio','Valor Total','Posse Bola (%)','Passes Certos','Chutes/Jogo'];
    } else {
        data = serieBClubs;
        filename = 'serie_b_brasileirao.csv';
        headers = ['Posi√ß√£o','Clube','Plantel','Idade M√©dia','Estrangeiros','Valor M√©dio','Valor Total','Posse Bola (%)','Passes Certos','Chutes/Jogo'];
    }
    const csvContent = [
        headers.join(','),
        ...data.map(row => headers.map(header => {
            const key = header.toLowerCase().replace(/\s+/g,'').replace(/[√ß√£]/g,'a').replace('√ß','c');
            const value = row[Object.keys(row).find(k => k.toLowerCase().replace(/\s+/g,'').includes(key.substring(0,5))) || Object.keys(row)[headers.indexOf(header)]];
            return `"${value || ''}"`;
        }).join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

/* === Debug helpers === */
function limparTodosCadeados() {
    // limpa chaves armazenadas relacionadas a tabelas
    Object.keys(localStorage).forEach(k => {
        if (k.includes('serieATable::') || k.includes('serieBTable::') || k.includes('top100Table::')) {
            localStorage.removeItem(k);
        }
    });
    // remover icons e classes
    document.querySelectorAll('.cell-lock').forEach(l => l.remove());
    document.querySelectorAll('.locked').forEach(c => c.classList.remove('locked'));
    document.querySelectorAll('.editable').forEach(c => c.classList.remove('editable'));
    document.querySelectorAll('td').forEach(td => td.contentEditable = "false");
    alert('üßπ Todos os cadeados foram limpos! Recarregue a p√°gina para testar.');
}

function testarCadeado() {
    const cell = document.querySelector('#serieATable tbody tr td[data-col="plantel"]');
    if (!cell) { console.error('‚ùå [TEST] c√©lula n√£o encontrada'); return; }
    cell.click(); // entra em edi√ß√£o
    setTimeout(() => toggleCellLockByElement(cell), 800);
    setTimeout(() => toggleCellLockByElement(cell), 2000);
}

/* === Inicializa√ß√£o (DOMContentLoaded) === */
document.addEventListener('DOMContentLoaded', function() {
    // Atualize os nomes das colunas conforme os seus arrays
    populateTable('top100', top100Clubs, ['posicao','clube','pais','valor']);
    populateTable('serieA', serieAClubs, ['posicao','clube','plantel','idadeMedia','estrangeiros','valorMedio','valorTotal','posseBola','passesCertos','chutesJogo']);
    populateTable('serieB', serieBClubs, ['posicao','clube','plantel','idadeMedia','estrangeiros','valorMedio','valorTotal','posseBola','passesCertos','chutesJogo']);

    // Restaurar locks
    restoreLocksForTable('top100Table');
    restoreLocksForTable('serieATable');
    restoreLocksForTable('serieBTable');

    // Expor fun√ß√µes para debug global
    window.limparTodosCadeados = limparTodosCadeados;
    window.toggleCellLockByElement = toggleCellLockByElement;
    window.testarCadeado = testarCadeado;
    window.exportCurrentTab = exportCurrentTab;
    window.saveChanges = saveChanges;

    console.log('üîß [DEBUG] Sistema de edi√ß√£o/travas inicializado.');
});
    </script>
</body>
</html>

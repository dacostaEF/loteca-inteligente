<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>üîê Central Admin - Loteca Inteligente</title>
    <link rel="icon" type="image/png" href="/static/Favicon_LI.png">
    <link rel="shortcut icon" type="image/png" href="/static/Favicon_LI.png">
    
    <!-- META TAGS PARA AMBIENTE M√ìVEL COM DESTAQUE LIL√ÅS -->
    <meta name="theme-color" content="#A855F7">
    <meta name="msapplication-navbutton-color" content="#A855F7">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cor-fundo: #12101a;
            --cor-fundo-card: #1e1b29;
            --cor-borda: #3a364f;
            --cor-texto-principal: #e2e8f0;
            --cor-texto-secundario: #94a3b8;
            --cor-destaque-primaria: #A855F7; /* Lil√°s */
            --cor-destaque-secundaria: #00E38C; /* Verde */
            --cor-vantagem: #00E38C;
            --cor-desvantagem: #F43F5E; /* Vermelho/Rosa */
            --cor-equilibrio: #FBBF24; /* Amarelo */
        }

        body {
            font-family: 'Roboto', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--cor-fundo);
            min-height: 100vh;
            color: var(--cor-texto-principal);
            
            /* MOLDURA NEON LIL√ÅS - EFEITO LOTERIAS INTELIGENTE */
            box-shadow: 
                inset 0 0 0 3px var(--cor-destaque-primaria),
                inset 0 0 20px rgba(168, 85, 247, 0.3),
                0 0 40px rgba(168, 85, 247, 0.2);
            position: relative;
        }
        
        /* MOLDURA NEON PARA TABLETS */
        @media (max-width: 1024px) and (min-width: 769px) {
            body {
                box-shadow: 
                    inset 0 0 0 4px var(--cor-destaque-primaria),
                    inset 0 0 25px rgba(168, 85, 247, 0.35),
                    0 0 50px rgba(168, 85, 247, 0.25);
                animation: neonPulse 4s ease-in-out infinite alternate;
            }
        }

        /* MOLDURA NEON ADICIONAL PARA DISPOSITIVOS M√ìVEIS */
        @media (max-width: 768px) {
            body {
                box-shadow: 
                    inset 0 0 0 2px var(--cor-destaque-primaria),
                    inset 0 0 15px rgba(168, 85, 247, 0.4),
                    0 0 30px rgba(168, 85, 247, 0.3);
                animation: neonPulse 3s ease-in-out infinite alternate;
            }
        }
        
        /* ANIMA√á√ÉO NEON PULSANTE */
        @keyframes neonPulse {
            0% {
                box-shadow: 
                    inset 0 0 0 3px var(--cor-destaque-primaria),
                    inset 0 0 20px rgba(168, 85, 247, 0.3),
                    0 0 40px rgba(168, 85, 247, 0.2);
            }
            100% {
                box-shadow: 
                    inset 0 0 0 3px var(--cor-destaque-primaria),
                    inset 0 0 25px rgba(168, 85, 247, 0.5),
                    0 0 60px rgba(168, 85, 247, 0.4);
            }
        }

        /* === TELA DE LOGIN === */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-box h1 {
            color: var(--cor-destaque-primaria);
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 800;
        }

        .login-box .icon {
            font-size: 60px;
            color: var(--cor-destaque-secundaria);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--cor-texto-secundario);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--cor-borda);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            background-color: var(--cor-fundo);
            color: var(--cor-texto-principal);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--cor-destaque-primaria);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .form-section {
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-section h4 {
            color: var(--cor-destaque-primaria);
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 2px solid var(--cor-destaque-primaria);
            padding-bottom: 8px;
        }
        
        .form-text {
            color: var(--cor-texto-secundario);
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .btn {
            background: linear-gradient(135deg, var(--cor-destaque-secundaria), #00B377);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,227,140,0.3);
        }

        .error-message {
            color: #e74c3c;
            margin-top: 15px;
            padding: 10px;
            background: #ffeaea;
            border-radius: 5px;
            display: none;
        }

        /* === INTERFACE PRINCIPAL === */
        .admin-container {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: var(--cor-destaque-primaria);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 800;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .stats-grid {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
            transition: transform 0.3s;
            flex: 1;
            min-width: 200px;
            max-width: 280px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #666;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            padding: 5px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--cor-texto-secundario);
        }

        .tab:hover {
            background: rgba(168, 85, 247, 0.1);
            color: var(--cor-destaque-primaria);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--cor-destaque-primaria), #9333EA);
            color: white;
        }

        .tab-content {
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            position: relative;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--cor-borda);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: var(--cor-fundo);
            color: var(--cor-texto-principal);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--cor-destaque-primaria);
            transform: translateY(-2px);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .input-group label {
            position: absolute;
            top: -10px;
            left: 15px;
            background: var(--cor-fundo-card);
            padding: 0 10px;
            color: var(--cor-destaque-secundaria);
            font-weight: 600;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--cor-destaque-secundaria), #00B377);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,227,140,0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--cor-borda);
            color: var(--cor-texto-secundario);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            border-color: var(--cor-destaque-primaria);
            color: var(--cor-destaque-primaria);
        }

        .btn-danger {
            background: var(--cor-desvantagem);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--cor-fundo-card);
            border: 1px solid var(--cor-borda);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .data-table th {
            background: linear-gradient(135deg, var(--cor-destaque-primaria), #9333EA);
            color: white;
            padding: 15px 10px;
            font-weight: 600;
            text-align: left;
        }

        .data-table td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--cor-borda);
            color: var(--cor-texto-principal);
        }

        .data-table tr:hover {
            background: rgba(168, 85, 247, 0.05);
        }

        .escudo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.serie-a {
            background: var(--cor-destaque-secundaria);
            color: white;
        }

        .status-badge.s√©rie-a {
            background: var(--cor-destaque-secundaria);
            color: white;
        }

        .status-badge.serie-b {
            background: var(--cor-equilibrio);
            color: var(--cor-fundo);
        }

        .status-badge.s√©rie-b {
            background: var(--cor-equilibrio);
            color: var(--cor-fundo);
        }

        .status-badge.regional {
            background: var(--cor-texto-secundario);
            color: white;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: var(--cor-texto-secundario);
        }

        .loading i {
            font-size: 40px;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
            color: var(--cor-destaque-primaria);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message, .error-alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
            border: 1px solid var(--cor-borda);
        }

        .success-message {
            background: rgba(0, 227, 140, 0.1);
            color: var(--cor-destaque-secundaria);
            border-color: var(--cor-destaque-secundaria);
        }

        .error-alert {
            background: rgba(244, 63, 94, 0.1);
            color: var(--cor-desvantagem);
            border-color: var(--cor-desvantagem);
        }

        .search-box {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--cor-borda);
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            background-color: var(--cor-fundo);
            color: var(--cor-texto-principal);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--cor-destaque-primaria);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .data-table {
                font-size: 14px;
            }
            
            .data-table th, .data-table td {
                padding: 8px 5px;
            }
        }

        /* Estilos para aba Classifica√ß√£o */
        .classification-area {
            margin: 20px 0;
        }

        .table-input {
            width: 60px;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
        }

        .table-input:focus {
            border-color: var(--cor-destaque-primaria);
            outline: none;
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
        }

        /* C√©lulas edit√°veis na tabela de classifica√ß√£o */
        .data-table td.editable {
            background-color: #f8f9ff;
            border: 1px dashed #ddd;
            cursor: text;
            transition: all 0.2s ease;
        }

        .data-table td.editable:hover {
            background-color: #f0f0ff;
            border-color: var(--cor-destaque-primaria);
        }

        .data-table td.editable:focus {
            background-color: white;
            border-color: var(--cor-destaque-primaria);
            outline: none;
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.1);
        }

        .loading-message {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .coming-soon {
            text-align: center;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 40px 0;
        }
        
        /* === ESTILOS PARA EDI√á√ÉO AVAN√áADA === */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes saved {
            0% { background-color: #d1f2eb; }
            50% { background-color: #28a745; }
            100% { background-color: #d1f2eb; }
        }
        
        .editable {
            transition: all 0.3s ease;
            cursor: text;
        }
        
        .editable:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .editable:focus {
            outline: none;
            transform: scale(1.02);
        }
        
        .modified {
            animation: pulse 0.5s ease-in-out;
        }
        
        .saved {
            animation: saved 1s ease-in-out;
        }

        /* === SISTEMA DE TOOLTIPS EDUCATIVOS === */
        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 5px;
            transition: all 0.3s ease;
            vertical-align: middle;
        }

        .help-icon:hover {
            background: #c82333;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        /* Modal de Ajuda */
        .help-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .help-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease-out;
            overflow: hidden;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .help-modal-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-modal-title {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .help-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .help-modal-body {
            padding: 25px;
            color: white;
            line-height: 1.6;
        }

        .help-definition {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffd700;
        }

        .help-formula {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            color: #ffd700;
        }

        .help-examples {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .help-example {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .help-example-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
        }

        .help-example-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .help-interpretation {
            margin-top: 20px;
        }

        .help-scale {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .help-scale-item {
            text-align: center;
            flex: 1;
            padding: 5px;
        }

        .help-scale-excellent { color: #28a745; }
        .help-scale-good { color: #ffc107; }
        .help-scale-average { color: #fd7e14; }
        .help-scale-poor { color: #dc3545; }

        /* === √çCONE TOGGLE SENHA === */
        #togglePassword:hover {
            color: #00E38C !important;
            transform: scale(1.1);
        }

        /* === BOT√ïES DE A√á√ÉO DESTACADOS === */
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* Efeitos hover espec√≠ficos por cor */
        button[style*="00E38C"]:hover {
            box-shadow: 0 8px 25px rgba(0,227,140,0.4) !important;
        }

        button[style*="6c757d"]:hover {
            box-shadow: 0 8px 25px rgba(108,117,125,0.4) !important;
        }

        button[style*="17a2b8"]:hover {
            box-shadow: 0 8px 25px rgba(23,162,184,0.4) !important;
        }

        button[style*="ffc107"]:hover {
            box-shadow: 0 8px 25px rgba(255,193,7,0.4) !important;
        }

        /* === SCROLL PERSONALIZADO PARA TABELA DE JOGOS === */
        .tabela-jogos-scroll {
            scrollbar-width: thin;
            scrollbar-color: #6f42c1 #2a2a2a;
        }

        .tabela-jogos-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .tabela-jogos-scroll::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 4px;
        }

        .tabela-jogos-scroll::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6f42c1, #8b5cf6);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .tabela-jogos-scroll::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
        }

        /* Cabe√ßalho fixo na tabela */
        .tabela-jogos-scroll thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Notifica√ß√µes */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }

        /* === ESTILOS PARA ESTAT√çSTICAS === */
        .stats-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            color: #6f42c1;
            background: linear-gradient(135deg, #6f42c1, #8b5cf6);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin: -20px -20px 20px -20px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            color: #495057;
            margin-bottom: 10px;
        }

        /* === ESTILOS DOS CAMPOS === */
        
        /* Campos bloqueados (dados da classifica√ß√£o) - VERS√ÉO PROFISSIONAL */
        .campo-bloqueado {
            background: #1a1a1a !important;
            border: 1px solid #404040 !important;
            padding: 10px 12px !important;
            border-radius: 4px !important;
            color: #ffffff !important;
            font-weight: 600 !important;
            font-size: 16px !important;
            width: 100% !important;
            text-align: right !important;
            font-family: 'Roboto', 'Open Sans', sans-serif !important;
            cursor: not-allowed !important;
            user-select: none !important;
            pointer-events: none !important;
        }
        
        .campo-bloqueado:focus {
            outline: 2px solid #dc3545 !important;
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.6) !important;
        }
        
        /* Placeholder dos campos bloqueados tamb√©m branco */
        .campo-bloqueado::placeholder {
            color: #ffffff !important;
            font-weight: normal !important;
        }
        
        /* Campos calculados automaticamente */
        .campo-calculado {
            background: #2d3748 !important; /* Fundo mais claro */
            border: 2px solid #60a5fa !important; /* Borda azul para destaque */
            padding: 10px 12px !important;
            border-radius: 4px !important;
            color: #ffffff !important; /* Texto branco forte */
            font-weight: 700 !important;
            font-size: 18px !important; /* Fonte maior */
            width: 100% !important;
            text-align: center !important; /* Centralizado para melhor visibilidade */
            font-family: 'Roboto', 'Open Sans', sans-serif !important;
            cursor: not-allowed;
            user-select: none;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.3) !important; /* Brilho azul */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8) !important; /* Sombra no texto */
        }
        
        /* Campos edit√°veis */
        .campo-editavel {
            background: #2a2a2a !important;
            border: 1px solid #555555 !important;
            padding: 10px 12px !important;
            border-radius: 4px !important;
            color: #ffffff !important;
            font-weight: 600 !important;
            font-size: 16px !important;
            width: 100% !important;
            text-align: right !important;
            font-family: 'Roboto', 'Open Sans', sans-serif !important;
            transition: all 0.2s ease !important;
        }
        
        /* Placeholder mais suave */
        .campo-editavel::placeholder {
            color: #adb5bd !important;
            font-weight: normal !important;
        }
        
        /* Focus nos campos edit√°veis */
        .campo-editavel:focus {
            outline: none !important;
            border-color: #0056b3 !important;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25) !important;
        }

        /* === CAMPOS QUE PRECISAM SER PREENCHIDOS - Destaque Visual === */
        .campo-pendente {
            background: rgba(0, 227, 140, 0.15) !important; /* Verde transparente */
            border: 1px solid rgba(0, 227, 140, 0.4) !important;
            padding: 10px 12px !important;
            border-radius: 4px !important;
            color: #60a5fa !important; /* Azul ciano para n√∫meros */
            font-weight: 600 !important;
            font-size: 16px !important;
            width: 100% !important;
            text-align: right !important;
            font-family: 'Roboto', 'Open Sans', sans-serif !important;
            box-shadow: 0 0 8px rgba(0, 227, 140, 0.2) !important;
            cursor: text;
            user-select: text;
            pointer-events: auto;
        }

        .campo-pendente:focus {
            background: rgba(0, 227, 140, 0.25) !important;
            border-color: #00E38C !important;
            box-shadow: 0 0 12px rgba(0, 227, 140, 0.4) !important;
            outline: none !important;
        }

        .campo-pendente::placeholder {
            color: rgba(96, 165, 250, 0.7) !important;
            font-style: italic !important;
            font-weight: normal !important;
        }

        /* === SISTEMA DE CADEADO MANUAL === */
        .campo-lock-toggle {
            transition: all 0.3s ease !important;
            z-index: 10;
        }

        .campo-lock-toggle:hover {
            color: #1d4ed8 !important;
            transform: translateY(-50%) scale(1.1) !important;
        }

        .campo-bloqueado-manual {
            background: #374151 !important; /* Fundo cinza escuro */
            border: 2px solid #1e40af !important; /* Borda azul navy */
            color: #ffffff !important;
            cursor: not-allowed !important;
            user-select: none !important;
            pointer-events: none !important;
        }

        .campo-bloqueado-manual:focus {
            outline: none !important;
            box-shadow: 0 0 8px rgba(30, 64, 175, 0.5) !important;
        }

        /* === ESTILOS RANKING ESTAT√çSTICAS === */
        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            color: #333333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }

        .ranking-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .ranking-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .ranking-stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .ranking-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: 700;
            color: #333333;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #333333;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ranking-table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .ranking-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333333;
            padding: 15px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #dee2e6;
        }

        .ranking-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9em;
            color: #333333;
        }

        .ranking-table tbody tr:hover {
            background-color: #f8f9fa;
            transition: background-color 0.3s ease;
        }

        /* Cores por zona */
        .g5-zone {
            background: linear-gradient(90deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 4px solid #28a745;
        }

        .safe-zone {
            background: linear-gradient(90deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 4px solid #ffc107;
        }

        .danger-zone {
            background: linear-gradient(90deg, #f8d7da 0%, #f5c6cb 100%);
            border-left: 4px solid #dc3545;
        }

        .relegation-zone {
            background: linear-gradient(90deg, #d1ecf1 0%, #bee5eb 100%);
            border-left: 4px solid #17a2b8;
        }

        .ppg-destaque {
            font-weight: bold;
            font-size: 1.1em;
            color: #333333;
        }

        .clube-nome {
            font-weight: 600;
            text-align: left !important;
            padding-left: 15px !important;
            color: #333333;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-g5 { background: #d4edda; color: #155724; }
        .status-safe { background: #fff3cd; color: #856404; }
        .status-danger { background: #f8d7da; color: #721c24; }
        .status-relegation { background: #d1ecf1; color: #0c5460; }

        .ranking-legend {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #dee2e6;
            color: #333333;
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #333333;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
            border-left: 4px solid;
        }

        .legend-item.g5-zone .legend-color {
            background: linear-gradient(90deg, #d4edda 0%, #c3e6cb 100%);
            border-left-color: #28a745;
        }

        .legend-item.safe-zone .legend-color {
            background: linear-gradient(90deg, #fff3cd 0%, #ffeaa7 100%);
            border-left-color: #ffc107;
        }

        .legend-item.danger-zone .legend-color {
            background: linear-gradient(90deg, #f8d7da 0%, #f5c6cb 100%);
            border-left-color: #dc3545;
        }

        .legend-item.relegation-zone .legend-color {
            background: linear-gradient(90deg, #d1ecf1 0%, #bee5eb 100%);
            border-left-color: #17a2b8;
        }

        .btn-action {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-view {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333333;
            border: 1px solid #dee2e6;
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .ranking-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .ranking-controls {
                justify-content: center;
            }

            .ranking-table {
                font-size: 0.8em;
            }

            .ranking-table th,
            .ranking-table td {
                padding: 8px 4px;
            }

            .stat-number {
                font-size: 1.8em;
            }
        }

        /* ESTILOS PARA ABA CARTOLA */
        .control-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn-primary, .btn-secondary, .btn-danger {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #A855F7, #9333EA);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
        }

        .btn-secondary {
            background: #6B7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4B5563;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #EF4444;
            color: white;
        }

        .btn-danger:hover {
            background: #DC2626;
            transform: translateY(-2px);
        }

        .status-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .status-item {
            background: #F8FAFC;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #A855F7;
        }

        .status-label {
            font-weight: 600;
            color: #374151;
            display: block;
            margin-bottom: 5px;
        }

        .status-value {
            color: #6B7280;
            font-size: 14px;
        }

        .classifications-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .classification-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .classification-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            background: linear-gradient(135deg, #A855F7, #9333EA);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h4 {
            margin: 0;
            font-size: 16px;
        }

        .status-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        .card-body p {
            margin: 8px 0;
            color: #374151;
            font-size: 14px;
        }

        .comparison-container {
            background: #F8FAFC;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .comparison-placeholder {
            text-align: center;
            color: #6B7280;
            padding: 40px;
        }

        .logs-container {
            background: #1F2937;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-item {
            display: flex;
            gap: 15px;
            padding: 8px 0;
            border-bottom: 1px solid #374151;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .log-time {
            color: #9CA3AF;
            min-width: 80px;
        }

        .log-message {
            color: #E5E7EB;
        }

        .loading-message {
            text-align: center;
            color: #6B7280;
            padding: 40px;
            background: #F8FAFC;
            border-radius: 12px;
            border: 2px dashed #D1D5DB;
        }

        /* ESTILOS PARA TABELAS CARTOLA */
        .classification-table-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        .table th {
            background-color: #F8FAFC;
            font-weight: 600;
            color: #374151;
        }

        .table-striped tbody tr:nth-child(odd) {
            background-color: #F9FAFB;
        }

        .error-message {
            background: #FEF2F2;
            border: 1px solid #FECACA;
            border-radius: 8px;
            padding: 20px;
            color: #DC2626;
            text-align: center;
        }

        .info-message {
            background: #EFF6FF;
            border: 1px solid #BFDBFE;
            border-radius: 8px;
            padding: 20px;
            color: #1D4ED8;
            text-align: center;
        }

        .text-muted {
            color: #6B7280;
            font-size: 14px;
            margin-top: 15px;
            text-align: center;
        }

        /* ESTILOS PARA DROPDOWN */
        .championship-selector {
            margin: 20px 0;
        }

        .form-select {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            background-color: white;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-select:hover {
            border-color: #A855F7;
        }

        .form-select:focus {
            outline: none;
            border-color: #A855F7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }
    </style>
    
    <!-- SAFETY SHIM REMOVIDO TEMPORARIAMENTE -->
</head>
<body>
    <!-- === TELA DE LOGIN === -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <i class="fas fa-shield-alt icon"></i>
            <h1>Acesso Administrativo</h1>
            <p style="margin-bottom: 30px; color: #666;">Central de Dados - Loteca Inteligente</p>
            
            <div class="form-group">
                <label for="adminKey">Chave de Administrador:</label>
                <div style="position: relative; display: flex; align-items: center;">
                    <input type="password" id="adminKey" placeholder="Digite a chave de acesso" style="padding-right: 45px;">
                    <i class="fas fa-eye" id="togglePassword" 
                       style="position: absolute; right: 15px; cursor: pointer; color: #666; font-size: 16px; transition: color 0.3s ease;" 
                       onclick="togglePasswordVisibility()" 
                       title="Mostrar/Ocultar senha"></i>
                </div>
            </div>
            
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Acessar Sistema
            </button>
            
            <div class="error-message" id="loginError">
                <i class="fas fa-exclamation-triangle"></i> Chave de acesso inv√°lida!
            </div>
        </div>
    </div>

    <!-- === INTERFACE PRINCIPAL === -->
    <div class="admin-container" id="adminContainer">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-database"></i>
                Central Admin - Loteca Inteligente
            </h1>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>

        
        <!-- Bot√£o Debug removido - fun√ß√£o desnecess√°ria -->

        <!-- Mensagens -->
        <div class="success-message" id="successMessage">
            <i class="fas fa-check-circle"></i> <span id="successText"></span>
        </div>
        <div class="error-alert" id="errorMessage">
            <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
        </div>

        <!-- Abas -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('jogos-loteca')">
                <i class="fas fa-gamepad"></i> Jogos Loteca
            </button>
            <button class="tab" onclick="showTab('classificacao')">
                <i class="fas fa-table"></i> Classifica√ß√£o
            </button>
            <button class="tab" onclick="showTab('clubes')">
                <i class="fas fa-users"></i> Clubes
            </button>
            <button class="tab" onclick="showTab('ranking-estatisticas')">
                <i class="fas fa-trophy"></i> Ranking Estat√≠sticas
            </button>
            <button class="tab" onclick="showTab('estatisticas')">
                <i class="fas fa-chart-bar"></i> Estat√≠sticas
            </button>
            <button class="tab" onclick="showTab('analise-rapida')">
                <i class="fas fa-table"></i> Planilha An√°lise R√°pida
            </button>
            <button class="tab" onclick="showTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="tab" onclick="showTab('backup')">
                <i class="fas fa-download"></i> Backup
            </button>
        </div>

        <!-- === ABA CLASSIFICA√á√ÉO === -->
        <div class="tab-content" id="classificacao">
            <h2 style="margin-bottom: 25px; color: #333;">
                <i class="fas fa-table"></i> Gest√£o de Classifica√ß√£o
            </h2>
            
            <!-- Seletor de Campeonato -->
            <div class="form-row">
                <div class="input-group">
                    <label>Campeonato</label>
                    <select id="campeonatoSelect" onchange="alterarCampeonato()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: 2px solid #4c51bf; padding: 10px; border-radius: 8px; font-weight: bold;">
                        <option value="serie-a" style="background: #4c51bf; color: white;">ü•á Brasileir√£o S√©rie A</option>
                        <option value="serie-b" style="background: #6b46c1; color: white;">ü•à Brasileir√£o S√©rie B</option>
                        <option value="premier-league" style="background: #1e40af; color: white;">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Premier League</option>
                        <option value="la-liga" style="background: #dc2626; color: white;">üá™üá∏ La Liga</option>
                        <option value="ligue1" style="background: #0f172a; color: white;">üá´üá∑ Ligue 1</option>
                        <option value="champions-league" style="background: #fbbf24; color: white;">üèÜ Champions League</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Rodada</label>
                    <input type="number" id="rodadaInput" placeholder="Ex: 25" min="1" max="38">
                </div>
            </div>
            
            <!-- √Årea de Classifica√ß√£o -->
            <div class="classification-area">
                <div class="loading-message" id="loadingClassificacao" style="display: none; color: #00ff00; font-weight: bold;">
                    <i class="fas fa-spinner fa-spin"></i> üîÑ Carregando classifica√ß√£o...
                </div>
                
                <table class="data-table" id="tabelaClassificacao" style="border: 2px solid #374151; width: 100%; border-collapse: collapse;">
                    <thead style="background: linear-gradient(135deg, #1f2937, #374151); color: white;">
                        <tr>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">Pos</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">Time</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">P</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">J</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">V</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">E</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">D</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">GP</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">GC</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">SG</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">%</th>
                            <th style="padding: 12px 8px; font-weight: bold; font-size: 14px; border: 1px solid #4b5563;">√öltimos</th>
                        </tr>
                    </thead>
                    <tbody id="classificacaoBody" style="border: 2px solid #ff0000; min-height: 200px;">
                        <!-- üéØ DEBUG: Dados da classifica√ß√£o ser√£o inseridos aqui -->
                        <tr><td colspan="12" style="text-align: center; padding: 20px; color: #ff0000; font-weight: bold;">üîç AGUARDANDO DADOS...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Bot√µes de A√ß√£o -->
            <div class="form-row" style="margin-top: 20px;">
                <button class="btn-primary" onclick="carregarClassificacao()" style="background: #00ff00; color: black;">
                    <i class="fas fa-sync"></i> üîÑ Atualizar Classifica√ß√£o
                </button>
                <button class="btn-warning" onclick="atualizarUltimosConfrontosManual()" style="background: #f59e0b; color: white;">
                    <i class="fas fa-database"></i> üîÑ Atualizar √öltimos Confrontos
                </button>
                <button class="btn-success" onclick="salvarClassificacao()">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
                <!-- Bot√£o TESTE DEBUG removido - fun√ß√£o desnecess√°ria -->
            </div>
        </div>

        <!-- === ABA JOGOS LOTECA === -->
        <div class="tab-content active" id="jogos-loteca">
            <h2 style="margin-bottom: 25px; color: var(--cor-destaque-primaria); display: flex; align-items: center; gap: 15px; font-weight: 800;">
                <i class="fas fa-gamepad"></i> Gest√£o de Jogos Loteca
            </h2>
            

            <!-- INFORMA√á√ïES DO CONCURSO -->
            <div class="form-row" style="margin-bottom: 30px;">
                <div class="form-group" style="flex: 1; margin-right: 15px;">
                    <label>Concurso N¬∫:</label>
                    <input type="number" id="numeroConcurso" class="form-control" placeholder="1213" value="1213">
                </div>
                <div class="form-group" style="flex: 2; margin-right: 15px;">
                    <label>Per√≠odo de Apostas:</label>
                    <input type="text" id="periodoApostas" class="form-control" placeholder="24/09/2025 at√© 15h do dia 27/09/2025" value="24/09/2025 at√© 15h do dia 27/09/2025">
                </div>
                <div class="form-group" style="flex: 2; margin-right: 15px;">
                    <label>Realiza√ß√£o dos Jogos:</label>
                    <input type="text" id="realizacaoJogos" class="form-control" placeholder="27/09/2025 a 28/09/2025" value="27/09/2025 a 28/09/2025">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>&nbsp;</label>
                    <button class="btn-primary" onclick="atualizarInformacoesConcurso()" style="width: 100%; padding: 10px; background: var(--cor-destaque-primaria); border: none; color: white; border-radius: 8px; font-weight: bold;">
                        <i class="fas fa-sync"></i> Atualizar
                    </button>
                </div>
            </div>

            <!-- VOLANTE DA LOTECA - R√âPLICA DA CAIXA -->
            <div class="loteca-volante" style="background: white; border: 2px solid #0066cc; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                <div class="volante-header" style="text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #0066cc;">
                    <h3 style="color: #0066cc; margin: 0; font-weight: bold;">
                        Concurso <span id="displayConcurso">1213</span>
                    </h3>
                    <p style="color: #666; margin: 5px 0 0 0; font-size: 14px;">
                        Per√≠odo de apostas: <span id="displayPeriodo">24/09/2025 at√© as 15h do dia 27/09/2025</span>
                    </p>
                    <p style="color: #666; margin: 5px 0 0 0; font-size: 14px;">
                        Realiza√ß√£o dos jogos de futebol: <span id="displayRealizacao">27/09/2025 a 28/09/2025</span>
                    </p>
                </div>

                <!-- TABELA DOS JOGOS -->
                <div class="table-responsive">
                    <table class="loteca-table" style="width: 100%; border-collapse: collapse; border: 1px solid #0066cc;">
                        <thead>
                            <tr style="background: #0066cc; color: white;">
                                <th style="padding: 10px; text-align: center; border: 1px solid #0066cc; width: 60px;">Jogo</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #0066cc; width: 35%;">Coluna 1</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #0066cc; width: 60px;">x</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #0066cc; width: 35%;">Coluna 2</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #0066cc; width: 15%;">Data</th>
                            </tr>
                        </thead>
                        <tbody id="lotecaJogos">
                            <!-- Os 14 jogos ser√£o inseridos aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- BOT√ïES DE A√á√ÉO -->
            <div class="form-row" style="margin-top: 20px; justify-content: center; gap: 15px;">
                <button class="btn-primary" onclick="abrirSeletorCSV()" style="background: #FF6B35;">
                    <i class="fas fa-file-csv"></i> Carregar Concurso CSV
                </button>
                <button class="btn-success" onclick="salvarDadosManualmente()" style="background: #28a745; color: white;">
                    <i class="fas fa-save"></i> Salvar Dados
                </button>
            </div>
        </div>

        <!-- === ABA CLUBES - ESTAT√çSTICAS DETALHADAS === -->
        <div class="tab-content" id="clubes">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #6f42c1; font-weight: 600; text-shadow: 0 2px 4px rgba(111, 66, 193, 0.3); margin: 0;">
                    <i class="fas fa-chart-line" style="margin-right: 10px;"></i> Estat√≠sticas Detalhadas dos Clubes
                </h2>
                <button id="btnTabelaJogos" class="btn-primary" onclick="abrirTabelaJogos()" style="background: linear-gradient(135deg, #00E38C, #00B377); display: none;">
                    <i class="fas fa-table" style="margin-right: 8px;"></i> Tabela de Jogos
                </button>
            </div>
            
            <!-- Seletor de Clube -->
            <div class="form-row" style="margin-bottom: 30px;">
                <div class="input-group" style="flex: 1;">
                    <label>Selecionar Clube</label>
                    <select id="clubeEstatisticas" onchange="carregarEstatisticasClube()">
                        <option value="">Escolha um clube...</option>
                        <option value="flamengo">üî• Flamengo</option>
                        <option value="corinthians">‚ö´ Corinthians</option>
                        <option value="palmeiras">üü¢ Palmeiras</option>
                        <option value="cruzeiro">üîµ Cruzeiro</option>
                        <option value="mirassol">üü° Mirassol</option>
                        <option value="bahia">üî¥ Bahia</option>
                        <option value="botafogo">‚ö´ Botafogo</option>
                        <option value="fluminense">üî¥ Fluminense</option>
                        <option value="sao-paulo">üî¥ S√£o Paulo</option>
                        <option value="gremio">üîµ Gr√™mio</option>
                        <option value="red-bull-bragantino">üî¥ RB Bragantino</option>
                        <option value="atletico-mg">‚ö´ Atl√©tico-MG</option>
                        <option value="ceara">‚ö´ Cear√°</option>
                        <option value="vasco">‚ö´ Vasco</option>
                        <option value="internacional">üî¥ Internacional</option>
                        <option value="santos">‚ö™ Santos</option>
                        <option value="juventude">üü¢ Juventude</option>
                        <option value="vitoria">üî¥ Vit√≥ria</option>
                        <option value="fortaleza">üî¥ Fortaleza</option>
                        <option value="sport-recife">üî¥ Sport Recife</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>&nbsp;</label>
                    <button class="btn-primary" onclick="carregarEstatisticasClube()">
                        <i class="fas fa-sync"></i> Carregar Dados
                    </button>
                </div>
            </div>

            <!-- Tabela de Estat√≠sticas -->
            <div id="formularioEstatisticas" style="display: none;">
                
                <table class="data-table" id="tabelaEstatisticas">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #6f42c1, #8b5cf6); color: white;">
                            <th colspan="4" style="text-align: center; font-size: 18px; padding: 15px;">
                                üìä Estat√≠sticas Detalhadas do Clube
                            </th>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <th style="width: 25%;">Campo</th>
                            <th style="width: 25%;">Valor</th>
                            <th style="width: 25%;">Campo</th>
                            <th style="width: 25%;">Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- DADOS B√ÅSICOS -->
                        <tr>
                            <td><strong>Posi√ß√£o Atual</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="posicaoAtual" placeholder="Ex: 2" min="1" max="20" readonly class="campo-bloqueado"></td>
                            <td><strong>Pontos Total</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="pontosTotal" placeholder="Ex: 58" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>Jogos Disputados</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="jogosDisputados" placeholder="Ex: 28" readonly class="campo-bloqueado"></td>
                            <td><strong>PPG</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i><span class="help-icon" onclick="mostrarAjuda('ppg')" title="Clique para saber mais sobre PPG">?</span></td>
                            <td><input type="text" id="ppg" readonly class="campo-bloqueado"></td>
                        </tr>
                        
                        <!-- PERFORMANCE GERAL -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Performance Geral</td>
                        </tr>
                        <tr>
                            <td><strong>Vit√≥rias</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="vitorias" placeholder="" readonly class="campo-bloqueado"></td>
                            <td><strong>Empates</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="empates" placeholder="" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>Derrotas</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="derrotas" placeholder="" readonly class="campo-bloqueado"></td>
                            <td><strong>% Vit√≥rias</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="percentualVitorias" readonly class="campo-bloqueado"></td>
                        </tr>

                        <!-- DADOS OFENSIVOS -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Dados Ofensivos</td>
                        </tr>
                        <tr>
                            <td><strong>Gols Marcados</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="golsMarcados" placeholder="Ex: 52" readonly class="campo-bloqueado"></td>
                            <td><strong>M√©dia Gols</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="mediaGols" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>üîí Chutes por Jogo</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Dados FootMob 2025 - Fonte Oficial"></i></td>
                            <td><input type="number" step="0.1" id="chutesPorJogo" placeholder="5.7" readonly class="campo-bloqueado"></td>
                            <td><strong>üîí Posse de Bola (%)</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Dados FootMob 2025 - Fonte Oficial"></i></td>
                            <td><input type="number" step="0.1" id="posseBola" placeholder="62.2" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>üîí Passes Certos</strong> <i class="fas fa-exchange-alt" style="color: #3b82f6;" title="N√∫mero m√©dio de passes certos por jogo"></i> <i class="fas fa-lock" style="color: #ef4444; font-size: 0.8rem;" title="Campo preenchido automaticamente da planilha"></i></td>
                            <td style="position: relative;">
                                <input type="number" id="passesCertos" placeholder="385" class="campo-bloqueado">
                                <i class="fas fa-unlock campo-lock-toggle" data-field="passesCertos" onclick="toggleLock('passesCertos')" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #1e40af; cursor: pointer; display: none;" title="Clique para bloquear campo"></i>
                            </td>
                            <td colspan="2" style="color: #6b7280; font-style: italic; text-align: center; padding: 12px;">
                                üìä Dados FootMob 2025 - Fonte Oficial
                            </td>
                        </tr>

                        <!-- DADOS DEFENSIVOS -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Dados Defensivos</td>
                        </tr>
                        <tr>
                            <td><strong>Gols Sofridos</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="number" id="golsSofridos" placeholder="Ex: 32" readonly class="campo-bloqueado"></td>
                            <td><strong>M√©dia Sofridos</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="mediaSofridos" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>Jogos sem sofrer gols (total)</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i><span class="help-icon" onclick="mostrarAjuda('cleansheet')" title="Clique para saber mais sobre jogos sem sofrer gols">?</span></td>
                            <td><input type="number" id="cleanSheets" readonly class="campo-bloqueado"></td>
                            <td><strong>Jogos sem sofrer gols (%)</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="percentualCleanSheets" readonly class="campo-bloqueado"></td>
                        </tr>

                        <!-- MANDANTE vs VISITANTE -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Mandante vs Visitante</td>
                        </tr>
                        <tr>
                            <td><strong>PPG Casa</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i><span class="help-icon" onclick="mostrarAjuda('ppg_casa')" title="Clique para saber mais sobre PPG Casa">?</span></td>
                            <td><input type="number" step="0.01" id="ppgCasa" readonly class="campo-bloqueado"></td>
                            <td><strong>PPG Fora</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i><span class="help-icon" onclick="mostrarAjuda('ppg_fora')" title="Clique para saber mais sobre PPG Fora">?</span></td>
                            <td><input type="number" step="0.01" id="ppgFora" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>Aproveitamento Casa (%)</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="aproveitamentoCasa" readonly class="campo-bloqueado"></td>
                            <td><strong>Aproveitamento Fora (%)</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="aproveitamentoFora" readonly class="campo-bloqueado"></td>
                        </tr>

                        <!-- FORMA RECENTE -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Forma Recente</td>
                        </tr>
                        <tr>
                            <td><strong>√öltimos 5 Jogos</strong> <i class="fas fa-lock" style="color: #fbbf24; margin-left: 8px;" title="Campo fixo - Dados da Tabela de Classifica√ß√£o"></i></td>
                            <td><input type="text" id="formaUltimos5" placeholder="Ex: V-V-E-E-D" maxlength="11" readonly class="campo-bloqueado"></td>
                            <td><strong>Pontos √öltimos 5</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i></td>
                            <td><input type="text" id="pontosUltimos5" readonly class="campo-bloqueado"></td>
                        </tr>
                        <tr>
                            <td><strong>Efici√™ncia Ofensiva (%)</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i><span class="help-icon" onclick="mostrarAjuda('eficiencia_ofensiva')" title="Clique para saber mais sobre Efici√™ncia Ofensiva">?</span></td>
                            <td><input type="text" id="eficienciaOfensiva" readonly class="campo-bloqueado"></td>
                            <td><strong>Solidez Defensiva</strong> <i class="fas fa-lock" style="color: #00E38C; margin-left: 8px;" title="Calculado automaticamente da tabela de jogos"></i><span class="help-icon" onclick="mostrarAjuda('solidez_defensiva')" title="Clique para saber mais sobre Solidez Defensiva">?</span></td>
                            <td><input type="text" id="solidezDefensiva" readonly class="campo-bloqueado"></td>
                        </tr>

                        <!-- ESTAT√çSTICA PLANTEL -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Estat√≠stica Plantel</td>
                        </tr>
                        <tr>
                            <td><strong>üîí Elenco Total</strong> <i class="fas fa-edit" style="color: #007bff;" title="Campo Edit√°vel - Dados Complementares"></i> <i class="fas fa-lock" style="color: #ef4444; font-size: 0.8rem;" title="Campo preenchido automaticamente da planilha"></i></td>
                            <td style="position: relative;">
                                <input type="number" id="elencoTotal" placeholder="40" class="campo-bloqueado">
                                <i class="fas fa-unlock campo-lock-toggle" data-field="elencoTotal" onclick="toggleLock('elencoTotal')" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #1e40af; cursor: pointer; display: none;" title="Clique para bloquear campo"></i>
                            </td>
                            <td><strong>‚úèÔ∏è % Prov√°veis</strong> <i class="fas fa-users" style="color: #007bff;" title="Percentual de jogadores prov√°veis/confirmados para jogar"></i></td>
                            <td style="position: relative;">
                                <input type="number" step="0.1" id="pctProvaveis" placeholder="Ex: 42.5" class="campo-editavel">
                                <i class="fas fa-unlock campo-lock-toggle" data-field="pctProvaveis" onclick="toggleLock('pctProvaveis')" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #1e40af; cursor: pointer; display: none;" title="Clique para bloquear campo"></i>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>üîí Valor Elenco (MM ‚Ç¨)</strong> <i class="fas fa-euro-sign" style="color: #10b981;" title="Valor total do elenco em milh√µes de euros"></i> <i class="fas fa-lock" style="color: #ef4444; font-size: 0.8rem;" title="Campo preenchido automaticamente da planilha"></i></td>
                            <td style="position: relative;">
                                <input type="number" step="0.1" id="valorElenco" placeholder="85.0" class="campo-bloqueado">
                                <i class="fas fa-unlock campo-lock-toggle" data-field="valorElenco" onclick="toggleLock('valorElenco')" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #1e40af; cursor: pointer; display: none;" title="Clique para bloquear campo"></i>
                            </td>
                            <td><strong>üîí Valor M√©dio Elenco</strong> <i class="fas fa-calculator" style="color: #10b981;" title="Valor m√©dio por jogador"></i> <i class="fas fa-lock" style="color: #ef4444; font-size: 0.8rem;" title="Campo preenchido automaticamente da planilha"></i></td>
                            <td style="position: relative;">
                                <input type="number" step="0.1" id="ratingMedio" placeholder="4.6" class="campo-bloqueado">
                                <i class="fas fa-unlock campo-lock-toggle" data-field="ratingMedio" onclick="toggleLock('ratingMedio')" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #1e40af; cursor: pointer; display: none;" title="Clique para bloquear campo"></i>
                            </td>
                        </tr>


                        <!-- CONTEXTO ATUAL -->
                        <tr style="background: #333333;">
                            <td colspan="4" style="text-align: left; font-weight: 400; color: #ffffff; padding: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Contexto Atual</td>
                        </tr>
                        <tr>
                            <td><strong>‚úèÔ∏è Desfalques Importantes</strong> <i class="fas fa-edit" style="color: #007bff;" title="Campo Edit√°vel - Dados Complementares"></i></td>
                            <td colspan="3"><input type="text" id="desfalques" placeholder="Ex: Arrascaeta (les√£o), Vi√±a (suspenso)" class="campo-editavel"></td>
                        </tr>
                        <tr>
                            <td><strong>‚úèÔ∏è Motiva√ß√£o Atual</strong> <i class="fas fa-edit" style="color: #007bff;" title="Campo Edit√°vel - Dados Complementares"></i></td>
                            <td colspan="3"><input type="text" id="motivacao" placeholder="Ex: Briga pelo t√≠tulo - 6 pts do l√≠der" class="campo-editavel"></td>
                        </tr>
                        <tr>
                            <td><strong>‚úèÔ∏è Pr√≥ximos Jogos</strong> <i class="fas fa-edit" style="color: #007bff;" title="Campo Edit√°vel - Dados Complementares"></i></td>
                            <td colspan="3"><input type="text" id="proximosJogos" placeholder="Ex: COR(f), PAL(c), BOT(f)" class="campo-editavel"></td>
                        </tr>
                    </tbody>
                </table>

                <!-- BOT√ïES DE A√á√ÉO -->
                <div style="margin-top: 30px; text-align: center; padding: 20px; background: #000000; border-radius: 15px; border: 1px solid #333333;">
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="salvarEstatisticas()" style="background: linear-gradient(135deg, #00E38C, #00B377); color: white;">
                            <i class="fas fa-save"></i> Salvar Estat√≠sticas
                        </button>
                    </div>
                </div>

            </div>

            <!-- Mensagem quando nenhum clube selecionado -->
            <div id="mensagemSelecionar" class="empty-state">
                <i class="fas fa-chart-line" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                <h3>Selecione um clube para come√ßar</h3>
                <p>Escolha um clube no seletor acima para preencher suas estat√≠sticas detalhadas</p>
            </div>

        </div>

        <!-- === ABA RANKING ESTAT√çSTICAS === -->
        <div class="tab-content" id="ranking-estatisticas">
            <div class="ranking-header">
                <h2 style="color: #333333; font-weight: 600; text-shadow: none; margin: 0;">
                    <i class="fas fa-trophy" style="margin-right: 10px; color: #333333;"></i> Ranking Completo - An√°lise T√©cnica
                </h2>
                <div class="ranking-controls">
                    <button class="btn-primary" onclick="atualizarRanking()" style="background: linear-gradient(135deg, #00E38C, #00B377);">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados
                    </button>
                    <button class="btn-primary" onclick="exportarParaLoteca()" style="background: linear-gradient(135deg, #667eea, #764ba2); margin-left: 10px;">
                        <i class="fas fa-upload"></i> Exportar p/ Loteca X-Ray
                    </button>
                    <select id="ordenarPor" onchange="ordenarRanking()" style="margin-left: 10px; padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; background: white;">
                        <option value="ppg_total">PPG Total</option>
                        <option value="pontos">Pontos</option>
                        <option value="ppg_casa">PPG Casa</option>
                        <option value="ppg_fora">PPG Fora</option>
                        <option value="aproveitamento_casa">Casa %</option>
                        <option value="aproveitamento_fora">Fora %</option>
                    </select>
                </div>
            </div>
            
            <div class="ranking-stats">
                <div class="ranking-stat-card">
                    <div class="stat-number" id="totalClubes">22</div>
                    <div class="stat-label">Clubes Analisados</div>
                </div>
                <div class="ranking-stat-card">
                    <div class="stat-number" id="ultimaAtualizacao">--:--</div>
                    <div class="stat-label">√öltima Atualiza√ß√£o</div>
                </div>
                <div class="ranking-stat-card">
                    <div class="stat-number" id="liderAtual">--</div>
                    <div class="stat-label">L√≠der T√©cnico</div>
                </div>
                <div class="ranking-stat-card">
                    <div class="stat-number" id="zonaRebaixamento">4</div>
                    <div class="stat-label">Zona Rebaixamento</div>
                </div>
            </div>
            
            <div class="ranking-table-container">
                <table id="rankingTable" class="ranking-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">Pos</th>
                            <th style="width: 200px;">Clube</th>
                            <th style="width: 60px;">Pts</th>
                            <th style="width: 60px;">Jogos</th>
                            <th style="width: 80px;">PPG Total</th>
                            <th style="width: 80px;">PPG Casa</th>
                            <th style="width: 80px;">PPG Fora</th>
                            <th style="width: 80px;">Casa %</th>
                            <th style="width: 80px;">Fora %</th>
                            <th style="width: 100px;">Status</th>
                            <th style="width: 80px;">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <tr>
                            <td colspan="11" style="text-align: center; padding: 40px; color: #666;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i><br>
                                Carregando dados dos clubes...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="ranking-legend">
                <h3 style="margin-bottom: 15px; color: #333333;">
                    <i class="fas fa-info-circle" style="color: #333333;"></i> Legenda de Status
                </h3>
                <div class="legend-items">
                    <div class="legend-item g5-zone">
                        <span class="legend-color"></span>
                        <span>G5 - Libertadores (PPG ‚â• 1.60)</span>
                    </div>
                    <div class="legend-item safe-zone">
                        <span class="legend-color"></span>
                        <span>Meio de Tabela (PPG 1.20-1.59)</span>
                    </div>
                    <div class="legend-item danger-zone">
                        <span class="legend-color"></span>
                        <span>Zona de Risco (PPG 0.90-1.19)</span>
                    </div>
                    <div class="legend-item relegation-zone">
                        <span class="legend-color"></span>
                        <span>Rebaixamento (PPG < 0.90)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- === ABA ESTAT√çSTICAS === -->
        <div class="tab-content" id="estatisticas">
            <h2 style="margin-bottom: 25px; color: #333;">
                <i class="fas fa-chart-bar"></i> Gest√£o de Estat√≠sticas
            </h2>
            
            <div class="form-row">
                <div class="input-group">
                    <label>Selecionar Clube</label>
                    <select id="clubeEstatisticasResumo">
                        <option value="">Carregando clubes...</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Total de Atletas</label>
                    <input type="number" id="totalAtletas" placeholder="Ex: 40">
                </div>
                <div class="input-group">
                    <label>% Prov√°veis</label>
                    <input type="number" id="pctProvaveisResumo" placeholder="Ex: 35.5" step="0.1" min="0" max="100">
                </div>
                <div class="input-group">
                    <label>M√©dia Pontos</label>
                    <input type="number" id="mediaPontos" placeholder="Ex: 4.58" step="0.01" min="0" max="10">
                </div>
            </div>

            <div class="form-row">
                <div class="input-group">
                    <label>Pre√ßo M√©dio (C$)</label>
                    <input type="number" id="precoMedio" placeholder="Ex: 6.75" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label>Rating (0-1)</label>
                    <input type="number" id="rating" placeholder="Ex: 0.458" step="0.001" min="0" max="1">
                </div>
                <div class="input-group">
                    <label>Fonte</label>
                    <select id="fonte">
                        <option value="MANUAL">Manual</option>
                        <option value="CARTOLA">Cartola FC</option>
                        <option value="OUTRO">Outro</option>
                    </select>
                </div>
            </div>

            <button class="btn-primary" onclick="salvarEstatisticas()">
                <i class="fas fa-save"></i> Salvar Estat√≠sticas
            </button>

            <!-- Lista de Estat√≠sticas -->
            <div class="loading" id="loadingEstatisticas">
                <i class="fas fa-spinner"></i>
                <div>Carregando estat√≠sticas...</div>
            </div>

            <table class="data-table" id="tableEstatisticas" style="display: none;">
                <thead>
                    <tr>
                        <th>Clube</th>
                        <th>Atletas</th>
                        <th>% Prov√°veis</th>
                        <th>M√©dia Pontos</th>
                        <th>Pre√ßo M√©dio</th>
                        <th>Rating</th>
                        <th>Fonte</th>
                        <th>Atualiza√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tbodyEstatisticas">
                </tbody>
            </table>
        </div>

        <!-- === ABA CARTOLA === -->
        <div class="tab-content" id="analise-rapida">
            <h2 style="margin-bottom: 25px; color: var(--cor-destaque-primaria); display: flex; align-items: center; gap: 15px; font-weight: 800;">
                <i class="fas fa-table"></i> Planilha An√°lise R√°pida
            </h2>
            
            <!-- CONTROLES -->
            <div class="admin-section">
                <div class="control-buttons">
                    <button id="btn-sincronizar-analise" class="btn-secondary" onclick="sincronizarAnaliseRapida()" style="background: #666; color: white; font-weight: bold; border: 2px solid #555;" title="M√©todo secund√°rio - Use 'Salvar Dados do Jogo' como principal">
                        <i class="fas fa-sync"></i> Sincronizar com Site (Secund√°rio)
                    </button>
                    <button id="btn-calcular-estatisticas" class="btn-success" onclick="calcularEstatisticasAnalise()" style="background: #00ff00; color: black; font-weight: bold; border: 2px solid #00cc00;">
                        <i class="fas fa-calculator"></i> Calcular Estat√≠sticas
                    </button>
                    <button class="btn-success" onclick="salvarTodosJogos()" style="background: #ff6600; color: white; font-weight: bold; border: 2px solid #ff4400;">
                        <i class="fas fa-save"></i> Salvar Todos os 14 Jogos
                    </button>
                </div>
            </div>

            <!-- SELE√á√ÉO DE JOGO -->
            <div class="admin-section">
                <h3>üéÆ Selecione o Jogo para An√°lise</h3>
                <div class="form-group" style="display: flex; align-items: center; gap: 12px;">
                    <select id="jogo-analise-select" class="form-select" onchange="carregarDadosJogo()" style="flex: 0 0 70%; min-width: 400px;">
                        <option value="">üìã Selecionar jogo...</option>
                        <option value="1">JOGO 1 - Ponte Preta/SP vs Guarani/RJ</option>
                        <option value="2">JOGO 2 - Fortaleza/CE vs Sport/PE</option>
                        <option value="3">JOGO 3 - Juventude/RS vs Internacional/RS</option>
                        <option value="4">JOGO 4 - Vasco da Gama/RJ vs Cruzeiro/MG</option>
                        <option value="5">JOGO 5 - Athletico/PR vs Oper√°rio/PR</option>
                        <option value="6">JOGO 6 - Atl√©tico/MG vs Mirassol/SP</option>
                        <option value="7">JOGO 7 - Gr√™mio/RS vs Vit√≥ria/BA</option>
                        <option value="8">JOGO 8 - Aston Villa vs Fulham</option>
                        <option value="9">JOGO 9 - Bahia/BA vs Palmeiras/SP</option>
                        <option value="10">JOGO 10 - Fluminense/RJ vs Botafogo/RJ</option>
                        <option value="11">JOGO 11 - Crici√∫ma/SC vs Paysandu/PA</option>
                        <option value="12">JOGO 12 - Newcastle vs Arsenal</option>
                        <option value="13">JOGO 13 - Bragantino/SP vs Santos/SP</option>
                        <option value="14">JOGO 14 - Barcelona vs Real Sociedad</option>
                    </select>
                    <button onclick="carregarDadosJogoExistente()" class="btn btn-success" style="background: linear-gradient(135deg, #00ff00, #00cc00); border: none; color: white; padding: 8px 16px; border-radius: 8px; font-weight: bold; white-space: nowrap; flex: 0 0 auto; font-size: 0.9rem; height: 38px; min-width: 120px; max-width: 150px;">
                        <i class="fas fa-download"></i> Carregar
                    </button>
                </div>
            </div>

            <!-- DADOS DO JOGO SELECIONADO -->
            <div class="admin-section" id="dados-jogo-container" style="display: none;">
                <h3 id="titulo-jogo">üéØ Dados do Jogo</h3>
                
                <!-- INFORMA√á√ïES B√ÅSICAS -->
                <div class="form-section">
                    <h4>üìã Informa√ß√µes B√°sicas</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Time Casa:</label>
                            <input type="text" id="time-casa-admin" class="form-control" placeholder="Ex: Ponte Preta/SP">
                    </div>
                        <div class="form-group">
                            <label>Time Fora:</label>
                            <input type="text" id="time-fora-admin" class="form-control" placeholder="Ex: Guarani/RJ">
                        </div>
                    </div>
                    
                    <!-- ESCUDOS DOS TIMES -->
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Escudo Time Casa:</label>
                            <input type="text" id="escudo-casa-path" class="form-control" value="/static/escudos/" placeholder="Digite o nome do time (ex: PAL_Palmeiras/Palmeiras.png)" onchange="atualizarPreviewEscudo('casa')">
                            <small class="form-text">Caminho completo do arquivo do escudo</small>
                        </div>
                        <div class="form-group" style="flex: 0 0 120px; text-align: center;">
                            <label>Preview:</label>
                            <div style="width: 80px; height: 80px; border: 2px solid var(--cor-borda); border-radius: 8px; display: flex; align-items: center; justify-content: center; background: var(--cor-fundo); margin: 0 auto;">
                                <img id="preview-escudo-casa" src="/static/placeholder-team-logo.svg" alt="Escudo Casa" style="max-width: 70px; max-height: 70px; object-fit: contain;" onerror="this.src='/static/placeholder-team-logo.svg'">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Escudo Time Fora:</label>
                            <input type="text" id="escudo-fora-path" class="form-control" value="/static/escudos/" placeholder="Digite o nome do time (ex: JUV_Juventude/Juventude.png)" onchange="atualizarPreviewEscudo('fora')">
                            <small class="form-text">Caminho completo do arquivo do escudo</small>
                        </div>
                        <div class="form-group" style="flex: 0 0 120px; text-align: center;">
                            <label>Preview:</label>
                            <div style="width: 80px; height: 80px; border: 2px solid var(--cor-borda); border-radius: 8px; display: flex; align-items: center; justify-content: center; background: var(--cor-fundo); margin: 0 auto;">
                                <img id="preview-escudo-fora" src="/static/placeholder-team-logo.svg" alt="Escudo Fora" style="max-width: 70px; max-height: 70px; object-fit: contain;" onerror="this.src='/static/placeholder-team-logo.svg'">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Arena/Est√°dio:</label>
                            <input type="text" id="arena-admin" class="form-control" placeholder="Ex: Neo Qu√≠mica Arena">
                        </div>
                        <div class="form-group">
                            <label>Campeonato:</label>
                            <input type="text" id="campeonato-admin" class="form-control" placeholder="Ex: Brasileir√£o S√©rie A">
                        </div>
                        <div class="form-group">
                            <label>Dia da Semana:</label>
                            <select id="dia-admin" class="form-control" style="height: 38px; padding: 8px 12px; font-size: 1rem; min-width: 150px;">
                                <option value="S√°bado">S√°bado</option>
                                <option value="Domingo">Domingo</option>
                                <option value="Segunda">Segunda</option>
                                <option value="Ter√ßa">Ter√ßa</option>
                                <option value="Quarta">Quarta</option>
                                <option value="Quinta">Quinta</option>
                                <option value="Sexta">Sexta</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- PROBABILIDADES -->
                <div class="form-section">
                    <h4>üìä Probabilidades</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Coluna 1 (Time Casa) - %:</label>
                            <input type="number" id="prob-col1-admin" class="form-control" min="0" max="100" step="0.1" placeholder="Ex: 45.2">
                        </div>
                        <div class="form-group">
                            <label>Coluna X (Empate) - %:</label>
                            <input type="number" id="prob-colX-admin" class="form-control" min="0" max="100" step="0.1" placeholder="Ex: 28.5">
                        </div>
                        <div class="form-group">
                            <label>Coluna 2 (Time Fora) - %:</label>
                            <input type="number" id="prob-col2-admin" class="form-control" min="0" max="100" step="0.1" placeholder="Ex: 26.3">
                        </div>
                    </div>
                </div>

                <!-- RECOMENDA√á√ÉO -->
                <div class="form-section" style="border-top: 3px solid #32CD32;">
                    <h4 style="color: #A855F7;">üí° Recomenda√ß√£o</h4>
                    <div class="form-group" style="width: 100%;">
                        <label style="color: #94a3b8;">Recomenda√ß√£o Estat√≠stica:</label>
                        <textarea id="recomendacao-admin" class="form-control" rows="6" style="min-height: 120px; resize: vertical; width: 100%; max-width: none;" placeholder="Ex: Baseado na an√°lise dos √∫ltimos confrontos e posi√ß√£o na tabela, recomendamos..."></textarea>
                    </div>
                </div>

                <!-- AN√ÅLISE DETALHADA -->
                <div class="form-section">
                    <h4>üëä Confronto Direto</h4>
                    
                    <!-- ARQUIVO DE CONFRONTOS -->
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Arquivo de Confrontos:</label>
                            <div style="display: flex; gap: 15px; align-items: stretch;">
                                <input type="text" id="arquivo-confrontos-base" class="form-control" value="\0 - Loteca\backend\models\Confrontos\" readonly style="flex: 0 0 250px; background: #2a2a2a; color: #cccccc; border: 1px solid #444; font-size: 0.9rem; height: 38px;">
                                <select id="arquivo-confrontos-select" class="form-control" onchange="selecionarArquivoConfronto()" style="flex: 1; min-width: 200px; height: 38px; padding: 8px 12px;">
                                    <option value="">Selecione um arquivo CSV...</option>
                                </select>
                                <button class="btn-primary" onclick="carregarConfrontos()" style="flex: 0 0 80px; padding: 8px 12px; margin-left: 10px; height: 38px;">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                            <small class="form-text">Selecione o arquivo CSV com hist√≥rico de confrontos</small>
                        </div>
                    </div>
                    
                    <!-- PREVIEW DOS √öLTIMOS CONFRONTOS -->
                    <div id="preview-confrontos" style="display: none; background: var(--cor-fundo-card); border: 1px solid var(--cor-borda); border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                        <h5 style="color: var(--cor-destaque-primaria); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-chart-bar"></i> √öltimos 10 Confrontos
                        </h5>
                        
                        <!-- CONTAINER COM 2 COLUNAS -->
                        <div id="lista-confrontos" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <!-- Coluna 1 -->
                            <div id="coluna-confrontos-1" style="background: var(--cor-fundo); border: 1px solid var(--cor-borda); border-radius: 6px; padding: 15px;">
                                <h6 id="titulo-coluna-1" style="color: var(--cor-destaque-primaria); margin-bottom: 10px; text-align: center;">Jogos 1-5</h6>
                                <div id="confrontos-coluna-1"></div>
                            </div>
                            
                            <!-- Coluna 2 -->
                            <div id="coluna-confrontos-2" style="background: var(--cor-fundo); border: 1px solid var(--cor-borda); border-radius: 6px; padding: 15px;">
                                <h6 id="titulo-coluna-2" style="color: var(--cor-destaque-primaria); margin-bottom: 10px; text-align: center;">Jogos 6-10</h6>
                                <div id="confrontos-coluna-2"></div>
                            </div>
                        </div>
                        
           <!-- BOT√ïES DE A√á√ÉO -->
           <div style="display: flex; gap: 10px; justify-content: center; padding-top: 15px; border-top: 1px solid var(--cor-borda);">
               <button class="btn-success" onclick="confirmarConfrontos()" style="padding: 8px 20px; background: #00ff00; color: black; font-weight: bold; border: 2px solid #00cc00;">
                   <i class="fas fa-check"></i> OK - Confirmar
               </button>
               <button class="btn-warning" onclick="corrigirEmpates()" style="padding: 8px 20px; background: #ff6600; color: white; font-weight: bold; border: 2px solid #ff4400;">
                   <i class="fas fa-edit"></i> Corrigir Empates
               </button>
               <button class="btn-secondary" onclick="fecharPreviewConfrontos()" style="padding: 8px 20px; background: #666; color: white; border: 2px solid #555;">
                   <i class="fas fa-times"></i> Fechar
               </button>
               <button class="btn-warning" onclick="testarPreenchimentoCampo()" style="padding: 8px 20px; background: #ffaa00; color: black; font-weight: bold; border: 2px solid #ff8800;">
                   <i class="fas fa-flask"></i> Teste
               </button>
           </div>
                    </div>
                    
                    <!-- √öltimos Confrontos -->
                    <div class="form-group">
                        <label>√öltimos Confrontos (Sequ√™ncia):</label>
                        <input type="text" id="confrontos-sequence-admin" class="form-control" placeholder="Ex: V-V-D-V-V">
                        <small class="form-text">V=Vit√≥ria, E=Empate, D=Derrota</small>
                    </div>
                    
                    <!-- Analise Posi√ß√£o -->
                    <div class="form-group">
                        <label>Analise Posi√ß√£o:</label>
                        <input type="text" id="analise-posicao-admin" class="form-control" placeholder="Ex: Vantagem Flamengo">
                    </div>
                    
                    <!-- Posi√ß√µes na Tabela -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Posi√ß√£o Time Casa:</label>
                            <input type="number" id="posicao-casa-admin" class="form-control" min="1" max="20" placeholder="Ex: 5">
                        </div>
                        <div class="form-group">
                            <label>Posi√ß√£o Time Fora:</label>
                            <input type="number" id="posicao-fora-admin" class="form-control" min="1" max="20" placeholder="Ex: 12">
                        </div>
                        <div class="form-group">
                            <label>Analise Posi√ß√£o tabelas:</label>
                            <input type="text" id="analise-posicao-tabelas-admin" class="form-control" placeholder="Ex: Carregando dados...">
                        </div>
                    </div>
                    
                    <!-- Confronto Direto -->
                    <div class="form-group">
                        <label>Confronto Direto (√öltimos 10):</label>
                        <input type="text" id="confronto-direto-admin" class="form-control" placeholder="Ex: 3V-2E-5D (Casa: 2V-1E-2D)">
                    </div>
                    
                    <!-- Analise Confronto Direto -->
                    <div class="form-group">
                        <label>Analise Confronto Direto:</label>
                        <input type="text" id="analise-confronto-direto-admin" class="form-control" placeholder="Ex: Vantagem Flamengo">
                    </div>
                    
                    <!-- Fator Casa -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fator Casa - Time Casa:</label>
                            <input type="text" id="fator-casa-admin" class="form-control" placeholder="Ex: 75% aproveitamento">
                        </div>
                        <div class="form-group">
                            <label>Fator Casa - Time Fora:</label>
                            <input type="text" id="fator-fora-admin" class="form-control" placeholder="Ex: 25% aproveitamento fora">
                        </div>
                        <div class="form-group">
                            <label>Analise Fator Caas:</label>
                            <input type="text" id="analise-fator-casa-admin" class="form-control" placeholder="Ex: Carregando dados...">
                        </div>
                    </div>
                </div>

                <!-- CONCLUS√ÉO DO ANALISTA -->
                <div class="form-section" style="border-top: 3px solid #A855F7;">
                    <h4 style="color: #A855F7;">üéØ Conclus√£o do Analista</h4>
                    <div class="form-group" style="width: 100%;">
                        <label style="color: #94a3b8;">Conclus√£o Final do Analista:</label>
                        <textarea id="conclusao-analista-admin" class="form-control" rows="4" style="min-height: 100px; resize: vertical; width: 100%; max-width: none;" placeholder="Ex: A an√°lise estat√≠stica aponta superioridade clara do time da casa..."></textarea>
                    </div>
                </div>

                <!-- BOT√ïES DE A√á√ÉO -->
                <div class="form-section">
                    <div class="form-row">
                        <button class="btn-primary" id="btn-salvar-jogo" data-action="save-jogo" data-jogo="1">
                            <i class="fas fa-save"></i> Salvar Dados do Jogo (<b class="rotulo-arquivo">jogo_1.json</b>)
                        </button>
                        <input type="hidden" id="nomeArquivo" value="jogo_1.json">
                        <button class="btn-secondary" onclick="limparFormularioJogo()">
                            <i class="fas fa-eraser"></i> Limpar Formul√°rio
                        </button>
                    </div>
                    <!-- INFORMA√á√ïES DO ARQUIVO -->
                    <div class="form-row" style="margin-top: 10px;">
                        <div style="text-align: center; color: #666; font-size: 12px;">
                            <div id="info-arquivo-salvamento">
                                <strong>Arquivo:</strong> <span id="nome-arquivo-salvamento">jogo_1.json</span><br>
                                <strong>Caminho:</strong> <span id="caminho-arquivo-salvamento">backend/Concursos_CEF/</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === ABA DASHBOARD === -->
        <div class="tab-content" id="dashboard">
            <h2 style="margin-bottom: 25px; color: #333;">
                <i class="fas fa-tachometer-alt"></i> Dashboard do Sistema
            </h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-database icon" style="color: #9b59b6;"></i>
                    <div class="number" id="tamanhoDb">-</div>
                    <div class="label">Tamanho do Banco</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar icon" style="color: #e74c3c;"></i>
                    <div class="number" id="dadosAntigos">-</div>
                    <div class="label">Dados Mais Antigos</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-source icon" style="color: #2ecc71;"></i>
                    <div class="number" id="fontesPrincipais">-</div>
                    <div class="label">Fontes Principais</div>
                </div>
            </div>
        </div>

        <!-- === ABA BACKUP === -->
        <div class="tab-content" id="backup">
            <h2 style="margin-bottom: 25px; color: #333;">
                <i class="fas fa-download"></i> Backup e Restore
            </h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div style="padding: 30px; background: #f8f9fa; border-radius: 15px;">
                    <h3 style="margin-bottom: 20px; color: #00E38C;">
                        <i class="fas fa-download"></i> Fazer Backup
                    </h3>
                    <p style="margin-bottom: 20px; color: #666;">
                        Baixe uma c√≥pia completa de todos os dados da Central.
                    </p>
                    <button class="btn-primary" onclick="fazerBackup()">
                        <i class="fas fa-download"></i> Gerar Backup
                    </button>
                </div>
                
                <div style="padding: 30px; background: #fff3cd; border-radius: 15px;">
                    <h3 style="margin-bottom: 20px; color: #856404;">
                        <i class="fas fa-upload"></i> Restaurar Backup
                    </h3>
                    <p style="margin-bottom: 20px; color: #666;">
                        Restaure dados de um arquivo de backup anterior.
                    </p>
                    <input type="file" id="backupFile" accept=".json" style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="restaurarBackup()">
                        <i class="fas fa-upload"></i> Restaurar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ajuda -->
    <div id="helpModal" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2 class="help-modal-title" id="helpModalTitle">
                    <i class="fas fa-question-circle"></i>
                    <span id="helpModalTitleText">Ajuda</span>
                </h2>
                <button class="help-modal-close" onclick="fecharAjuda()">&times;</button>
            </div>
            <div class="help-modal-body" id="helpModalBody">
                <!-- Conte√∫do ser√° inserido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Tabela de Jogos -->
    <div id="jogosModal" class="help-modal">
        <div class="help-modal-content" style="max-width: 1200px; width: 95%;">
            <div class="help-modal-header">
                <h2 class="help-modal-title">
                    <i class="fas fa-table"></i>
                    <span id="jogosModalTitle">Hist√≥rico de Jogos - Flamengo</span>
                </h2>
                <button class="help-modal-close" onclick="fecharTabelaJogos()">&times;</button>
            </div>
            <div class="help-modal-body" style="padding: 20px;">
                <!-- Bot√£o Adicionar Jogo -->
                <div style="margin-bottom: 20px; text-align: right;">
                    <button class="btn-primary" onclick="adicionarNovoJogo()" style="background: linear-gradient(135deg, #00E38C, #00B377);">
                        <i class="fas fa-plus"></i> Adicionar Novo Jogo
                    </button>
                </div>
                
                <!-- Tabela de Jogos -->
                <div class="tabela-jogos-scroll" style="overflow-x: auto; max-height: 400px; overflow-y: auto; border: 1px solid #333; border-radius: 8px;">
                    <table id="tabelaJogos" style="width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #6f42c1, #8b5cf6); color: white;">
                                <th style="padding: 12px; text-align: center;">Data</th>
                                <th style="padding: 12px; text-align: center;">Casa</th>
                                <th style="padding: 12px; text-align: center;">Placar</th>
                                <th style="padding: 12px; text-align: center;">Visitante</th>
                                <th style="padding: 12px; text-align: center;">Local</th>
                                <th style="padding: 12px; text-align: center;">Resultado</th>
                                <th style="padding: 12px; text-align: center;">Pontos</th>
                                <th style="padding: 12px; text-align: center;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="jogosTableBody">
                            <!-- Jogos ser√£o inseridos aqui -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Resumo Estat√≠stico -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <h4 style="color: #00E38C; margin-bottom: 10px;">üìä Resumo Estat√≠stico</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #00E38C;" id="totalJogos">0</div>
                            <div style="font-size: 12px; color: #ccc;">Total de Jogos</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #28a745;" id="totalVitorias">0</div>
                            <div style="font-size: 12px; color: #ccc;">Vit√≥rias</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #ffc107;" id="totalEmpates">0</div>
                            <div style="font-size: 12px; color: #ccc;">Empates</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #dc3545;" id="totalDerrotas">0</div>
                            <div style="font-size: 12px; color: #ccc;">Derrotas</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #17a2b8;" id="ppgCalculado">0.00</div>
                            <div style="font-size: 12px; color: #ccc;">PPG</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURA√á√ïES === 
        const ADMIN_KEY = 'loteca2024admin'; // Chave de acesso padr√£o
        const API_BASE = window.location.port === '5001' ? 'http://127.0.0.1:5001' : window.location.origin; // Base URL para APIs

        // Controle de estado para evitar piscar
        let isClassificacaoLoading = false;
        // === FUN√á√ÉO PARA MOSTRAR/OCULTAR SENHA ===
        function togglePasswordVisibility() {
            const passwordField = document.getElementById('adminKey');
            const toggleIcon = document.getElementById('togglePassword');
            
            if (passwordField.type === 'password') {
                // Mostrar senha
                passwordField.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
                toggleIcon.style.color = '#00E38C'; // Verde quando vis√≠vel
                toggleIcon.title = 'Ocultar senha';
            } else {
                // Ocultar senha
                passwordField.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
                toggleIcon.style.color = '#666'; // Cinza quando oculta
                toggleIcon.title = 'Mostrar senha';
            }
        }

        // === SISTEMA DE LOGIN ===
        function login() {
            const key = document.getElementById('adminKey').value;
            const errorDiv = document.getElementById('loginError');
            
            if (key === ADMIN_KEY) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'block';
                carregarDashboard();
                carregarClubes();
                carregarEstatisticas();
            } else {
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        function logout() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('adminKey').value = '';
        }

        // === FUN√á√ïES DA PLANILHA AN√ÅLISE R√ÅPIDA ===
        
        async function sincronizarAnaliseRapida() {
            try {
                console.log('üîÑ [AN√ÅLISE] Sincronizando dados com o site...');
                
                const btn = document.getElementById('btn-sincronizar-analise');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sincronizando...';
                
                // Obter dados do formul√°rio atual
                const jogoSelecionado = document.getElementById('jogo-analise-select').value;
                
                if (!jogoSelecionado) {
                    mostrarNotificacao('‚ùå Selecione um jogo primeiro!', 'error');
                    return;
                }
                
                // CORRIGIDO: Coletar dados no FORMATO NOVO
                const dadosJogo = {
                    numero: jogoSelecionado,
                    time_casa: document.getElementById('time-casa-admin').value,
                    time_fora: document.getElementById('time-fora-admin').value,
                    arena: document.getElementById('arena-admin').value,
                    campeonato: document.getElementById('campeonato-admin').value,
                    dia: document.getElementById('dia-admin').value,
                    escudo_casa: document.getElementById('escudo-casa-path').value,
                    escudo_fora: document.getElementById('escudo-fora-path').value,
                    probabilidade_casa: document.getElementById('prob-col1-admin').value,
                    probabilidade_empate: document.getElementById('prob-colX-admin').value,
                    probabilidade_fora: document.getElementById('prob-col2-admin').value,
                    recomendacao: document.getElementById('recomendacao-admin').value,
                    confrontos_sequence: document.getElementById('confrontos-sequence-admin').value,
                    posicao_casa: document.getElementById('posicao-casa-admin').value,
                    posicao_fora: document.getElementById('posicao-fora-admin').value,
                    confronto_direto: document.getElementById('confronto-direto-admin').value,
                    fator_casa: document.getElementById('fator-casa-admin').value,
                    fator_fora: document.getElementById('fator-fora-admin').value,
                    sincronizado_em: new Date().toISOString()
                };
                
                console.log(`üìä [AN√ÅLISE] Sincronizando JOGO ${jogoSelecionado} com o site...`);
                
                // Enviar dados para o servidor (atualizar p√°gina do usu√°rio)
                const response = await fetch(`${API_BASE}/api/admin/analise/sincronizar`, {
                    method: 'POST',
                        headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jogo_numero: jogoSelecionado,
                        dados: dadosJogo
                    })
                });
                
                if (response.ok) {
                    const resultado = await response.json();
                    console.log('‚úÖ [AN√ÅLISE] Dados sincronizados com sucesso:', resultado);
                    mostrarNotificacao(`‚úÖ JOGO ${jogoSelecionado} sincronizado! A p√°gina do usu√°rio foi atualizada.`, 'success');
                } else {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao sincronizar:', error);
                mostrarNotificacao('‚ùå Erro ao sincronizar dados!', 'error');
            } finally {
                const btn = document.getElementById('btn-sincronizar-analise');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sync"></i> Sincronizar com Site (Secund√°rio)';
                
                // Re-anexar event listeners ap√≥s mudan√ßa no DOM
                setTimeout(() => reanexarEventListeners(), 100);
            }
        }
        
        async function calcularEstatisticasAnalise() {
            try {
                console.log('üìä [AN√ÅLISE] Calculando estat√≠sticas...');
                
                const btn = document.getElementById('btn-calcular-estatisticas');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculando...';
                
                // Obter dados dos campos
                const timeCasa = document.getElementById('time-casa-admin').value;
                const timeFora = document.getElementById('time-fora-admin').value;
                const posicaoCasa = document.getElementById('posicao-casa-admin').value;
                const posicaoFora = document.getElementById('posicao-fora-admin').value;
                const confrontoDireto = document.getElementById('confronto-direto-admin').value;
                const sequenciaConfrontos = document.getElementById('confrontos-sequence-admin').value;
                
                if (!timeCasa || !timeFora) {
                    mostrarNotificacao('‚ö†Ô∏è Preencha os times antes de calcular!', 'warning');
                    return;
                }
                
                // Simular c√°lculo de estat√≠sticas baseado nos dados
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Calcular probabilidades baseadas em fatores
                let probCol1 = 35; // Base
                let probColX = 30; // Base  
                let probCol2 = 35; // Base
                
                // Ajustar baseado na posi√ß√£o na tabela
                if (posicaoCasa && posicaoFora) {
                    const posCasa = parseInt(posicaoCasa);
                    const posFora = parseInt(posicaoFora);
                    
                    if (posCasa < posFora) {
                        // Time casa melhor posicionado
                        probCol1 += 10;
                        probColX -= 2;
                        probCol2 -= 8;
                    } else if (posCasa > posFora) {
                        // Time fora melhor posicionado
                        probCol1 -= 8;
                        probColX -= 2;
                        probCol2 += 10;
                    }
                }
                
                // Ajustar baseado na sequ√™ncia de confrontos
                if (sequenciaConfrontos) {
                    const sequencia = sequenciaConfrontos.toUpperCase();
                    const vitoriasCasa = (sequencia.match(/V/g) || []).length;
                    const empates = (sequencia.match(/E/g) || []).length;
                    const derrotasCasa = (sequencia.match(/D/g) || []).length;
                    
                    if (vitoriasCasa > derrotasCasa) {
                        probCol1 += 5;
                        probCol2 -= 5;
                    } else if (derrotasCasa > vitoriasCasa) {
                        probCol1 -= 5;
                        probCol2 += 5;
                    }
                }
                
                // Normalizar probabilidades (somar 100%)
                const total = probCol1 + probColX + probCol2;
                probCol1 = Math.round((probCol1 / total) * 100 * 10) / 10;
                probColX = Math.round((probColX / total) * 100 * 10) / 10;
                probCol2 = Math.round((probCol2 / total) * 100 * 10) / 10;
                
                // Preencher campos calculados
                document.getElementById('prob-col1-admin').value = probCol1;
                document.getElementById('prob-colX-admin').value = probColX;
                document.getElementById('prob-col2-admin').value = probCol2;
                
                // Gerar recomenda√ß√£o autom√°tica
                let recomendacao = `üìä AN√ÅLISE ESTAT√çSTICA AUTOM√ÅTICA\n\n`;
                recomendacao += `üè† ${timeCasa}: ${probCol1}% de probabilidade\n`;
                recomendacao += `‚öñÔ∏è Empate: ${probColX}% de probabilidade\n`;
                recomendacao += `‚úàÔ∏è ${timeFora}: ${probCol2}% de probabilidade\n\n`;
                
                if (posicaoCasa && posicaoFora) {
                    recomendacao += `üìà POSI√á√ÉO NA TABELA:\n`;
                    recomendacao += `‚Ä¢ ${timeCasa}: ${posicaoCasa}¬∫ lugar\n`;
                    recomendacao += `‚Ä¢ ${timeFora}: ${posicaoFora}¬∫ lugar\n\n`;
                }
                
                if (sequenciaConfrontos) {
                    recomendacao += `üìä √öLTIMOS CONFRONTOS:\n`;
                    recomendacao += `‚Ä¢ Sequ√™ncia: ${sequenciaConfrontos}\n\n`;
                }
                
                if (confrontoDireto) {
                    recomendacao += `‚öîÔ∏è CONFRONTO DIRETO:\n`;
                    recomendacao += `‚Ä¢ ${confrontoDireto}\n\n`;
                }
                
                // Determinar recomenda√ß√£o
                if (probCol1 > probCol2 && probCol1 > probColX) {
                    recomendacao += `üéØ RECOMENDA√á√ÉO: Coluna 1 (${timeCasa})\n`;
                    recomendacao += `üí° Justificativa: Maior probabilidade de vit√≥ria do time da casa.`;
                } else if (probCol2 > probCol1 && probCol2 > probColX) {
                    recomendacao += `üéØ RECOMENDA√á√ÉO: Coluna 2 (${timeFora})\n`;
                    recomendacao += `üí° Justificativa: Maior probabilidade de vit√≥ria do time visitante.`;
                } else {
                    recomendacao += `üéØ RECOMENDA√á√ÉO: Coluna X (Empate)\n`;
                    recomendacao += `üí° Justificativa: Jogo equilibrado, empate com boa probabilidade.`;
                }
                
                document.getElementById('recomendacao-admin').value = recomendacao;
                
                console.log('‚úÖ [AN√ÅLISE] Estat√≠sticas calculadas:', {
                    probCol1, probColX, probCol2, recomendacao: recomendacao.substring(0, 100) + '...'
                });
                
                mostrarNotificacao('‚úÖ Estat√≠sticas calculadas com sucesso!', 'success');
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao calcular estat√≠sticas:', error);
                mostrarNotificacao('‚ùå Erro ao calcular estat√≠sticas!', 'error');
            } finally {
                const btn = document.getElementById('btn-calcular-estatisticas');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-calculator"></i> Calcular Estat√≠sticas';
                
                // Re-anexar event listeners ap√≥s mudan√ßa no DOM
                setTimeout(() => reanexarEventListeners(), 100);
            }
        }
        
        // === DADOS DOS JOGOS ===
        let jogosAnaliseData = {};
        
        // FUN√á√ÉO PARA ATUALIZAR INFORMA√á√ïES DO ARQUIVO DE SALVAMENTO
        function atualizarInfoArquivoSalvamento(jogoSelecionado) {
            const btnSalvar = document.getElementById('btn-salvar-jogo');
            const nomeArquivo = document.getElementById('nome-arquivo-salvamento');
            const caminhoArquivo = document.getElementById('caminho-arquivo-salvamento');
            
            // Obter n√∫mero do concurso atual
            const numeroConcurso = document.getElementById('numeroConcurso').value || '1215';
            
            // Nome do arquivo baseado no jogo selecionado
            const nomeArquivoCompleto = `jogo_${jogoSelecionado}.json`;
            const caminhoCompleto = `backend/Concursos_CEF/`;
            
            // Atualizar bot√£o com nome do arquivo
            btnSalvar.innerHTML = `<i class="fas fa-save"></i> Salvar Dados do Jogo (${nomeArquivoCompleto})`;
            
            // Atualizar informa√ß√µes do arquivo
            nomeArquivo.textContent = nomeArquivoCompleto;
            caminhoArquivo.textContent = caminhoCompleto;
            
            // Re-anexar event listeners ap√≥s mudan√ßa no DOM
            setTimeout(() => reanexarEventListeners(), 100);
            
            console.log(`üìÅ [ARQUIVO] Arquivo de salvamento: ${nomeArquivoCompleto}`);
            console.log(`üìÅ [ARQUIVO] Caminho: ${caminhoCompleto}`);
        }
        
        function carregarDadosJogo() {
            const jogoSelecionado = document.getElementById('jogo-analise-select').value;
            const container = document.getElementById('dados-jogo-container');
            const titulo = document.getElementById('titulo-jogo');
            
            if (!jogoSelecionado) {
                container.style.display = 'none';
                return;
            }
            
            console.log(`üéÆ [AN√ÅLISE] Carregando dados do JOGO ${jogoSelecionado}...`);
            
            // Mostrar container
            container.style.display = 'block';
            
            // Atualizar t√≠tulo
            const opcaoSelecionada = document.querySelector(`#jogo-analise-select option[value="${jogoSelecionado}"]`);
            titulo.textContent = `üéØ ${opcaoSelecionada.textContent}`;
            
            // ATUALIZAR √çNDICE DO BOT√ÉO DE SALVAR (NOVA IMPLEMENTA√á√ÉO)
            atualizarIndiceJogo(parseInt(jogoSelecionado));
            
            // ATUALIZAR BOT√ÉO E INFORMA√á√ïES DO ARQUIVO (M√âTODO ANTIGO - MANTER PARA COMPATIBILIDADE)
            atualizarInfoArquivoSalvamento(jogoSelecionado);
            
            // PRIMEIRO: Carregar dados existentes se dispon√≠veis
            carregarDadosJogoExistente().then(() => {
                // SEGUNDO: S√≥ sincronizar com tabela se n√£o houver dados salvos
                const temDadosSalvos = verificarSeTemDadosSalvos(jogoSelecionado);
                if (!temDadosSalvos) {
                    console.log(`üîÑ [SINCRONIZA√á√ÉO] Nenhum dado salvo encontrado, sincronizando com tabela...`);
                    sincronizarComTabelaLoteca(jogoSelecionado);
                } else {
                    console.log(`‚úÖ [SINCRONIZA√á√ÉO] Dados salvos encontrados, pulando sincroniza√ß√£o com tabela`);
                }
            });
        }
        
        // === FUN√á√ÉO PARA VERIFICAR SE H√Å DADOS SALVOS ===
        function verificarSeTemDadosSalvos(jogoSelecionado) {
            // Verificar se h√° dados no localStorage
            const dadosSalvos = localStorage.getItem('jogosAnaliseData');
            if (dadosSalvos) {
                const jogosData = JSON.parse(dadosSalvos);
                if (jogosData[jogoSelecionado]) {
                    console.log(`üìä [VERIFICA√á√ÉO] Dados encontrados no localStorage para jogo ${jogoSelecionado}`);
                    return true;
                }
            }
            
            // Verificar se h√° dados nos campos do formul√°rio (indicando que foram carregados do servidor)
            const timeCasa = document.getElementById('time-casa-admin')?.value;
            const timeFora = document.getElementById('time-fora-admin')?.value;
            const recomendacao = document.getElementById('recomendacao-admin')?.value;
            
            if (timeCasa && timeFora && recomendacao) {
                console.log(`üìä [VERIFICA√á√ÉO] Dados encontrados no formul√°rio para jogo ${jogoSelecionado}`);
                return true;
            }
            
            console.log(`üìä [VERIFICA√á√ÉO] Nenhum dado salvo encontrado para jogo ${jogoSelecionado}`);
            return false;
        }
        
        function autoPreencherDadosJogo(numeroJogo) {
            console.log(`üîÑ [AN√ÅLISE] Auto-preenchendo dados do JOGO ${numeroJogo}...`);
            
            // Dados padr√£o para cada jogo
            const dadosJogos = {
                '1': {
                    time_casa: 'Ponte Preta/SP',
                    time_fora: 'Guarani/RJ',
                    arena: 'Neo Qu√≠mica Arena',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/PON_Ponte_Preta/Ponte_Preta.png',
                    escudo_fora: '/static/escudos/GUA_Guarani/Guarani.png'
                },
                '2': {
                    time_casa: 'Fortaleza/CE',
                    time_fora: 'Sport/PE',
                    arena: 'Arena Castel√£o',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'S√°bado',
                    escudo_casa: '/static/escudos/FOR_Fortaleza/Fortaleza.png',
                    escudo_fora: '/static/escudos/SPT_Sport/Sport.png'
                },
                '3': {
                    time_casa: 'Juventude/RS',
                    time_fora: 'Internacional/RS',
                    arena: 'Alfredo Jaconi',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'S√°bado',
                    escudo_casa: '/static/escudos/JUV_Juventude/Juventude.png',
                    escudo_fora: '/static/escudos/INT_Internacional/Internacional.png'
                },
                '4': {
                    time_casa: 'Vasco da Gama/RJ',
                    time_fora: 'Cruzeiro/MG',
                    arena: 'S√£o Janu√°rio',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'S√°bado',
                    escudo_casa: '/static/escudos/VAS_Vasco/Vasco.png',
                    escudo_fora: '/static/escudos/CRU_Cruzeiro/Cruzeiro.png'
                },
                '5': {
                    time_casa: 'Athletico/PR',
                    time_fora: 'Oper√°rio/PR',
                    arena: 'Arena da Baixada',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'S√°bado',
                    escudo_casa: '/static/escudos/ATL_Athletico/Athletico.png',
                    escudo_fora: '/static/escudos/OPE_Operario/Operario.png'
                },
                '6': {
                    time_casa: 'Atl√©tico/MG',
                    time_fora: 'Mirassol/SP',
                    arena: 'Arena MRV',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'S√°bado',
                    escudo_casa: '/static/escudos/ATM_Atletico_MG/Atletico_MG.png',
                    escudo_fora: '/static/escudos/MIR_Mirassol/Mirassol.png'
                },
                '7': {
                    time_casa: 'Gr√™mio/RS',
                    time_fora: 'Vit√≥ria/BA',
                    arena: 'Arena do Gr√™mio',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/GRE_Gremio/Gremio.png',
                    escudo_fora: '/static/escudos/VIT_Vitoria/Vitoria.png'
                },
                '8': {
                    time_casa: 'Aston Villa',
                    time_fora: 'Fulham',
                    arena: 'Villa Park',
                    campeonato: 'Premier League',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/AVL_Aston_Villa/Aston_Villa.png',
                    escudo_fora: '/static/escudos/FUL_Fulham/Fulham.png'
                },
                '9': {
                    time_casa: 'Bahia/BA',
                    time_fora: 'Palmeiras/SP',
                    arena: 'Arena Fonte Nova',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/BAH_Bahia/Bahia.png',
                    escudo_fora: '/static/escudos/PAL_Palmeiras/Palmeiras.png'
                },
                '10': {
                    time_casa: 'Fluminense/RJ',
                    time_fora: 'Botafogo/RJ',
                    arena: 'Maracan√£',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/Flu_Fluminense/Fluminense.png',
                    escudo_fora: '/static/escudos/BOT_Botafogo/Botafogo.png'
                },
                '11': {
                    time_casa: 'Crici√∫ma/SC',
                    time_fora: 'Paysandu/PA',
                    arena: 'Heriberto H√ºlse',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/CRI_Criciuma/Criciuma.png',
                    escudo_fora: '/static/escudos/PAY_Paysandu/Paysandu.png'
                },
                '12': {
                    time_casa: 'Newcastle',
                    time_fora: 'Arsenal',
                    arena: 'St. James Park',
                    campeonato: 'Premier League',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/NEW_Newcastle/Newcastle.png',
                    escudo_fora: '/static/escudos/ARS_Arsenal/Arsenal.png'
                },
                '13': {
                    time_casa: 'Bragantino/SP',
                    time_fora: 'Santos/SP',
                    arena: 'Nabi Abi Chedid',
                    campeonato: 'Brasileir√£o S√©rie A',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/BRA_Bragantino/Bragantino.png',
                    escudo_fora: '/static/escudos/SAN_Santos/Santos.png'
                },
                '14': {
                    time_casa: 'Barcelona',
                    time_fora: 'Real Sociedad',
                    arena: 'Camp Nou',
                    campeonato: 'La Liga',
                    dia: 'Domingo',
                    escudo_casa: '/static/escudos/BAR_Barcelona/Barcelona.png',
                    escudo_fora: '/static/escudos/RSO_Real_Sociedad/Real_Sociedad.png'
                }
            };
            
            const dadosJogo = dadosJogos[numeroJogo];
            if (dadosJogo) {
                // Preencher campos b√°sicos
                document.getElementById('time-casa-admin').value = dadosJogo.time_casa;
                document.getElementById('time-fora-admin').value = dadosJogo.time_fora;
                document.getElementById('arena-admin').value = dadosJogo.arena;
                document.getElementById('campeonato-admin').value = dadosJogo.campeonato;
                document.getElementById('dia-admin').value = dadosJogo.dia;
                
                // Preencher caminhos dos escudos
                document.getElementById('escudo-casa-path').value = dadosJogo.escudo_casa || '';
                document.getElementById('escudo-fora-path').value = dadosJogo.escudo_fora || '';
                
                // Atualizar preview dos escudos
                atualizarPreviewEscudo('casa');
                atualizarPreviewEscudo('fora');
                
                console.log(`‚úÖ [AN√ÅLISE] Dados b√°sicos do JOGO ${numeroJogo} preenchidos automaticamente`);
            } else {
                console.warn(`‚ö†Ô∏è [AN√ÅLISE] Dados n√£o encontrados para JOGO ${numeroJogo}`);
            }
        }
        
        function atualizarPreviewEscudo(tipo) {
            const pathInput = document.getElementById(`escudo-${tipo}-path`);
            const previewImg = document.getElementById(`preview-escudo-${tipo}`);
            
            if (pathInput && previewImg) {
                const caminho = pathInput.value.trim();
                
                if (caminho) {
                    // Atualizar src da imagem
                    previewImg.src = caminho;
                    
                    // Adicionar timestamp para for√ßar reload se necess√°rio
                    if (caminho.includes('?')) {
                        previewImg.src = caminho + '&t=' + Date.now();
                    } else {
                        previewImg.src = caminho + '?t=' + Date.now();
                    }
                    
                    console.log(`üñºÔ∏è [AN√ÅLISE] Preview do escudo ${tipo} atualizado: ${caminho}`);
                } else {
                    // Se n√£o h√° caminho, mostrar placeholder
                    previewImg.src = '/static/placeholder-team-logo.svg';
                    console.log(`üñºÔ∏è [AN√ÅLISE] Preview do escudo ${tipo} resetado para placeholder`);
                }
            }
        }
        
        function salvarDadosJogo() {
            const jogoSelecionado = document.getElementById('jogo-analise-select').value;
            
            if (!jogoSelecionado) {
                mostrarNotificacao('‚ùå Selecione um jogo primeiro!', 'error');
                return;
            }
            
            console.log(`üíæ [AN√ÅLISE] Salvando dados do JOGO ${jogoSelecionado}...`);
            
            // Coletar dados do formul√°rio
            const dadosJogo = {
                numero: jogoSelecionado,
                time_casa: document.getElementById('time-casa-admin').value,
                time_fora: document.getElementById('time-fora-admin').value,
                arena: document.getElementById('arena-admin').value,
                campeonato: document.getElementById('campeonato-admin').value,
                dia: document.getElementById('dia-admin').value,
                escudo_casa: document.getElementById('escudo-casa-path').value,
                escudo_fora: document.getElementById('escudo-fora-path').value,
                probabilidades: {
                    col1: document.getElementById('prob-col1-admin').value,
                    colX: document.getElementById('prob-colX-admin').value,
                    col2: document.getElementById('prob-col2-admin').value
                },
                recomendacao: document.getElementById('recomendacao-admin').value,
                conclusao_analista: document.getElementById('conclusao-analista-admin').value,
                confrontos_sequence: document.getElementById('confrontos-sequence-admin').value,
                analise_posicao: document.getElementById('analise-posicao-admin').value,
                posicao_casa: document.getElementById('posicao-casa-admin').value,
                posicao_fora: document.getElementById('posicao-fora-admin').value,
                analise_posicao_tabelas: document.getElementById('analise-posicao-tabelas-admin').value,
                confronto_direto: document.getElementById('confronto-direto-admin').value,
                analise_confronto_direto: document.getElementById('analise-confronto-direto-admin').value,
                fator_casa: document.getElementById('fator-casa-admin').value,
                fator_fora: document.getElementById('fator-fora-admin').value,
                analise_fator_casa: document.getElementById('analise-fator-casa-admin').value,
                arquivo_confrontos: document.getElementById('arquivo-confrontos-base').value,
                salvo_em: new Date().toISOString()
            };
            
            // Salvar no objeto global
            jogosAnaliseData[jogoSelecionado] = dadosJogo;
            
            // Salvar no localStorage
            localStorage.setItem('jogosAnaliseData', JSON.stringify(jogosAnaliseData));
            
            // M√âTODO PRINCIPAL: Salvar e sincronizar automaticamente
            salvarESincronizarAnalise(dadosJogo);
            
            console.log(`‚úÖ [AN√ÅLISE] Dados do JOGO ${jogoSelecionado} salvos e sincronizados:`, dadosJogo);
            mostrarNotificacao(`‚úÖ Dados do JOGO ${jogoSelecionado} salvos e sincronizados com o site!`, 'success');
        }
        
        // CORRIGIDO: SALVAR APENAS UMA VEZ (ELIMINAR DUPLICA√á√ÉO)
        async function salvarESincronizarAnalise(dadosJogo) {
            try {
                console.log(`üîÑ [AN√ÅLISE] Salvando JOGO ${dadosJogo.numero} (formato unificado)...`);
                
                // USAR APENAS UMA FUN√á√ÉO: salvarAnaliseRapida (que j√° usa formato novo)
                await salvarAnaliseRapida(dadosJogo.numero);
                
                console.log(`‚úÖ [AN√ÅLISE] JOGO ${dadosJogo.numero} salvo com sucesso!`);
                
            } catch (error) {
                console.error(`‚ùå [AN√ÅLISE] Erro ao salvar JOGO ${dadosJogo.numero}:`, error);
                mostrarNotificacao(`‚ùå Erro ao salvar: ${error.message}`, 'error');
            }
        }
        
        // FUN√á√ÉO PARA SALVAR TODOS OS 14 JOGOS (AUTOMATIZA√á√ÉO COMPLETA)
        async function salvarTodosJogos() {
            console.log('üöÄ [AUTOMATIZA√á√ÉO] Iniciando salvamento de todos os 14 jogos...');
            
            try {
                // Array com dados padr√£o para todos os 14 jogos
                const todosJogos = [
                    {
                        numero: 1,
                        time_casa: 'Ponte Preta/SP',
                        time_fora: 'Guarani/RJ',
                        arena: 'Mois√©s Lucarelli',
                        campeonato: 'Brasileir√£o S√©rie C',
                        dia: 'S√°bado',
                        escudo_casa: '/static/escudos/PON_Ponte-Preta/PontePreta.png',
                        escudo_fora: '/static/escudos/GUA_Guarani/Guarani.png',
                        probabilidades: { col1: '45%', colX: '30%', col2: '25%' },
                        recomendacao: 'Confronto equilibrado na S√©rie C. Ponte Preta em casa tem leve vantagem.',
                        confrontos_sequence: 'V-D-E-V-D-E-V-D-E-V',
                        posicao_casa: '8¬∫',
                        posicao_fora: '12¬∫',
                        confronto_direto: 'Ponte Preta 2-1 Guarani',
                        fator_casa: '60%',
                        fator_fora: '40%'
                    },
                    {
                        numero: 2,
                        time_casa: 'Fortaleza/CE',
                        time_fora: 'Sport/PE',
                        arena: 'Castel√£o',
                        campeonato: 'Brasileir√£o S√©rie A',
                        dia: 'Domingo',
                        escudo_casa: '/static/escudos/FOR_Fortaleza/Fortaleza.png',
                        escudo_fora: '/static/escudos/SPT_Sport/Sport.png',
                        probabilidades: { col1: '55%', colX: '25%', col2: '20%' },
                        recomendacao: 'Fortaleza forte em casa contra Sport em m√° fase.',
                        confrontos_sequence: 'V-V-D-V-V-D-V-V-D-V',
                        posicao_casa: '6¬∫',
                        posicao_fora: '16¬∫',
                        confronto_direto: 'Fortaleza 3-1 Sport',
                        fator_casa: '70%',
                        fator_fora: '30%'
                    }
                    // Adicionar mais jogos conforme necess√°rio...
                ];
                
                let sucessos = 0;
                let erros = 0;
                
                // Salvar cada jogo
                for (const jogo of todosJogos) {
                    try {
                        console.log(`üíæ [AUTOMATIZA√á√ÉO] Salvando JOGO ${jogo.numero}...`);
                        
                        // Salvar no localStorage
                        jogosAnaliseData[jogo.numero] = jogo;
                        
                        // Salvar no servidor
                        await salvarAnaliseNoServidor(jogo);
                        
                        sucessos++;
                        console.log(`‚úÖ [AUTOMATIZA√á√ÉO] JOGO ${jogo.numero} salvo com sucesso!`);
                        
                    } catch (error) {
                        erros++;
                        console.error(`‚ùå [AUTOMATIZA√á√ÉO] Erro ao salvar JOGO ${jogo.numero}:`, error);
                    }
                }
                
                // Salvar no localStorage
                localStorage.setItem('jogosAnaliseData', JSON.stringify(jogosAnaliseData));
                
                // Mostrar resultado
                if (erros === 0) {
                    mostrarNotificacao(`üéâ Todos os ${sucessos} jogos salvos com sucesso!`, 'success');
                } else {
                    mostrarNotificacao(`‚ö†Ô∏è ${sucessos} jogos salvos, ${erros} com erro`, 'warning');
                }
                
                console.log(`üéØ [AUTOMATIZA√á√ÉO] Conclu√≠do: ${sucessos} sucessos, ${erros} erros`);
                
            } catch (error) {
                console.error('‚ùå [AUTOMATIZA√á√ÉO] Erro geral:', error);
                mostrarNotificacao(`‚ùå Erro na automatiza√ß√£o: ${error.message}`, 'error');
            }
        }
        
        async function salvarAnaliseNoServidor(dadosJogo) {
            try {
                console.log(`üíæ [AN√ÅLISE] Salvando an√°lise no servidor para JOGO ${dadosJogo.numero}...`);
                
                // Obter n√∫mero do concurso atual
                const numeroConcurso = document.getElementById('numeroConcurso').value || '1215';
                console.log(`üìä [AN√ÅLISE] Concurso atual: ${numeroConcurso}`);
                
                // CORRIGIDO: Usar FORMATO NOVO (dados) em vez de dados_publicos
                const dadosEnvio = {
                    metadados: {
                        jogo_numero: dadosJogo.numero.toString(),
                        concurso_numero: numeroConcurso,
                        time_casa: dadosJogo.time_casa,
                        time_fora: dadosJogo.time_fora,
                        salvo_em: dadosJogo.salvo_em,
                        versao: "1.0"
                    },
                    dados: {
                        numero: dadosJogo.numero,
                        time_casa: dadosJogo.time_casa,
                        time_fora: dadosJogo.time_fora,
                        arena: dadosJogo.arena,
                        campeonato: dadosJogo.campeonato,
                        dia: dadosJogo.dia,
                        escudo_casa: dadosJogo.escudo_casa,
                        escudo_fora: dadosJogo.escudo_fora,
                        probabilidade_casa: dadosJogo.probabilidades?.col1 || dadosJogo.probabilidade_casa,
                        probabilidade_empate: dadosJogo.probabilidades?.colX || dadosJogo.probabilidade_empate,
                        probabilidade_fora: dadosJogo.probabilidades?.col2 || dadosJogo.probabilidade_fora,
                        recomendacao: dadosJogo.recomendacao,
                        conclusao_analista: dadosJogo.conclusao_analista,
                        confrontos_sequence: dadosJogo.confrontos_sequence,
                        analise_posicao: dadosJogo.analise_posicao,
                        posicao_casa: dadosJogo.posicao_casa,
                        posicao_fora: dadosJogo.posicao_fora,
                        analise_posicao_tabelas: dadosJogo.analise_posicao_tabelas,
                        confronto_direto: dadosJogo.confronto_direto,
                        analise_confronto_direto: dadosJogo.analise_confronto_direto,
                        fator_casa: dadosJogo.fator_casa,
                        fator_fora: dadosJogo.fator_fora,
                        analise_fator_casa: dadosJogo.analise_fator_casa,
                        arquivo_confrontos: dadosJogo.arquivo_confrontos,
                        sincronizado_em: new Date().toISOString()
                    }
                };
                
                // Enviar para o servidor
                const response = await fetch(`${API_BASE}/api/admin/analise/salvar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nome_arquivo: `jogo_${dadosJogo.numero}.json`,
                        dados: dadosEnvio
                    })
                });
                
                if (response.ok) {
                    const resultado = await response.json();
                    console.log(`‚úÖ [AN√ÅLISE] An√°lise salva no servidor: ${resultado.arquivo}`);
                } else {
                    console.warn(`‚ö†Ô∏è [AN√ÅLISE] Erro ao salvar no servidor: ${response.status}`);
                }
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao salvar an√°lise no servidor:', error);
            }
        }
        
        function limparFormularioJogo() {
            console.log('üßπ [AN√ÅLISE] Limpando formul√°rio...');
            
            // Limpar todos os campos
            document.getElementById('time-casa-admin').value = '';
            document.getElementById('time-fora-admin').value = '';
            document.getElementById('arena-admin').value = '';
            document.getElementById('campeonato-admin').value = '';
            document.getElementById('dia-admin').value = 'S√°bado';
            document.getElementById('escudo-casa-path').value = '';
            document.getElementById('escudo-fora-path').value = '';
            document.getElementById('prob-col1-admin').value = '';
            document.getElementById('prob-colX-admin').value = '';
            document.getElementById('prob-col2-admin').value = '';
            document.getElementById('recomendacao-admin').value = '';
            document.getElementById('conclusao-analista-admin').value = '';
            document.getElementById('confrontos-sequence-admin').value = '';
            document.getElementById('posicao-casa-admin').value = '';
            document.getElementById('posicao-fora-admin').value = '';
            document.getElementById('confronto-direto-admin').value = '';
            document.getElementById('fator-casa-admin').value = '';
            document.getElementById('fator-fora-admin').value = '';
            
            // Resetar preview dos escudos
            atualizarPreviewEscudo('casa');
            atualizarPreviewEscudo('fora');
            
            mostrarNotificacao('üßπ Formul√°rio limpo!', 'success');
        }
        
        async function carregarDadosJogoExistente() {
            const jogoSelecionado = document.getElementById('jogo-analise-select').value;
            
            if (!jogoSelecionado) {
                mostrarNotificacao('‚ùå Selecione um jogo primeiro!', 'error');
                return;
            }
            
            console.log(`üì• [AN√ÅLISE] Carregando dados existentes do JOGO ${jogoSelecionado}...`);
            
            // Primeiro tentar carregar do servidor
            const dadosServidor = await carregarAnaliseDoServidor(jogoSelecionado);
            
            if (dadosServidor) {
                // Dados encontrados no servidor - usar estes
                preencherFormularioComDados(dadosServidor);
                console.log(`‚úÖ [AN√ÅLISE] Dados do JOGO ${jogoSelecionado} carregados do servidor!`);
                mostrarNotificacao(`‚úÖ Dados do JOGO ${jogoSelecionado} carregados do servidor!`, 'success');
                return;
            }
            
            // Se n√£o encontrou no servidor, tentar localStorage
            const dadosSalvos = localStorage.getItem('jogosAnaliseData');
            if (dadosSalvos) {
                jogosAnaliseData = JSON.parse(dadosSalvos);
                
                if (jogosAnaliseData[jogoSelecionado]) {
                    const dados = jogosAnaliseData[jogoSelecionado];
                    preencherFormularioComDados(dados);
                    console.log(`‚úÖ [AN√ÅLISE] Dados do JOGO ${jogoSelecionado} carregados do localStorage!`);
                    mostrarNotificacao(`‚úÖ Dados do JOGO ${jogoSelecionado} carregados do localStorage!`, 'success');
                } else {
                    console.log(`üìù [AN√ÅLISE] Nenhum dado salvo para JOGO ${jogoSelecionado}`);
                    mostrarNotificacao(`üìù Nenhum dado salvo para JOGO ${jogoSelecionado}`, 'info');
                }
            } else {
                console.log('üìù [AN√ÅLISE] Nenhum dado salvo encontrado');
                mostrarNotificacao('üìù Nenhum dado salvo encontrado', 'info');
            }
        }
        
        async function carregarAnaliseDoServidor(jogoSelecionado) {
            try {
                // Obter n√∫mero do concurso atual
                const numeroConcurso = document.getElementById('numeroConcurso').value || '1215';
                
                console.log(`üîç [AN√ÅLISE] Buscando dados do JOGO ${jogoSelecionado} do CONCURSO ${numeroConcurso}`);
                
                // Buscar arquivo no servidor usando nova estrutura
                const response = await fetch(`${API_BASE}/api/admin/analise/carregar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jogo_numero: jogoSelecionado,
                        concurso_numero: numeroConcurso
                    })
                });
                
                if (response.ok) {
                    const resultado = await response.json();
                    if (resultado.success && resultado.dados) {
                        console.log(`‚úÖ [AN√ÅLISE] Arquivo encontrado no servidor: jogo_${jogoSelecionado}.json`);
                        // A API retorna: { success: true, dados: { nome_arquivo, dados: { metadados, dados_publicos } } }
                        return resultado.dados.dados;
                    }
                }
                
                console.log(`üìù [AN√ÅLISE] Arquivo n√£o encontrado no servidor: jogo_${jogoSelecionado}.json`);
                return null;
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao carregar do servidor:', error);
                return null;
            }
        }
        
        function preencherFormularioComDados(dados) {
            console.log('üìù [AN√ÅLISE] Preenchendo formul√°rio com dados salvos:', dados);
            
            // Preencher TODOS os campos do formul√°rio
            document.getElementById('time-casa-admin').value = dados.dados_publicos?.time_casa || dados.time_casa || '';
            document.getElementById('time-fora-admin').value = dados.dados_publicos?.time_fora || dados.time_fora || '';
            document.getElementById('arena-admin').value = dados.dados_publicos?.arena || dados.arena || '';
            document.getElementById('campeonato-admin').value = dados.dados_publicos?.campeonato || dados.campeonato || '';
            document.getElementById('dia-admin').value = dados.dados_publicos?.dia || dados.dia || 'S√°bado';
            document.getElementById('escudo-casa-path').value = dados.dados_publicos?.escudo_casa || dados.escudo_casa || '';
            document.getElementById('escudo-fora-path').value = dados.dados_publicos?.escudo_fora || dados.escudo_fora || '';
            document.getElementById('prob-col1-admin').value = dados.dados_publicos?.probabilidades?.col1 || dados.probabilidades?.col1 || '';
            document.getElementById('prob-colX-admin').value = dados.dados_publicos?.probabilidades?.colX || dados.probabilidades?.colX || '';
            document.getElementById('prob-col2-admin').value = dados.dados_publicos?.probabilidades?.col2 || dados.probabilidades?.col2 || '';
            document.getElementById('recomendacao-admin').value = dados.dados_publicos?.recomendacao || dados.recomendacao || '';
            document.getElementById('conclusao-analista-admin').value = dados.dados_publicos?.conclusao_analista || dados.conclusao_analista || '';
            document.getElementById('confrontos-sequence-admin').value = dados.dados_publicos?.confrontos_sequence || dados.confrontos_sequence || '';
            document.getElementById('analise-posicao-admin').value = dados.dados_publicos?.analise_posicao || dados.analise_posicao || '';
            document.getElementById('posicao-casa-admin').value = dados.dados_publicos?.posicao_casa || dados.posicao_casa || '';
            document.getElementById('posicao-fora-admin').value = dados.dados_publicos?.posicao_fora || dados.posicao_fora || '';
            document.getElementById('analise-posicao-tabelas-admin').value = dados.dados_publicos?.analise_posicao_tabelas || dados.analise_posicao_tabelas || '';
            document.getElementById('confronto-direto-admin').value = dados.dados_publicos?.confronto_direto || dados.confronto_direto || '';
            document.getElementById('analise-confronto-direto-admin').value = dados.dados_publicos?.analise_confronto_direto || dados.analise_confronto_direto || '';
            document.getElementById('fator-casa-admin').value = dados.dados_publicos?.fator_casa || dados.fator_casa || '';
            document.getElementById('fator-fora-admin').value = dados.dados_publicos?.fator_fora || dados.fator_fora || '';
            document.getElementById('analise-fator-casa-admin').value = dados.dados_publicos?.analise_fator_casa || dados.analise_fator_casa || '';
            
            // Preencher arquivo de confrontos se dispon√≠vel
            const arquivoConfrontos = dados.dados_publicos?.arquivo_confrontos || dados.arquivo_confrontos;
            if (arquivoConfrontos) {
                document.getElementById('arquivo-confrontos-base').value = arquivoConfrontos;
                
                // Extrair nome do arquivo do caminho completo
                const nomeArquivo = arquivoConfrontos.split('\\').pop();
                console.log('üìÅ [AN√ÅLISE] Nome do arquivo extra√≠do:', nomeArquivo);
                
                // Selecionar o arquivo no dropdown
                const select = document.getElementById('arquivo-confrontos-select');
                if (select) {
                    // Aguardar um pouco para garantir que a lista foi carregada
                    setTimeout(() => {
                        const option = Array.from(select.options).find(opt => opt.value === nomeArquivo);
                        if (option) {
                            select.value = nomeArquivo;
                            console.log('üìÅ [AN√ÅLISE] Arquivo selecionado no dropdown:', nomeArquivo);
                        } else {
                            console.log('‚ö†Ô∏è [AN√ÅLISE] Arquivo n√£o encontrado na lista:', nomeArquivo);
                            // Tentar adicionar a op√ß√£o se n√£o existir
                            const novaOption = document.createElement('option');
                            novaOption.value = nomeArquivo;
                            novaOption.textContent = nomeArquivo;
                            select.appendChild(novaOption);
                            select.value = nomeArquivo;
                            console.log('üìÅ [AN√ÅLISE] Arquivo adicionado ao dropdown:', nomeArquivo);
                        }
                    }, 1000); // Aumentar tempo para garantir carregamento
                }
                
                console.log('üìÅ [AN√ÅLISE] Arquivo de confrontos preenchido:', dados.arquivo_confrontos);
            } else {
                console.log('‚ö†Ô∏è [AN√ÅLISE] Nenhum arquivo de confrontos encontrado nos dados');
            }
            
            // Atualizar preview dos escudos
            atualizarPreviewEscudo('casa');
            atualizarPreviewEscudo('fora');
            
            // Carregar lista de arquivos de confrontos
            carregarListaArquivosConfrontos();
            
            console.log('‚úÖ [AN√ÅLISE] Formul√°rio preenchido com sucesso!');
        }
        
        async function carregarListaArquivosConfrontos() {
            try {
                console.log('üìÅ [AN√ÅLISE] Carregando lista de arquivos de confrontos...');
                
                const response = await fetch(`${API_BASE}/api/admin/confrontos/lista`, {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const resultado = await response.json();
                    if (resultado.success && resultado.arquivos) {
                        const select = document.getElementById('arquivo-confrontos-select');
                        select.innerHTML = '<option value="">Selecione um arquivo CSV...</option>';
                        
                        resultado.arquivos.forEach(arquivo => {
                            const option = document.createElement('option');
                            option.value = arquivo;
                            option.textContent = arquivo;
                            select.appendChild(option);
                        });
                        
                        console.log(`‚úÖ [AN√ÅLISE] ${resultado.arquivos.length} arquivos carregados`);
                    }
                } else {
                    console.warn('‚ö†Ô∏è [AN√ÅLISE] Erro ao carregar lista de arquivos');
                }
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao carregar lista de arquivos:', error);
            }
        }
        
        function selecionarArquivoConfronto() {
            const select = document.getElementById('arquivo-confrontos-select');
            const arquivoSelecionado = select.value;
            const campoBase = document.getElementById('arquivo-confrontos-base');
            
            if (arquivoSelecionado) {
                // Construir caminho completo do arquivo
                const caminhoCompleto = campoBase.value + arquivoSelecionado;
                campoBase.value = caminhoCompleto;
                console.log(`üìÅ [AN√ÅLISE] Arquivo selecionado: ${arquivoSelecionado}`);
                console.log(`üìÅ [AN√ÅLISE] Caminho completo: ${caminhoCompleto}`);
            } else {
                // Resetar para o caminho base se nenhum arquivo selecionado
                campoBase.value = '\\0 - Loteca\\backend\\models\\Confrontos\\';
            }
        }
        
        async function carregarConfrontos() {
            const select = document.getElementById('arquivo-confrontos-select');
            const arquivoSelecionado = select.value;
            
            if (!arquivoSelecionado) {
                mostrarNotificacao('‚ùå Selecione um arquivo CSV primeiro!', 'error');
                return;
            }
            
            try {
                console.log(`üìä [AN√ÅLISE] Carregando confrontos do arquivo: ${arquivoSelecionado}`);
                
                const response = await fetch(`${API_BASE}/api/admin/confrontos/carregar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nome_arquivo: arquivoSelecionado
                    })
                });
                
                console.log(`üì° [AN√ÅLISE] Resposta da API:`, response.status);
                
                if (response.ok) {
                    const resultado = await response.json();
                    console.log(`üìä [AN√ÅLISE] Dados recebidos:`, resultado);
                    
                    if (resultado.success && resultado.confrontos) {
                        console.log(`‚úÖ [AN√ÅLISE] ${resultado.confrontos.length} confrontos carregados`);
                        mostrarPreviewConfrontos(resultado.confrontos);
                    } else {
                        console.error('‚ùå [AN√ÅLISE] Resposta sem confrontos:', resultado);
                        mostrarNotificacao('‚ùå Nenhum confronto encontrado no arquivo!', 'error');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå [AN√ÅLISE] Erro HTTP:', response.status, errorText);
                    mostrarNotificacao(`‚ùå Erro ao carregar confrontos! (${response.status})`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao carregar confrontos:', error);
                mostrarNotificacao(`‚ùå Erro ao carregar confrontos: ${error.message}`, 'error');
            }
        }
        
        function mostrarPreviewConfrontos(confrontos) {
            const container = document.getElementById('preview-confrontos');
            const coluna1 = document.getElementById('confrontos-coluna-1');
            const coluna2 = document.getElementById('confrontos-coluna-2');
            
            // Mostrar container
            container.style.display = 'block';
            
            // Testar carregamento da imagem do empate
            testarImagemEmpate();
            
            // ORDENAR POR DATA: Mais recente para mais antiga (igual √† l√≥gica de sequ√™ncia)
            const confrontosOrdenados = confrontos.sort((a, b) => {
                const dataA = new Date(a.data || '1900-01-01');
                const dataB = new Date(b.data || '1900-01-01');
                return dataB - dataA; // Ordem decrescente (mais recente primeiro)
            });
            
            // Usar M√ÅXIMO 10 confrontos para preview (os mais recentes)
            const ultimosConfrontos = confrontosOrdenados.slice(0, 10);
            console.log(`üìÖ [PREVIEW] Mostrando confrontos ordenados por data:`, ultimosConfrontos.map(c => c.data));
            
            // Obter dados dos times para mostrar escudos
            const timeCasa = document.getElementById('time-casa-admin').value;
            const timeFora = document.getElementById('time-fora-admin').value;
            const escudoCasa = document.getElementById('escudo-casa-path').value;
            const escudoFora = document.getElementById('escudo-fora-path').value;
            
            // Gerar HTML da coluna 1 (jogos 1-5)
            let htmlColuna1 = '';
            for (let i = 0; i < 5 && i < ultimosConfrontos.length; i++) {
                const confronto = ultimosConfrontos[i];
                const data = confronto.data || 'Data n√£o dispon√≠vel';
                const resultado = confronto.resultado || 'Resultado n√£o dispon√≠vel';
                const placar = confronto.placar || 'Placar n√£o dispon√≠vel';
                
                // Determinar qual escudo mostrar baseado no resultado
                let escudoMostrar = '/static/placeholder-team-logo.svg';
                let nomeTimeMostrar = resultado;
                
                console.log('üîç [PREVIEW] Analisando confronto:', confronto);
                console.log('üîç [PREVIEW] Resultado:', resultado, 'Tipo:', typeof resultado);
                
                if (resultado.toLowerCase().includes(timeCasa.toLowerCase()) || 
                    resultado.toLowerCase().includes(timeCasa.split('/')[0].toLowerCase())) {
                    escudoMostrar = escudoCasa || '/static/placeholder-team-logo.svg';
                    nomeTimeMostrar = timeCasa;
                } else if (resultado.toLowerCase().includes(timeFora.toLowerCase()) || 
                           resultado.toLowerCase().includes(timeFora.split('/')[0].toLowerCase())) {
                    escudoMostrar = escudoFora || '/static/placeholder-team-logo.svg';
                    nomeTimeMostrar = timeFora;
                } else if (resultado.toLowerCase().includes('empate')) {
                    escudoMostrar = '/static/escudos/Empate.png?v=' + Date.now();
                    nomeTimeMostrar = 'Empate';
                    console.log('üõ°Ô∏è [PREVIEW] Escudo do empate definido (NOVA IMAGEM):', escudoMostrar);
                    console.log('üõ°Ô∏è [PREVIEW] For√ßando recarregamento da imagem...');
                } else {
                    console.log('‚ö†Ô∏è [PREVIEW] Resultado n√£o identificado:', resultado, 'para confronto:', confronto);
                    // Fallback para empate se n√£o conseguir identificar
                    if (resultado.toLowerCase().includes('e') || resultado.toLowerCase().includes('draw')) {
                        escudoMostrar = '/static/escudos/Empate.png';
                        nomeTimeMostrar = 'Empate';
                        console.log('üõ°Ô∏è [PREVIEW] Fallback para empate:', escudoMostrar);
                    }
                }
                
                console.log('üñºÔ∏è [PREVIEW] Gerando HTML para confronto', i + 1, 'com escudo:', escudoMostrar);
                
                htmlColuna1 += `
                    <div style="padding: 10px; border-bottom: 1px solid var(--cor-borda); display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <div style="flex: 0 0 30px; text-align: center; font-weight: bold; color: var(--cor-destaque-primaria);">
                            ${i + 1}
                </div>
                        <div style="flex: 0 0 25px; text-align: center;">
                            <img src="${escudoMostrar}" alt="${nomeTimeMostrar}" style="width: 20px; height: 20px; object-fit: contain;" onerror="console.log('Erro ao carregar escudo:', this.src); this.src='/static/placeholder-team-logo.svg'" onload="console.log('Escudo carregado com sucesso:', this.src)">
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 0.8rem; color: var(--cor-texto-secundario);">${data}</div>
                            <div style="font-weight: bold; color: var(--cor-destaque-primaria);">${nomeTimeMostrar}</div>
                            <div style="font-size: 0.75rem; color: var(--cor-texto-secundario);">${placar}</div>
                        </div>
                </div>
            `;
            }
            
            // Gerar HTML da coluna 2 (jogos 6-10)
            let htmlColuna2 = '';
            for (let i = 5; i < 10 && i < ultimosConfrontos.length; i++) {
                const confronto = ultimosConfrontos[i];
                const data = confronto.data || 'Data n√£o dispon√≠vel';
                const resultado = confronto.resultado || 'Resultado n√£o dispon√≠vel';
                const placar = confronto.placar || 'Placar n√£o dispon√≠vel';
                
                // Determinar qual escudo mostrar baseado no resultado
                let escudoMostrar = '/static/placeholder-team-logo.svg';
                let nomeTimeMostrar = resultado;
                
                console.log('üîç [PREVIEW] Analisando confronto:', confronto);
                console.log('üîç [PREVIEW] Resultado:', resultado, 'Tipo:', typeof resultado);
                
                if (resultado.toLowerCase().includes(timeCasa.toLowerCase()) || 
                    resultado.toLowerCase().includes(timeCasa.split('/')[0].toLowerCase())) {
                    escudoMostrar = escudoCasa || '/static/placeholder-team-logo.svg';
                    nomeTimeMostrar = timeCasa;
                } else if (resultado.toLowerCase().includes(timeFora.toLowerCase()) || 
                           resultado.toLowerCase().includes(timeFora.split('/')[0].toLowerCase())) {
                    escudoMostrar = escudoFora || '/static/placeholder-team-logo.svg';
                    nomeTimeMostrar = timeFora;
                } else if (resultado.toLowerCase().includes('empate')) {
                    escudoMostrar = '/static/escudos/Empate.png?v=' + Date.now();
                    nomeTimeMostrar = 'Empate';
                    console.log('üõ°Ô∏è [PREVIEW] Escudo do empate definido (NOVA IMAGEM):', escudoMostrar);
                    console.log('üõ°Ô∏è [PREVIEW] For√ßando recarregamento da imagem...');
                } else {
                    console.log('‚ö†Ô∏è [PREVIEW] Resultado n√£o identificado:', resultado, 'para confronto:', confronto);
                    // Fallback para empate se n√£o conseguir identificar
                    if (resultado.toLowerCase().includes('e') || resultado.toLowerCase().includes('draw')) {
                        escudoMostrar = '/static/escudos/Empate.png';
                        nomeTimeMostrar = 'Empate';
                        console.log('üõ°Ô∏è [PREVIEW] Fallback para empate:', escudoMostrar);
                    }
                }
                
                console.log('üñºÔ∏è [PREVIEW] Gerando HTML para confronto', i + 1, 'com escudo:', escudoMostrar);
                
                htmlColuna2 += `
                    <div style="padding: 10px; border-bottom: 1px solid var(--cor-borda); display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <div style="flex: 0 0 30px; text-align: center; font-weight: bold; color: var(--cor-destaque-primaria);">
                            ${i + 1}
                        </div>
                        <div style="flex: 0 0 25px; text-align: center;">
                            <img src="${escudoMostrar}" alt="${nomeTimeMostrar}" style="width: 20px; height: 20px; object-fit: contain;" onerror="console.log('Erro ao carregar escudo:', this.src); this.src='/static/placeholder-team-logo.svg'" onload="console.log('Escudo carregado com sucesso:', this.src)">
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 0.8rem; color: var(--cor-texto-secundario);">${data}</div>
                            <div style="font-weight: bold; color: var(--cor-destaque-primaria);">${nomeTimeMostrar}</div>
                            <div style="font-size: 0.75rem; color: var(--cor-texto-secundario);">${placar}</div>
                        </div>
                    </div>
                `;
            }
            
            // T√≠tulos fixos para 10 confrontos
            document.getElementById('titulo-coluna-1').textContent = `Jogos 1-5`;
            document.getElementById('titulo-coluna-2').textContent = `Jogos 6-10`;
            
            // Preencher as colunas
            coluna1.innerHTML = htmlColuna1;
            coluna2.innerHTML = htmlColuna2;
            
            // Armazenar confrontos para uso posterior
            window.confrontosPreview = confrontos;
            
            console.log(`‚úÖ [AN√ÅLISE] Preview de ${ultimosConfrontos.length} confrontos exibido em 2 colunas`);
        }
        
        function autoPreencherSequenciaConfrontos(confrontos) {
            try {
                console.log('üîÑ [AN√ÅLISE] Auto-preenchendo sequ√™ncia de confrontos...');
                console.log('üìä [AN√ÅLISE] Confrontos recebidos:', confrontos);
                
                // Obter dados dos times
                const timeCasa = document.getElementById('time-casa-admin').value;
                const timeFora = document.getElementById('time-fora-admin').value;
                
                console.log('üè† [AN√ÅLISE] Time Casa:', timeCasa);
                console.log('‚úàÔ∏è [AN√ÅLISE] Time Fora:', timeFora);
                
                if (!timeCasa || !timeFora) {
                    console.warn('‚ö†Ô∏è [AN√ÅLISE] Times n√£o preenchidos, n√£o √© poss√≠vel gerar sequ√™ncia');
                    mostrarNotificacao('‚ö†Ô∏è Preencha os times antes de carregar confrontos!', 'warning');
                    return;
                }
                
                if (!confrontos || confrontos.length === 0) {
                    console.warn('‚ö†Ô∏è [AN√ÅLISE] Nenhum confronto dispon√≠vel');
                    mostrarNotificacao('‚ö†Ô∏è Nenhum confronto encontrado no arquivo!', 'warning');
                    return;
                }
                
                // ORDENAR POR DATA: Mais recente para mais antiga
                const confrontosOrdenados = confrontos.sort((a, b) => {
                    const dataA = new Date(a.data || '1900-01-01');
                    const dataB = new Date(b.data || '1900-01-01');
                    return dataB - dataA; // Ordem decrescente (mais recente primeiro)
                });
                
                // Usar M√ÅXIMO 10 confrontos (os mais recentes)
                const ultimosConfrontos = confrontosOrdenados.slice(0, 10);
                console.log(`üìä [AN√ÅLISE] Processando ${ultimosConfrontos.length} confrontos ordenados por data (mais recente primeiro)`);
                console.log(`üìÖ [AN√ÅLISE] Datas dos confrontos:`, ultimosConfrontos.map(c => c.data));
                
                // Gerar sequ√™ncia baseada nos vencedores - L√ìGICA CORRIGIDA
                let sequencia = '';
                ultimosConfrontos.forEach((confronto, index) => {
                    console.log(`üîç [AN√ÅLISE] Confronto ${index + 1}:`, confronto);
                    
                    // Extrair dados do confronto
                    const vencedor = (confronto.vencedor || '').trim();
                    const resultado = (confronto.resultado || '').trim();
                    const placar = (confronto.placar || '').trim();
                    
                    console.log(`üìä [AN√ÅLISE] Dados brutos: Vencedor="${vencedor}", Resultado="${resultado}", Placar="${placar}"`);
                    
                    // Extrair nomes dos times (sem estado)
                    const nomeTimeCasa = timeCasa.split('/')[0].toLowerCase().trim();
                    const nomeTimeFora = timeFora.split('/')[0].toLowerCase().trim();
                    
                    console.log(`üè† [AN√ÅLISE] Nomes normalizados: Casa="${nomeTimeCasa}", Fora="${nomeTimeFora}"`);
                    
                    // L√ìGICA MELHORADA: Tentar m√∫ltiplas abordagens
                    let resultadoFinal = '';
                    
                    // 0. VERIFICAR SE HOUVE CORRE√á√ÉO MANUAL
                    if (confronto.resultado_corrigido) {
                        resultadoFinal = confronto.resultado_corrigido;
                        console.log(`üîß [AN√ÅLISE] Usando corre√ß√£o manual: ${resultadoFinal}`);
            } else {
                        // L√ìGICA CORRETA: Campo "resultado" cont√©m o nome do vencedor ou "empate"
                        if (resultado) {
                            const resultadoLower = resultado.toLowerCase().trim();
                            console.log(`üîç [AN√ÅLISE] Analisando resultado: "${resultadoLower}"`);
                            
                            // REGRA SIMPLES: Se resultado = nome do time mandante ‚Üí Vit√≥ria do mandante (V)
                            if (resultadoLower.includes(nomeTimeCasa) || resultadoLower.includes('ponte preta')) {
                                resultadoFinal = 'V';
                                console.log(`‚úÖ [AN√ÅLISE] Vit√≥ria do time mandante (${nomeTimeCasa}): ${resultado}`);
                            } 
                            // Se resultado = nome do time visitante ‚Üí Vit√≥ria do visitante (D)
                            else if (resultadoLower.includes(nomeTimeFora) || resultadoLower.includes('guarani')) {
                                resultadoFinal = 'D';
                                console.log(`‚ùå [AN√ÅLISE] Vit√≥ria do time visitante (${nomeTimeFora}): ${resultado}`);
                            } 
                            // Se resultado = "empate" ‚Üí Empate (E)
                            else if (resultadoLower.includes('empate')) {
                                resultadoFinal = 'E';
                                console.log(`‚öñÔ∏è [AN√ÅLISE] Empate detectado: ${resultado}`);
                            }
                        }
                    }
                    
                    // FALLBACK: Se n√£o conseguiu identificar pelo campo "resultado", assumir empate
                    if (!resultadoFinal) {
                        resultadoFinal = 'E';
                        console.log(`‚ö†Ô∏è [AN√ÅLISE] Resultado n√£o identificado no campo "resultado", assumindo empate`);
                    }
                    
                    sequencia += resultadoFinal + '-';
                    console.log(`üéØ [AN√ÅLISE] Resultado final para confronto ${index + 1}: ${resultadoFinal}`);
                });
                
                // Remover o √∫ltimo h√≠fen
                if (sequencia.endsWith('-')) {
                    sequencia = sequencia.slice(0, -1);
                }
                
                // Preencher o campo de sequ√™ncia
                const campoSequencia = document.getElementById('confrontos-sequence-admin');
                if (campoSequencia) {
                    campoSequencia.value = sequencia;
                    console.log(`‚úÖ [AN√ÅLISE] Campo sequ√™ncia preenchido com sucesso: ${sequencia}`);
                } else {
                    console.error('‚ùå [AN√ÅLISE] Campo confrontos-sequence-admin n√£o encontrado!');
                }
                
                // CALCULAR CONFRONTO DIRETO (V-D-E)
                const vitoriasCasa = (sequencia.match(/V/g) || []).length;
                const vitoriasFora = (sequencia.match(/D/g) || []).length;
                const empates = (sequencia.match(/E/g) || []).length;
                
                console.log(`üìä [AN√ÅLISE] Estat√≠sticas calculadas: Casa ${vitoriasCasa}V, Fora ${vitoriasFora}V, Empates ${empates}E`);
                
                // Preencher o campo de confronto direto com escudos
                const confrontoDireto = `${vitoriasCasa}V-${empates}E-${vitoriasFora}D`;
                const campoConfrontoDireto = document.getElementById('confronto-direto-admin');
                if (campoConfrontoDireto) {
                    campoConfrontoDireto.value = confrontoDireto;
                    console.log(`‚úÖ [AN√ÅLISE] Campo confronto direto preenchido: ${confrontoDireto}`);
                } else {
                    console.error('‚ùå [AN√ÅLISE] Campo confronto-direto-admin n√£o encontrado!');
                }
                
                console.log(`‚úÖ [AN√ÅLISE] Sequ√™ncia final gerada: ${sequencia}`);
                console.log(`üìä [AN√ÅLISE] Baseado em ${ultimosConfrontos.length} confrontos`);
                
                // Mostrar notifica√ß√£o
                mostrarNotificacao(`‚úÖ Sequ√™ncia e confronto direto preenchidos: ${sequencia} | ${confrontoDireto}`, 'success');
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao gerar sequ√™ncia de confrontos:', error);
                mostrarNotificacao(`‚ùå Erro ao gerar sequ√™ncia: ${error.message}`, 'error');
            }
        }
        
        function autoPreencherConfrontos() {
            if (window.confrontosPreview && window.confrontosPreview.length > 0) {
                autoPreencherSequenciaConfrontos(window.confrontosPreview);
                mostrarNotificacao('‚úÖ Campos preenchidos automaticamente!', 'success');
            } else {
                mostrarNotificacao('‚ö†Ô∏è Nenhum confronto carregado para preenchimento', 'warning');
            }
        }
        
        function confirmarConfrontos() {
            console.log('üîÑ [AN√ÅLISE] Iniciando confirma√ß√£o de confrontos...');
            console.log('üìä [AN√ÅLISE] Confrontos dispon√≠veis:', window.confrontosPreview);
            
            if (window.confrontosPreview && window.confrontosPreview.length > 0) {
                console.log(`‚úÖ [AN√ÅLISE] ${window.confrontosPreview.length} confrontos encontrados para confirmar`);
                
                // Auto-preencher a sequ√™ncia
                console.log('üîÑ [AN√ÅLISE] Chamando autoPreencherSequenciaConfrontos...');
                autoPreencherSequenciaConfrontos(window.confrontosPreview);
                
                // Aguardar um pouco e verificar se o campo foi preenchido
                setTimeout(() => {
                    const campoSequencia = document.getElementById('confrontos-sequence-admin');
                    console.log('üìù [AN√ÅLISE] Campo sequ√™ncia ap√≥s preenchimento:', campoSequencia ? campoSequencia.value : 'Campo n√£o encontrado');
                    
                    if (campoSequencia && campoSequencia.value) {
                        console.log('‚úÖ [AN√ÅLISE] Campo preenchido com sucesso!');
                    } else {
                        console.error('‚ùå [AN√ÅLISE] Campo n√£o foi preenchido!');
                    }
                }, 100);
                
                // Preparar dados completos para a p√°gina do usu√°rio
                prepararDadosConfrontosParaUsuario(window.confrontosPreview);
                
                // Fechar o preview
                fecharPreviewConfrontos();
                
                // Mostrar notifica√ß√£o de sucesso
                mostrarNotificacao('‚úÖ Confrontos confirmados e sequ√™ncia preenchida!', 'success');
                
                console.log('‚úÖ [AN√ÅLISE] Confrontos confirmados pelo usu√°rio');
            } else {
                console.warn('‚ö†Ô∏è [AN√ÅLISE] Nenhum confronto dispon√≠vel para confirmar');
                mostrarNotificacao('‚ö†Ô∏è Nenhum confronto dispon√≠vel para confirmar', 'warning');
            }
        }
        
        function prepararDadosConfrontosParaUsuario(confrontos) {
            try {
                console.log('üé® [AN√ÅLISE] Preparando dados dos confrontos para a p√°gina do usu√°rio...');
                
                const timeCasa = document.getElementById('time-casa-admin').value;
                const timeFora = document.getElementById('time-fora-admin').value;
                const escudoCasa = document.getElementById('escudo-casa-path').value;
                const escudoFora = document.getElementById('escudo-fora-path').value;
                
                // ORDENAR POR DATA: Mais recente para mais antiga (igual √†s outras fun√ß√µes)
                const confrontosOrdenados = confrontos.sort((a, b) => {
                    const dataA = new Date(a.data || '1900-01-01');
                    const dataB = new Date(b.data || '1900-01-01');
                    return dataB - dataA; // Ordem decrescente (mais recente primeiro)
                });
                
                // Usar M√ÅXIMO 10 confrontos (os mais recentes)
                const ultimosConfrontos = confrontosOrdenados.slice(0, 10);
                console.log('üìÖ [AN√ÅLISE] Confrontos ordenados por data:', ultimosConfrontos.map(c => c.data));
                
                // Preparar dados formatados para a p√°gina do usu√°rio
                const dadosConfrontos = ultimosConfrontos.map((confronto, index) => {
                    const data = confronto.data || 'Data n√£o dispon√≠vel';
                    const placar = confronto.placar || 'Placar n√£o dispon√≠vel';
                    const resultado = confronto.resultado || 'Resultado n√£o dispon√≠vel';
                    
                    // Determinar qual escudo mostrar baseado no campo "resultado" do CSV
                    let escudoMostrar = '/static/placeholder-team-logo.svg';
                    let nomeTimeMostrar = resultado;
                    
                    // L√ìGICA CORRETA: Usar o campo "resultado" diretamente do CSV
                    if (resultado.toLowerCase().includes('ponte preta')) {
                        escudoMostrar = escudoCasa || '/static/placeholder-team-logo.svg';
                        nomeTimeMostrar = timeCasa;
                    } else if (resultado.toLowerCase().includes('guarani')) {
                        escudoMostrar = escudoFora || '/static/placeholder-team-logo.svg';
                        nomeTimeMostrar = timeFora;
                    } else if (resultado.toLowerCase().includes('empate')) {
                        escudoMostrar = '/static/escudos/Empate.png';
                        nomeTimeMostrar = 'Empate';
                    }
                    
                    return {
                        numero: index + 1,
                        data: data,
                        placar: placar,
                        resultado: resultado,
                        vencedor: nomeTimeMostrar,
                        escudo: escudoMostrar,
                        placar_display: placar  // Adicionar placar para exibi√ß√£o
                    };
                });
                
                // Armazenar dados preparados para uso posterior
                window.dadosConfrontosUsuario = dadosConfrontos;
                
                console.log('‚úÖ [AN√ÅLISE] Dados dos confrontos preparados para o usu√°rio:', dadosConfrontos);
                console.log('üìä [AN√ÅLISE] Total de confrontos preparados:', dadosConfrontos.length);
                
                // Mostrar resumo dos dados preparados
                mostrarNotificacao(`üé® Dados de ${dadosConfrontos.length} confrontos preparados com escudos, datas e placares!`, 'info');
                
                // Dados preparados com sucesso (fun√ß√£o de preview removida temporariamente)
                console.log('üé® [AN√ÅLISE] Dados preparados para o usu√°rio:', dadosConfrontos);
                
            } catch (error) {
                console.error('‚ùå [AN√ÅLISE] Erro ao preparar dados dos confrontos:', error);
                mostrarNotificacao(`‚ùå Erro ao preparar dados: ${error.message}`, 'error');
            }
        }
        
        function fecharPreviewConfrontos() {
            const container = document.getElementById('preview-confrontos');
            container.style.display = 'none';
            
            // Limpar dados tempor√°rios
            window.confrontosPreview = null;
            
            console.log('üîÑ [AN√ÅLISE] Preview de confrontos fechado');
        }
        
        // FUN√á√ÉO PARA CORRIGIR EMPATES MANUALMENTE
        function corrigirEmpates() {
            console.log('üîß [CORRE√á√ÉO] Iniciando corre√ß√£o manual de empates...');
            
            if (!window.confrontosPreview || window.confrontosPreview.length === 0) {
                mostrarNotificacao('‚ö†Ô∏è Nenhum confronto carregado para corre√ß√£o!', 'warning');
                return;
            }
            
            // Criar modal de corre√ß√£o
            const modal = document.createElement('div');
            modal.id = 'modal-correcao-empates';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: var(--cor-destaque-primaria); margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-edit"></i> Corrigir Resultados dos Confrontos
                    </h3>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            <strong>Instru√ß√µes:</strong> Marque os confrontos que s√£o empates. 
                            Os confrontos marcados como empates ser√£o tratados como "E" na sequ√™ncia.
                        </p>
                    </div>
                    
                    <div id="lista-confrontos-correcao" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <!-- Confrontos ser√£o inseridos aqui -->
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; padding-top: 20px; border-top: 1px solid #ddd;">
                        <button onclick="aplicarCorrecoes()" style="padding: 10px 25px; background: #00ff00; color: black; font-weight: bold; border: 2px solid #00cc00; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-check"></i> Aplicar Corre√ß√µes
                        </button>
                        <button onclick="fecharModalCorrecao()" style="padding: 10px 25px; background: #666; color: white; border: 2px solid #555; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Preencher lista de confrontos
            const lista = document.getElementById('lista-confrontos-correcao');
            
            // ORDENAR POR DATA: Mais recente para mais antiga (igual √†s outras fun√ß√µes)
            const confrontosOrdenados = window.confrontosPreview.sort((a, b) => {
                const dataA = new Date(a.data || '1900-01-01');
                const dataB = new Date(b.data || '1900-01-01');
                return dataB - dataA; // Ordem decrescente (mais recente primeiro)
            });
            
            const confrontos = confrontosOrdenados.slice(0, 10);
            console.log(`üìÖ [CORRE√á√ÉO] Mostrando confrontos ordenados por data:`, confrontos.map(c => c.data));
            
            confrontos.forEach((confronto, index) => {
                const div = document.createElement('div');
                div.style.cssText = `
                    padding: 15px;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    background: #f9f9f9;
                `;
                
                div.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="empate-${index}" style="transform: scale(1.2);">
                        <label for="empate-${index}" style="flex: 1; cursor: pointer;">
                            <strong>Confronto ${index + 1}:</strong><br>
                            <span style="color: #666; font-size: 14px;">
                                ${confronto.data || 'Data n√£o dispon√≠vel'}<br>
                                ${confronto.vencedor || 'Placar n√£o dispon√≠vel'}<br>
                                <em>${confronto.resultado || 'Resultado n√£o dispon√≠vel'}</em>
                            </span>
                        </label>
                </div>
            `;
            
                lista.appendChild(div);
            });
            
            console.log('‚úÖ [CORRE√á√ÉO] Modal de corre√ß√£o criado com sucesso');
        }
        
        // FUN√á√ÉO PARA APLICAR AS CORRE√á√ïES
        function aplicarCorrecoes() {
            console.log('üîß [CORRE√á√ÉO] Aplicando corre√ß√µes...');
            
            if (!window.confrontosPreview) {
                mostrarNotificacao('‚ùå Nenhum confronto dispon√≠vel para corre√ß√£o!', 'error');
                return;
            }
            
            const confrontos = window.confrontosPreview.slice(0, 10);
            const confrontosCorrigidos = [];
            
            // Processar cada confronto
            confrontos.forEach((confronto, index) => {
                const checkbox = document.getElementById(`empate-${index}`);
                const isEmpate = checkbox ? checkbox.checked : false;
                
                if (isEmpate) {
                    // Marcar como empate
                    confrontosCorrigidos.push({
                        ...confronto,
                        resultado_corrigido: 'E',
                        corrigido: true
                    });
                    console.log(`‚úÖ [CORRE√á√ÉO] Confronto ${index + 1} marcado como empate`);
                } else {
                    // Manter resultado original
                    confrontosCorrigidos.push({
                        ...confronto,
                        resultado_corrigido: null,
                        corrigido: false
                });
            }
        });
            
            // Atualizar dados globais
            window.confrontosPreview = confrontosCorrigidos;
            
            // Fechar modal
            fecharModalCorrecao();
            
            // Mostrar notifica√ß√£o
            const empatesMarcados = confrontosCorrigidos.filter(c => c.corrigido).length;
            mostrarNotificacao(`‚úÖ ${empatesMarcados} confrontos marcados como empates!`, 'success');
            
            console.log(`üéØ [CORRE√á√ÉO] ${empatesMarcados} empates aplicados com sucesso`);
        }
        
        // FUN√á√ÉO PARA FECHAR MODAL DE CORRE√á√ÉO
        function fecharModalCorrecao() {
            const modal = document.getElementById('modal-correcao-empates');
            if (modal) {
                modal.remove();
                console.log('üîÑ [CORRE√á√ÉO] Modal de corre√ß√£o fechado');
            }
        }
        
        // Fun√ß√£o para testar se a imagem do empate est√° carregando
        function testarImagemEmpate() {
            const img = new Image();
            img.onload = function() {
                console.log('‚úÖ [TESTE] NOVA Imagem Empate.png carregada com sucesso!');
                console.log('üìè [TESTE] Dimens√µes:', this.width, 'x', this.height);
                console.log('üìä [TESTE] Tamanho do arquivo: ~19KB (melhorado!)');
            };
            img.onerror = function() {
                console.log('‚ùå [TESTE] Erro ao carregar Empate.png');
            };
            img.src = '/static/escudos/Empate.png?v=' + Date.now();
        }
        
        // Fun√ß√£o de teste para verificar se o campo est√° funcionando
        function testarPreenchimentoCampo() {
            const campo = document.getElementById('confrontos-sequence-admin');
            if (campo) {
                campo.value = 'V-V-D-V-E-TESTE';
                console.log('üß™ [TESTE] Campo preenchido com valor de teste:', campo.value);
                mostrarNotificacao('üß™ Campo preenchido com valor de teste!', 'info');
            } else {
                console.error('‚ùå [TESTE] Campo n√£o encontrado!');
                mostrarNotificacao('‚ùå Campo n√£o encontrado!', 'error');
            }
        }
        

        // === SISTEMA DE ABAS ===
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Carregar dados espec√≠ficos da aba
            if (tabName === 'classificacao') {
            // Aba classifica√ß√£o ativada
                // Carregar diretamente sem setTimeout
                if (!window.carregandoClassificacao) {
                    carregarClassificacao();
                }
            }
            if (tabName === 'clubes') carregarClubes();
            if (tabName === 'estatisticas') carregarEstatisticas();
            if (tabName === 'dashboard') carregarDashboard();
            if (tabName === 'jogos-loteca') {
                // Aba jogos loteca ativada
                setTimeout(() => {
                    // Inicializando sistema de concursos...
                    carregarListaConcursos();
                    carregarUltimoConcurso();
                    // Carregar dados salvos automaticamente
                    carregarDadosSalvos();
                }, 200);
            }
        }

        // === SISTEMA DE MENSAGENS ===
        function mostrarSucesso(mensagem) {
            mostrarNotificacao(`‚úÖ ${mensagem}`, 'success');
        }

        function mostrarErro(mensagem) {
            mostrarNotificacao(`‚ùå ${mensagem}`, 'error');
        }
        
        function mostrarNotificacao(mensagem, tipo = 'info') {
            // Remover notifica√ß√µes anteriores
            const notificacoesExistentes = document.querySelectorAll('.notification');
            notificacoesExistentes.forEach(n => n.remove());
            
            // Criar nova notifica√ß√£o
            const notification = document.createElement('div');
            notification.className = `notification ${tipo}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${mensagem}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 0; margin-left: 10px;">√ó</button>
                </div>
            `;
            
            // Adicionar ao body
            document.body.appendChild(notification);
            
            // Mostrar com anima√ß√£o
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-remover ap√≥s 5 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // === DASHBOARD ===
        async function carregarDashboard() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/dashboard-stats`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    // Verificar se os elementos existem antes de tentar acess√°-los
                    const totalClubes = document.getElementById('totalClubes');
                    const serieAClubes = document.getElementById('serieAClubes');
                    const serieBClubes = document.getElementById('serieBClubes');
                    const ultimaSync = document.getElementById('ultimaSync');
                    
                    if (totalClubes) totalClubes.textContent = data.total_clubes || '0';
                    if (serieAClubes) serieAClubes.textContent = data.serie_a || '0';
                    if (serieBClubes) serieBClubes.textContent = data.serie_b || '0';
                    
                    // Formatar data da √∫ltima sincroniza√ß√£o
                    if (ultimaSync) {
                    if (data.ultima_sincronizacao) {
                        const dataObj = new Date(data.ultima_sincronizacao);
                        const dataFormatada = dataObj.toLocaleString('pt-BR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                            ultimaSync.textContent = dataFormatada;
                    } else {
                            ultimaSync.textContent = 'Nunca';
                        }
                    }
                } else {
                    mostrarErro('Erro ao carregar dashboard: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
                mostrarErro('Erro de conex√£o com o servidor');
            }
        }

        // === GEST√ÉO DE CLUBES ===
        let clubesData = [];

        async function carregarClubes() {
            // Carregando clubes...
            try {
                // Preencher o select (se ainda n√£o estiver populado)
                const select = document.getElementById('clubeEstatisticas');
                if (select && select.options.length <= 1) {
                    const clubes = [
                        'Flamengo','Palmeiras','Botafogo','Cruzeiro','Corinthians',
                        'Vasco da Gama','Bahia','Atl√©tico Mineiro','Santos','Gr√™mio',
                        'Internacional','S√£o Paulo','Fortaleza','Fluminense','Red Bull Bragantino',
                        'Cear√°','Sport Recife','Vit√≥ria','Juventude','Mirassol'
                    ];
                    
                    select.innerHTML = '<option value="">Selecione um clube...</option>';
                    clubes.forEach(nome => {
                        const opt = document.createElement('option');
                        opt.value = nome.toLowerCase().replace(/\s+/g, '-').replace('√£', 'a').replace('√©', 'e').replace('√ß', 'c');
                        opt.textContent = nome;
                        select.appendChild(opt);
                    });
                    // Select populado com clubes
                }

                // Elementos da tabela (podem n√£o existir nesta tela)
                const loading = document.getElementById('loadingClubes');
                const table = document.getElementById('tableClubes');
                const tbody = document.getElementById('tbodyClubes');

                // Se a tabela N√ÉO existe nesta p√°gina, apenas sai sem erro
                if (!loading || !table || !tbody) {
                    // Elementos de lista de clubes n√£o existem nesta tela
                    return;
                }

                // Se existir, fluxo original:
                loading.style.display = 'block';
                table.style.display = 'none';

                // TODO: buscar e renderizar a lista (se/quando voc√™ usar essa tela)
                renderizarClubes([]); // por enquanto, mant√©m vazio
                loading.style.display = 'none';
                table.style.display = '';
            } catch (err) {
                console.error('Erro ao carregar clubes (vers√£o segura):', err);
            }
        }

        function renderizarClubes(lista) {
            const tbody = document.getElementById('tbodyClubes');
            if (!tbody) { 
                // tbodyClubes inexistente. Abortando renderiza√ß√£o
                return; 
            }
            tbody.innerHTML = '';
            // monte as linhas quando for usar a tela de listagem
        }

        function filtrarClubes() {
            // Usar getter seguro
            const el = $('searchClubes');
            const searchTerm = el ? el.value.toLowerCase() : '';
            
            if (!searchTerm) {
                console.warn('‚ö†Ô∏è [FILTRO] Elemento searchClubes n√£o encontrado na DOM atual');
                return;
            }
            
            const clubesFiltrados = clubesData.filter(clube => 
                clube.nome_fantasia.toLowerCase().includes(searchTerm) ||
                clube.abreviacao.toLowerCase().includes(searchTerm) ||
                (clube.estado && clube.estado.toLowerCase().includes(searchTerm))
            );
            renderizarClubes(clubesFiltrados);
        }

        // Fun√ß√£o removida - select agora √© preenchido diretamente em carregarClubes()

        async function salvarClube() {
            // Usar getters seguros
            const clube = {
                nome_fantasia: val('nomeFantasia'),
                abreviacao: val('abreviacao'),
                estado: val('estado'),
                serie: val('serie'),
                id: val('cartolaId'),
                escudo_url: val('escudoUrl'),
                cor_primaria: val('corPrimaria'),
                cor_secundaria: val('corSecundaria'),
                admin_key: ADMIN_KEY
            };
            
            if (!clube.nome_fantasia || !clube.abreviacao) {
                mostrarErro('Nome e abrevia√ß√£o s√£o obrigat√≥rios');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/clubes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(clube)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarSucesso('Clube salvo com sucesso!');
                    limparFormClube();
                    carregarClubes();
                    carregarDashboard(); // Atualizar estat√≠sticas
                } else {
                    mostrarErro('Erro ao salvar clube: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao salvar clube:', error);
                mostrarErro('Erro de conex√£o ao salvar clube');
            }
        }

        function limparFormClube() {
            const campos = [
                { id: 'nomeFantasia', value: '' },
                { id: 'abreviacao', value: '' },
                { id: 'estado', value: '' },
                { id: 'serie', value: '' },
                { id: 'cartolaId', value: '' },
                { id: 'escudoUrl', value: '' },
                { id: 'corPrimaria', value: '#FF0000' },
                { id: 'corSecundaria', value: '#000000' }
            ];
            
            campos.forEach(campo => {
                const el = $(campo.id);
                if (el) el.value = campo.value;
            });
        }

        function editarClube(id) {
            const clube = clubesData.find(c => c.id === id);
            if (clube) {
                document.getElementById('nomeFantasia').value = clube.nome_fantasia;
                document.getElementById('abreviacao').value = clube.abreviacao;
                document.getElementById('estado').value = clube.estado || '';
                document.getElementById('serie').value = clube.serie || '';
                document.getElementById('cartolaId').value = clube.id;
                document.getElementById('escudoUrl').value = clube.escudo_60x60 || '';
                document.getElementById('corPrimaria').value = clube.cor_primaria || '#FF0000';
                document.getElementById('corSecundaria').value = clube.cor_secundaria || '#000000';
            }
        }

        async function excluirClube(id) {
            if (confirm('Tem certeza que deseja excluir este clube?')) {
                try {
                    const response = await fetch(`${API_BASE}/api/admin/clubes/${id}`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ admin_key: ADMIN_KEY })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        mostrarSucesso('Clube exclu√≠do com sucesso!');
                        carregarClubes();
                        carregarDashboard(); // Atualizar estat√≠sticas
                    } else {
                        mostrarErro('Erro ao excluir clube: ' + result.message);
                    }
                } catch (error) {
                    console.error('Erro ao excluir clube:', error);
                    mostrarErro('Erro de conex√£o ao excluir clube');
                }
            }
        }

        // === GEST√ÉO DE ESTAT√çSTICAS ===
        let estatisticasData = [];

        async function carregarEstatisticas() {
            const loading = document.getElementById('loadingEstatisticas');
            const table = document.getElementById('tableEstatisticas');
            
            if (loading) loading.style.display = 'block';
            if (table) table.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/estatisticas`);
                const result = await response.json();
                
                if (result.success) {
                    estatisticasData = result.data;
                    renderizarEstatisticas(estatisticasData);
                    
                    if (loading) loading.style.display = 'none';
                    if (table) table.style.display = 'table';
                } else {
                    mostrarErro('Erro ao carregar estat√≠sticas: ' + result.message);
                    if (loading) loading.style.display = 'none';
                }
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                mostrarErro('Erro de conex√£o ao carregar estat√≠sticas');
                if (loading) loading.style.display = 'none';
            }
        }

        function renderizarEstatisticas(estatisticas) {
            const tbody = document.getElementById('tbodyEstatisticas');
            if (!tbody) {
                // Elemento tbodyEstatisticas n√£o encontrado
                return;
            }
            tbody.innerHTML = '';
            
            estatisticas.forEach(stat => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${stat.nome_fantasia || stat.clube_nome}</td>
                    <td>${stat.total_atletas || '-'}</td>
                    <td>${stat.pct_provaveis ? stat.pct_provaveis.toFixed(1) + '%' : '-'}</td>
                    <td>${stat.media_pontos_elenco ? stat.media_pontos_elenco.toFixed(2) : '-'}</td>
                    <td>${stat.preco_medio ? 'C$ ' + stat.preco_medio.toFixed(2) : '-'}</td>
                    <td>${stat.rating ? stat.rating.toFixed(3) : '-'}</td>
                    <td><span class="status-badge">${stat.fonte}</span></td>
                    <td>${stat.data_atualizacao ? new Date(stat.data_atualizacao).toLocaleString('pt-BR') : '-'}</td>
                    <td>
                        <button class="btn-secondary" onclick="editarEstatisticas(${stat.clube_id})" style="margin-right: 5px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-danger" onclick="excluirEstatisticas(${stat.clube_id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function salvarEstatisticas() {
            const estatisticas = {
                clube_id: document.getElementById('clubeEstatisticas').value,
                total_atletas: document.getElementById('totalAtletas').value,
                pct_provaveis: document.getElementById('pctProvaveis').value,
                media_pontos_elenco: document.getElementById('mediaPontos').value,
                preco_medio: document.getElementById('precoMedio').value,
                rating: document.getElementById('rating').value,
                fonte: document.getElementById('fonte').value,
                admin_key: ADMIN_KEY
            };
            
            if (!estatisticas.clube_id) {
                mostrarErro('Selecione um clube');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/estatisticas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(estatisticas)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarSucesso('Estat√≠sticas salvas com sucesso!');
                    carregarEstatisticas();
                    carregarDashboard(); // Atualizar dashboard
                } else {
                    mostrarErro('Erro ao salvar estat√≠sticas: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao salvar estat√≠sticas:', error);
                mostrarErro('Erro de conex√£o ao salvar estat√≠sticas');
            }
        }

        // Fun√ß√£o limparFormEstatisticas removida - n√£o √© mais necess√°ria

        function editarEstatisticas(clubeId) {
            const stat = estatisticasData.find(s => s.clube_id === clubeId);
            if (stat) {
                document.getElementById('clubeEstatisticas').value = stat.clube_id;
                document.getElementById('totalAtletas').value = stat.total_atletas || '';
                document.getElementById('pctProvaveis').value = stat.pct_provaveis || '';
                document.getElementById('mediaPontos').value = stat.media_pontos_elenco || '';
                document.getElementById('precoMedio').value = stat.preco_medio || '';
                document.getElementById('rating').value = stat.rating || '';
                document.getElementById('fonte').value = stat.fonte || 'MANUAL';
            }
        }

        function excluirEstatisticas(clubeId) {
            if (confirm('Tem certeza que deseja excluir estas estat√≠sticas?')) {
                try {
                    // Aqui seria a chamada real para a API
                    mostrarSucesso('Estat√≠sticas exclu√≠das com sucesso!');
                    carregarEstatisticas();
                } catch (error) {
                    console.error('Erro ao excluir estat√≠sticas:', error);
                    mostrarErro('Erro ao excluir estat√≠sticas');
                }
            }
        }

        // === FUN√á√ïES DA ABA CLASSIFICA√á√ÉO ===
        function alterarCampeonato() {
            const campeonato = document.getElementById('campeonatoSelect').value;
            // Alterando para: ${campeonato}
            
            // Limpar tabela atual
            const bodyEl = document.getElementById('classificacaoBody');
            if (bodyEl) {
                bodyEl.innerHTML = '<tr><td colspan="12" style="text-align: center; padding: 20px; color: #666; font-style: italic;">üîÑ Carregando nova classifica√ß√£o...</td></tr>';
            }
            
            // Carregar nova classifica√ß√£o diretamente
            carregarClassificacao();
        }
        
        // FUN√á√ÉO PARA ATUALIZAR √öLTIMOS CONFRONTOS AUTOMATICAMENTE
        async function atualizarUltimosConfrontosAutomatico() {
            // Atualizando √∫ltimos confrontos automaticamente...
            
            try {
                const adminKey = localStorage.getItem('admin_key') || 'loteca2024admin';
                
                const response = await fetch(`${API_BASE}/api/admin/atualizar-ultimos-confrontos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        admin_key: adminKey
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        // √öltimos confrontos atualizados com sucesso!
                    } else {
                        // Erro na atualiza√ß√£o: {data.message}
                    }
                } else {
                    // Erro HTTP: {response.status}
                }
            } catch (error) {
                // Erro na requisi√ß√£o: {error}
                // N√£o bloquear o carregamento se a atualiza√ß√£o falhar
            }
        }
        
        // FUN√á√ÉO PARA ATUALIZAR √öLTIMOS CONFRONTOS MANUALMENTE (BOT√ÉO)
        async function atualizarUltimosConfrontosManual() {
            // Atualizando √∫ltimos confrontos manualmente...
            
            // Mostrar loading
            const loadingEl = document.getElementById('loadingClassificacao');
            if (loadingEl) {
                loadingEl.style.display = 'block';
                loadingEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> üîÑ Atualizando √∫ltimos confrontos...';
            }
            
            try {
                const adminKey = localStorage.getItem('admin_key') || 'loteca2024admin';
                
                const response = await fetch(`${API_BASE}/api/admin/atualizar-ultimos-confrontos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        admin_key: adminKey
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        console.log('‚úÖ [MANUAL-UPDATE] √öltimos confrontos atualizados com sucesso!');
                        mostrarSucesso('√öltimos confrontos atualizados com sucesso!');
                        
                        // Recarregar a classifica√ß√£o para mostrar os dados atualizados
                        setTimeout(() => {
                            carregarClassificacao();
                        }, 1000);
                    } else {
                        console.error('‚ùå [MANUAL-UPDATE] Erro na atualiza√ß√£o:', data.message);
                        mostrarErro('Erro ao atualizar: ' + data.message);
                    }
                } else {
                    console.error('‚ùå [MANUAL-UPDATE] Erro HTTP:', response.status);
                    mostrarErro('Erro HTTP: ' + response.status);
                }
            } catch (error) {
                console.error('üí• [MANUAL-UPDATE] Erro na requisi√ß√£o:', error);
                mostrarErro('Erro na requisi√ß√£o: ' + error.message);
            } finally {
                // Esconder loading
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
            }
        }

        // === FUN√á√ÉO PARA CARREGAR CLASSIFICA√á√ÉO ===
        async function carregarClassificacao() {
            // Iniciando carregamento da classifica√ß√£o...
            
            const campeonatoSelect = document.getElementById('campeonatoSelect');
            const loadingEl = document.getElementById('loadingClassificacao');
            const bodyEl = document.getElementById('classificacaoBody');
            
            // Elementos DOM encontrados
            
            const campeonato = campeonatoSelect ? campeonatoSelect.value : 'serie-a';
            let adminKey = localStorage.getItem('admin_key');
            
            // FOR√áAR admin key se n√£o existir
            if (!adminKey) {
                // Admin key n√£o encontrada no localStorage! Usando padr√£o...
                adminKey = 'loteca2024admin';
                localStorage.setItem('admin_key', adminKey);
            }
            
            // Configura√ß√µes carregadas
            
            if (loadingEl) {
                loadingEl.style.display = 'block';
                // Loading exibido
            }
            
            if (bodyEl) {
                bodyEl.innerHTML = '';
                // Tabela limpa
            }
            
            try {
                const requestData = {
                    admin_key: adminKey,
                    campeonato: campeonato
                };
                
                // Enviando requisi√ß√£o...
                
                const response = await fetch(`${API_BASE}/api/admin/classificacao`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });
                
                // Resposta recebida
                
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                    // Loading escondido
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                // Dados JSON recebidos
                
                if (data.success && data.classificacao) {
                    // Dados v√°lidos recebidos!
                    renderizarClassificacao(data.classificacao);
                } else {
                    // Dados inv√°lidos ou vazios
                    if (bodyEl) {
                        bodyEl.innerHTML = '<tr><td colspan="12" style="text-align: center; padding: 20px; color: #666;">Erro ao carregar dados</td></tr>';
                    }
                }
                
            } catch (error) {
                // Erro na requisi√ß√£o: {error}
                
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
                
                if (bodyEl) {
                    bodyEl.innerHTML = '<tr><td colspan="12" style="text-align: center; padding: 20px; color: #666;">Erro ao carregar dados</td></tr>';
                }
            }
            
            // Carregamento finalizado
        }

        function renderizarClassificacao(classificacao) {
            // Iniciando renderiza√ß√£o...
            
            const bodyEl = document.getElementById('classificacaoBody');
            // Body element encontrado
            
            if (!bodyEl) {
                // Element classificacaoBody n√£o encontrado!
                return;
            }
            
            bodyEl.innerHTML = '';
            // Tbody limpo
            
            if (!classificacao || classificacao.length === 0) {
                // Nenhum dado para renderizar
                bodyEl.innerHTML = '<tr><td colspan="12" style="text-align: center; padding: 20px; color: #666;">Nenhum dado encontrado</td></tr>';
                return;
            }
            
            // Detectar tipo de campeonato baseado nos campos
            const campeonato = document.getElementById('campeonatoSelect').value;
            const isPremierLeague = campeonato === 'premier-league';
            const isLaLiga = campeonato === 'la-liga';
            const isLigue1 = campeonato === 'ligue1';
            const isChampionsLeague = campeonato === 'champions-league';
            const isInternacional = isPremierLeague || isLaLiga || isLigue1 || isChampionsLeague;
            
            // Renderizando {classificacao.length} times...
            
            classificacao.forEach((time, index) => {
                // Renderizando time {index + 1}
                const row = document.createElement('tr');
                
                // Determinar zona (libertadores, sul-americana, rebaixamento)
                const zonaClass = time.zona ? `zona-${time.zona.replace('-', '')}` : '';
                
                row.className = `team-row ${zonaClass}`;
                
                if (isInternacional) {
                    // Renderiza√ß√£o espec√≠fica para campeonatos internacionais (Premier League e La Liga)
                    row.innerHTML = `
                        <td style="font-weight: bold; background: #e8f4f8; color: #1a202c; border: 1px solid #cbd5e0;">${time.posicao}</td>
                        <td style="position: relative;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="editable" contenteditable="true" data-field="clube" data-id="${time.id}" 
                                      style="font-weight: bold; background: #e0f2fe; color: #1a202c; border: 2px dashed #0ea5e9; padding: 8px; font-size: 14px; min-width: 120px; display: inline-block;" 
                                      data-original="${time.clube}">${time.clube}</span>
                                ${time.zona ? `<span class="zona-badge zona-${time.zona.replace('-', '')}" style="background: #10b981; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${time.zona}</span>` : ''}
                                ${time.badge ? `<span class="badge-especial" style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${time.badge}</span>` : ''}
                            </div>
                        </td>
                        <td class="editable" contenteditable="true" data-field="pts" data-id="${time.id}" 
                            style="font-weight: bold; color: #1e40af; background: #fef9e7; border: 2px dashed #f59e0b; padding: 8px; text-align: center; font-size: 14px;" 
                            data-original="${time.pts}">${time.pts}</td>
                        <td class="editable" contenteditable="true" data-field="pj" data-id="${time.id}" 
                            style="color: #374151; background: #f3f4f6; border: 2px dashed #9ca3af; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.pj}">${time.pj}</td>
                        <td class="editable" contenteditable="true" data-field="vit" data-id="${time.id}" 
                            style="color: #065f46; background: #ecfdf5; border: 2px dashed #10b981; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.vit}">${time.vit}</td>
                        <td class="editable" contenteditable="true" data-field="e" data-id="${time.id}" 
                            style="color: #92400e; background: #fffbeb; border: 2px dashed #f59e0b; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.e}">${time.e}</td>
                        <td class="editable" contenteditable="true" data-field="der" data-id="${time.id}" 
                            style="color: #991b1b; background: #fef2f2; border: 2px dashed #ef4444; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.der}">${time.der}</td>
                        <td class="editable" contenteditable="true" data-field="gm" data-id="${time.id}" 
                            style="color: #065f46; background: #ecfdf5; border: 2px dashed #10b981; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.gm}">${time.gm}</td>
                        <td class="editable" contenteditable="true" data-field="gc" data-id="${time.id}" 
                            style="color: #991b1b; background: #fef2f2; border: 2px dashed #ef4444; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.gc}">${time.gc}</td>
                        <td style="font-weight: bold; color: ${time.sg >= 0 ? '#065f46' : '#991b1b'}; background: #e8f4f8; text-align: center; border: 1px solid #cbd5e0; font-size: 14px;">${time.sg >= 0 ? '+' : ''}${time.sg}</td>
                        <td style="background: #e8f4f8; border: 1px solid #cbd5e0;">
                            <div class="editable" contenteditable="true" data-field="zona" data-id="${time.id}" 
                                 style="padding: 4px; text-align: center; font-size: 12px; font-weight: bold;" 
                                 data-original="${time.zona || ''}">${time.zona || '-'}</div>
                        </td>
                        <td style="background: #e8f4f8; border: 1px solid #cbd5e0;">
                            <div style="display: flex; gap: 3px; justify-content: center;" data-time-id="${time.id}">
                                ${(time.ultimos_confrontos || time.ultimas_5 || 'NNNNN').split('').map((result, index) => 
                                    `<span class="resultado-bolinha clickable" 
                                           data-time-id="${time.id}" 
                                           data-jogo-index="${index}" 
                                           data-resultado="${result}"
                                           onclick="alterarResultado(this)"
                                           style="width: 18px; height: 18px; border-radius: 50%; display: inline-block; font-size: 10px; text-align: center; line-height: 18px; color: white; font-weight: bold; cursor: pointer; transition: all 0.2s ease; border: 1px solid #374151; background: ${getCorResultado(result)};"
                                           title="Clique para alterar: ${getDescricaoResultado(result)}">${result}</span>`
                                ).join('')}
                            </div>
                        </td>
                    `;
                } else {
                    // Renderiza√ß√£o para Brasileir√£o (S√©rie A e B)
                    row.innerHTML = `
                        <td style="font-weight: bold; background: #e8f4f8; color: #1a202c; border: 1px solid #cbd5e0;">${time.posicao}</td>
                        <td style="position: relative;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="editable" contenteditable="true" data-field="time" data-id="${time.id}" 
                                      style="font-weight: bold; background: #e0f2fe; color: #1a202c; border: 2px dashed #0ea5e9; padding: 8px; font-size: 14px; min-width: 120px; display: inline-block;" 
                                      data-original="${time.time}">${time.time}</span>
                                ${time.zona ? `<span class="zona-badge zona-${time.zona.replace('-', '')}" style="background: #10b981; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${time.zona}</span>` : ''}
                            </div>
                        </td>
                        <td class="editable" contenteditable="true" data-field="pontos" data-id="${time.id}" 
                            style="font-weight: bold; color: #1e40af; background: #fef9e7; border: 2px dashed #f59e0b; padding: 8px; text-align: center; font-size: 14px;" 
                            data-original="${time.pontos}">${time.pontos}</td>
                        <td class="editable" contenteditable="true" data-field="jogos" data-id="${time.id}" 
                            style="color: #374151; background: #f3f4f6; border: 2px dashed #9ca3af; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.jogos}">${time.jogos}</td>
                        <td class="editable" contenteditable="true" data-field="vitorias" data-id="${time.id}" 
                            style="color: #065f46; background: #ecfdf5; border: 2px dashed #10b981; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.vitorias}">${time.vitorias}</td>
                        <td class="editable" contenteditable="true" data-field="empates" data-id="${time.id}" 
                            style="color: #92400e; background: #fffbeb; border: 2px dashed #f59e0b; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.empates}">${time.empates}</td>
                        <td class="editable" contenteditable="true" data-field="derrotas" data-id="${time.id}" 
                            style="color: #991b1b; background: #fef2f2; border: 2px dashed #ef4444; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.derrotas}">${time.derrotas}</td>
                        <td class="editable" contenteditable="true" data-field="gols_pro" data-id="${time.id}" 
                            style="color: #065f46; background: #ecfdf5; border: 2px dashed #10b981; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.gols_pro}">${time.gols_pro}</td>
                        <td class="editable" contenteditable="true" data-field="gols_contra" data-id="${time.id}" 
                            style="color: #991b1b; background: #fef2f2; border: 2px dashed #ef4444; padding: 8px; text-align: center; font-size: 14px; font-weight: 600;" 
                            data-original="${time.gols_contra}">${time.gols_contra}</td>
                        <td style="font-weight: bold; color: ${time.saldo_gols >= 0 ? '#065f46' : '#991b1b'}; background: #e8f4f8; text-align: center; border: 1px solid #cbd5e0; font-size: 14px;">${time.saldo_gols >= 0 ? '+' : ''}${time.saldo_gols}</td>
                        <td style="font-weight: bold; background: #e8f4f8; color: #1a202c; text-align: center; border: 1px solid #cbd5e0; font-size: 14px;">${time.aproveitamento}%</td>
                        <td style="background: #e8f4f8; border: 1px solid #cbd5e0;">
                            <div style="display: flex; gap: 5px; justify-content: center;" data-time-id="${time.id}">
                                ${(time.ultimos_confrontos || time.ultimos_jogos || 'NNNNN').split('').map((result, index) => 
                                    `<span class="resultado-bolinha clickable" 
                                           data-time-id="${time.id}" 
                                           data-jogo-index="${index}" 
                                           data-resultado="${result}"
                                           onclick="alterarResultado(this)"
                                           style="width: 20px; height: 20px; border-radius: 50%; display: inline-block; font-size: 11px; text-align: center; line-height: 20px; color: white; font-weight: bold; cursor: pointer; transition: all 0.2s ease; border: 2px solid #374151; background: ${getCorResultado(result)};"
                                           title="Clique para alterar: ${getDescricaoResultado(result)}">${result}</span>`
                                ).join('')}
                            </div>
                        </td>
                    `;
                }
                
                bodyEl.appendChild(row);
                // Time {index + 1} adicionado ao DOM
            });
            
            // Adicionar eventos de edi√ß√£o
            adicionarEventosEdicao();
            
            // Renderiza√ß√£o conclu√≠da
            
            // Atualizar contador de clubes no header
            const totalClubesEl = document.getElementById('totalClubes');
            if (totalClubesEl) {
                totalClubesEl.textContent = classificacao.length;
                // Total de clubes atualizado no header
            }
        }
        
        function adicionarEventosEdicao() {
            // Adicionando eventos de edi√ß√£o...
            
            const editableCells = document.querySelectorAll('.editable');
            
            editableCells.forEach(cell => {
                // Evento ao focar (come√ßar edi√ß√£o)
                cell.addEventListener('focus', function() {
                    this.style.background = '#ffffcc';
                    this.style.boxShadow = '0 0 5px #ffd700';
                    this.style.border = '2px solid #ffd700';
                    // Editando {this.dataset.field} do time ID {this.dataset.id}
                });
                
                // Evento ao sair do foco (finalizar edi√ß√£o)
                cell.addEventListener('blur', function() {
                    const originalValue = this.dataset.original;
                    const newValue = this.textContent.trim();
                    
                    if (newValue !== originalValue) {
                        // Valor foi alterado
                        this.style.background = '#d4edda'; // Verde claro
                        this.style.border = '2px solid #28a745';
                        this.classList.add('modified');
                        // Modificado: {this.dataset.field} = {newValue} (era {originalValue})
                        
                        // Marcar para salvamento
                        marcarParaSalvamento(this);
                    } else {
                        // Valor n√£o mudou, voltar ao normal
                        restaurarEstiloOriginal(this);
                    }
                });
                
                // Evento ao pressionar Enter (salvar imediato)
                cell.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur(); // For√ßa o blur para processar a altera√ß√£o
                        setTimeout(() => {
                            salvarAlteracaoImediata(this);
                        }, 100);
                    }
                });
            });
            
            // Eventos adicionados a {editableCells.length} c√©lulas
        }
        
        function restaurarEstiloOriginal(cell) {
            const field = cell.dataset.field;
            
            // Cores espec√≠ficas por campo (MELHORADAS PARA LEGIBILIDADE)
            const estilos = {
                'time': {
                    background: '#e0f2fe',
                    border: '2px dashed #0ea5e9',
                    color: '#1a202c',
                    fontWeight: 'bold'
                },
                'pontos': {
                    background: '#fef9e7',
                    border: '2px dashed #f59e0b',
                    color: '#1e40af',
                    fontWeight: 'bold'
                },
                'jogos': {
                    background: '#f3f4f6',
                    border: '2px dashed #9ca3af',
                    color: '#374151',
                    fontWeight: '600'
                },
                'vitorias': {
                    background: '#ecfdf5',
                    border: '2px dashed #10b981',
                    color: '#065f46',
                    fontWeight: '600'
                },
                'empates': {
                    background: '#fffbeb',
                    border: '2px dashed #f59e0b',
                    color: '#92400e',
                    fontWeight: '600'
                },
                'derrotas': {
                    background: '#fef2f2',
                    border: '2px dashed #ef4444',
                    color: '#991b1b',
                    fontWeight: '600'
                },
                'gols_pro': {
                    background: '#ecfdf5',
                    border: '2px dashed #10b981',
                    color: '#065f46',
                    fontWeight: '600'
                },
                'gols_contra': {
                    background: '#fef2f2',
                    border: '2px dashed #ef4444',
                    color: '#991b1b',
                    fontWeight: '600'
                }
            };
            
            const estilo = estilos[field] || estilos['jogos'];
            
            cell.style.background = estilo.background;
            cell.style.border = estilo.border;
            cell.style.color = estilo.color;
            cell.style.fontWeight = estilo.fontWeight;
            cell.style.fontSize = '14px';
            cell.style.boxShadow = 'none';
            cell.classList.remove('modified');
        }
        
        function marcarParaSalvamento(cell) {
            // Adicionar √† lista de modifica√ß√µes pendentes
            if (!window.modificacoesPendentes) {
                window.modificacoesPendentes = new Set();
            }
            
            const key = `${cell.dataset.id}-${cell.dataset.field}`;
            window.modificacoesPendentes.add(key);
            
            // Atualizar contador de modifica√ß√µes
            atualizarContadorModificacoes();
        }
        
        function atualizarContadorModificacoes() {
            const count = window.modificacoesPendentes ? window.modificacoesPendentes.size : 0;
            const btnSalvar = document.querySelector('button[onclick="salvarClassificacao()"]');
            
            if (btnSalvar) {
                if (count > 0) {
                    btnSalvar.innerHTML = `<i class="fas fa-save"></i> üíæ Salvar Altera√ß√µes (${count})`;
                    btnSalvar.style.background = '#28a745';
                    btnSalvar.style.animation = 'pulse 1s infinite';
                } else {
                    btnSalvar.innerHTML = `<i class="fas fa-save"></i> Salvar Altera√ß√µes`;
                    btnSalvar.style.background = '';
                    btnSalvar.style.animation = 'none';
                }
            }
        }
        
        async function salvarAlteracaoImediata(cell) {
            // Salvamento imediato ativado!
            
            const campeonato = document.getElementById('campeonatoSelect').value || 'serie-a';
            const updates = [{
                id: parseInt(cell.dataset.id),
                field: cell.dataset.field,
                value: cell.textContent.trim()
            }];
            
            // Salvando na {campeonato}: {cell.dataset.field} = {cell.textContent.trim()}
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/classificacao/salvar`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        admin_key: localStorage.getItem('admin_key'),
                        campeonato: campeonato,
                        updates: updates
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    // Salvo com sucesso
                    cell.style.background = '#d1f2eb'; // Verde mais claro
                    cell.style.border = '2px solid #28a745';
                    cell.dataset.original = cell.textContent.trim(); // Atualizar valor original
                    
                    // Remover da lista de pendentes
                    const key = `${cell.dataset.id}-${cell.dataset.field}`;
                    if (window.modificacoesPendentes) {
                        window.modificacoesPendentes.delete(key);
                        atualizarContadorModificacoes();
                    }
                    
                    // Salvo com sucesso!
                    mostrarNotificacao('‚úÖ Altera√ß√£o salva!', 'success');
                } else {
                    console.error('‚ùå [ADMIN] Erro ao salvar:', data.message);
                    mostrarNotificacao('‚ùå Erro ao salvar: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('üí• [ADMIN] Erro na requisi√ß√£o:', error);
                mostrarNotificacao('üí• Erro de conex√£o!', 'error');
            }
        }
        
        async function salvarClassificacao() {
            const campeonato = document.getElementById('campeonatoSelect').value || 'serie-a';
            const editableCells = document.querySelectorAll('.editable[data-field]');
            const updates = [];
            
            editableCells.forEach(cell => {
                const value = cell.textContent.trim();
                const originalValue = cell.dataset.original;
                
                // Incluir tanto n√∫meros quanto texto (para nomes de times)
                if (value && value !== originalValue) {
                    updates.push({
                        id: parseInt(cell.dataset.id),
                        field: cell.dataset.field,
                        value: cell.dataset.field === 'time' || cell.dataset.field === 'clube' ? value : (isNaN(value) ? value : parseInt(value))
                    });
                }
            });
            
            // Salvando {updates.length} altera√ß√µes na {campeonato}
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/classificacao/salvar`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        admin_key: localStorage.getItem('admin_key'),
                        campeonato: campeonato,
                        updates: updates
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    mostrarSucesso('Classifica√ß√£o salva com sucesso!');
                    carregarClassificacao(); // Recarregar para atualizar saldo de gols e aproveitamento
                    atualizarDashboard(); // Atualizar estat√≠sticas do dashboard
                } else {
                    mostrarErro('Erro ao salvar: ' + data.message);
                }
            } catch (error) {
                console.error('Erro ao salvar classifica√ß√£o:', error);
                mostrarErro('Erro ao salvar classifica√ß√£o');
            }
        }
        
        // === FUN√á√ÉO DE TESTE DEBUG REMOVIDA ===
        
        // === FUN√á√ïES DAS BOLINHAS DOS √öLTIMOS JOGOS ===
        function getCorResultado(resultado) {
            switch (resultado) {
                case 'V': return '#16a34a'; // Verde
                case 'E': return '#6b7280'; // Cinza (era amarelo)
                case 'D': return '#dc2626'; // Vermelho
                case 'N': return '#6b7280'; // Cinza
                default: return '#6b7280';
            }
        }
        
        function getDescricaoResultado(resultado) {
            switch (resultado) {
                case 'V': return 'Vit√≥ria';
                case 'E': return 'Empate';
                case 'D': return 'Derrota';
                case 'N': return 'N√£o jogou';
                default: return 'Indefinido';
            }
        }
        
        function alterarResultado(bolinha) {
            const resultadoAtual = bolinha.dataset.resultado;
            const timeId = bolinha.dataset.timeId;
            const jogoIndex = parseInt(bolinha.dataset.jogoIndex);
            
            // Ciclo: N ‚Üí V ‚Üí E ‚Üí D ‚Üí N
            let novoResultado;
            switch (resultadoAtual) {
                case 'N': novoResultado = 'V'; break;
                case 'V': novoResultado = 'E'; break;
                case 'E': novoResultado = 'D'; break;
                case 'D': novoResultado = 'N'; break;
                default: novoResultado = 'V';
            }
            
            // Alterando jogo {jogoIndex + 1} do time ID {timeId}: {resultadoAtual} ‚Üí {novoResultado}
            
            // Atualizar visualmente
            bolinha.dataset.resultado = novoResultado;
            bolinha.style.background = getCorResultado(novoResultado);
            bolinha.textContent = novoResultado;
            bolinha.title = `Clique para alterar: ${getDescricaoResultado(novoResultado)}`;
            
            // Efeito visual de clique
            bolinha.style.transform = 'scale(1.2)';
            setTimeout(() => {
                bolinha.style.transform = 'scale(1)';
            }, 150);
            
            // Coletar todos os resultados do time
            const todasBolinhas = document.querySelectorAll(`[data-time-id="${timeId}"].resultado-bolinha`);
            let novosUltimosJogos = '';
            todasBolinhas.forEach(b => {
                novosUltimosJogos += b.dataset.resultado;
            });
            
            // Novos √∫ltimos jogos para time {timeId}: {novosUltimosJogos}
            
            // Salvar no banco
            salvarUltimosJogos(timeId, novosUltimosJogos);
        }
        
        async function salvarUltimosJogos(timeId, ultimosJogos) {
            const campeonato = document.getElementById('campeonatoSelect').value || 'serie-a';
            
            // Determinar campo correto baseado no campeonato
            const fieldName = (campeonato === 'premier-league' || campeonato === 'la-liga' || campeonato === 'ligue1') ? 'ultimas_5' : 'ultimos_jogos';
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/classificacao/salvar`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        admin_key: localStorage.getItem('admin_key'),
                        campeonato: campeonato,
                        updates: [{
                            id: parseInt(timeId),
                            field: fieldName,
                            value: ultimosJogos
                        }]
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    // √öltimos jogos salvos com sucesso!
                    mostrarNotificacao('üéÆ Resultado atualizado!', 'success');
                } else {
                    console.error('‚ùå [ADMIN] Erro ao salvar:', data.message);
                    mostrarNotificacao('‚ùå Erro ao salvar resultado!', 'error');
                }
            } catch (error) {
                console.error('üí• [ADMIN] Erro na requisi√ß√£o:', error);
                mostrarNotificacao('üí• Erro de conex√£o!', 'error');
            }
        }

        // === BACKUP E RESTORE ===
        async function fazerBackup() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/backup`);
                const result = await response.json();
                
                if (result.success) {
                    const dataStr = JSON.stringify(result.data, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = result.filename || `loteca-backup-${new Date().toISOString().slice(0,10)}.json`;
                    link.click();
                    
                    mostrarSucesso('Backup gerado com sucesso!');
                } else {
                    mostrarErro('Erro ao gerar backup: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao gerar backup:', error);
                mostrarErro('Erro de conex√£o ao gerar backup');
            }
        }

        async function restaurarBackup() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                mostrarErro('Selecione um arquivo de backup');
                return;
            }
            
            try {
                const text = await file.text();
                const backupData = JSON.parse(text);
                
                if (confirm('Tem certeza que deseja restaurar este backup? Todos os dados atuais ser√£o substitu√≠dos.')) {
                    const response = await fetch(`${API_BASE}/api/admin/restore`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            backup_data: backupData,
                            admin_key: ADMIN_KEY
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        mostrarSucesso('Backup restaurado com sucesso! ' + result.message);
                        carregarClubes();
                        carregarEstatisticas();
                        carregarDashboard();
                    } else {
                        mostrarErro('Erro ao restaurar backup: ' + result.message);
                    }
                }
            } catch (error) {
                console.error('Erro ao restaurar backup:', error);
                mostrarErro('Arquivo de backup inv√°lido ou erro de conex√£o');
            }
        }

        // === TECLAS DE ATALHO ===
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginContainer').style.display !== 'none') {
                login();
            }
        });

        // === FUN√á√ïES DE ESTAT√çSTICAS DOS CLUBES ===
        
        // Carregar estat√≠sticas de um clube
        async function carregarEstatisticasClube() {
            console.log('üîç [DEBUG] carregarEstatisticasClube chamada');
            
            // Usar seletor espec√≠fico para evitar ambiguidade
            let clubeSelecionado = document.getElementById('clubeEstatisticas')?.value;
            
            console.log('üîç [DEBUG] Clube selecionado:', clubeSelecionado);
            
            // Salvar clube atual globalmente para eliminar ambiguidade
            window.CLUBE_ATUAL = clubeSelecionado?.toLowerCase();
            
            if (!clubeSelecionado) {
                console.error('‚ùå [DEBUG] Nenhum clube selecionado encontrado');
                return;
            }
            const formulario = document.getElementById('formularioEstatisticas');
            const mensagem = document.getElementById('mensagemSelecionar');
            const btnTabelaJogos = document.getElementById('btnTabelaJogos');
            
            if (clubeSelecionado) {
                formulario.style.display = 'block';
                mensagem.style.display = 'none';
                
                // Mostrar bot√£o "Tabela de Jogos" para clubes com dados de jogos
                const clubesComJogos = ['flamengo', 'corinthians', 'palmeiras', 'cruzeiro', 'mirassol', 'bahia',
                    'botafogo', 'fluminense', 'sao-paulo', 'gremio', 'red-bull-bragantino',
                    'atletico-mg', 'ceara', 'vasco', 'internacional', 'santos', 'juventude', 
                    'vitoria', 'fortaleza', 'sport-recife'];
                
                if (clubesComJogos.includes(clubeSelecionado.toLowerCase())) {
                    btnTabelaJogos.style.display = 'inline-flex';
                } else {
                    btnTabelaJogos.style.display = 'none';
                }
                
                console.log(`üîÑ Carregando estat√≠sticas REAIS de: ${clubeSelecionado}`);
                
                // Carregar dados reais da classifica√ß√£o
                await carregarDadosReaisClube(clubeSelecionado);
                
                // Carregar dados edit√°veis salvos (se dispon√≠vel)
                await carregarDadosEditaveisSalvos(clubeSelecionado);
                
                // üìä PREENCHER DADOS AUTOM√ÅTICOS DA PLANILHA
                await preencherDadosAutomaticosPlanilha(clubeSelecionado);
                
                // Carregar dados dos jogos POR √öLTIMO (para n√£o serem sobrescritos)
                carregarDadosJogosClube(clubeSelecionado);
                
                console.log(`‚úÖ [FINAL] Carregamento completo para ${clubeSelecionado} - dados dos jogos carregados por √∫ltimo`);
                
                
                // Verificar se h√° dados da planilha para sincronizar
                verificarDadosPlanilha();
            } else {
                formulario.style.display = 'none';
                mensagem.style.display = 'block';
                btnTabelaJogos.style.display = 'none';
            }
        }

        // Carregar dados reais do clube da tabela de classifica√ß√£o
        async function carregarDadosReaisClube(nomeClube) {
            try {
                // Buscar dados da classifica√ß√£o
                const response = await fetch(`${API_BASE}/api/admin/classificacao`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        campeonato: 'serie-a',
                        admin_key: ADMIN_KEY
                    })
                });
                const result = await response.json();
                
                if (result.success && result.classificacao) {
                    // Encontrar o clube na classifica√ß√£o
                    const clube = result.classificacao.find(time => 
                        time.time.toLowerCase().includes(nomeClube.toLowerCase()) ||
                        nomeClube.toLowerCase().includes(time.time.toLowerCase())
                    );
                    
                    if (clube) {
                        console.log(`‚úÖ Dados encontrados para ${clube.time}:`, clube);
                        preencherDadosReais(clube);
                    } else {
                        console.warn(`‚ùå Clube ${nomeClube} n√£o encontrado na classifica√ß√£o`);
                        // Fallback para dados de exemplo espec√≠ficos por clube
                        if (nomeClube.toLowerCase().includes('corinthians')) {
                            preencherDadosCorinthians();
                        } else {
                            preencherDadosFlamengo();
                        }
                    }
                } else {
                    console.error('‚ùå Erro ao carregar classifica√ß√£o:', result.message);
                    // Fallback para dados de exemplo espec√≠ficos por clube
                    if (nomeClube.toLowerCase().includes('corinthians')) {
                        preencherDadosCorinthians();
                    } else {
                        preencherDadosFlamengo();
                    }
                }
            } catch (error) {
                console.error('‚ùå Erro na requisi√ß√£o:', error);
                // Fallback para dados de exemplo espec√≠ficos por clube
                if (nomeClube.toLowerCase().includes('corinthians')) {
                    preencherDadosCorinthians();
                } else {
                    preencherDadosFlamengo();
                }
            }
        }

        // Carregar dados dos jogos do clube (se dispon√≠vel)
        // Carregar dados edit√°veis salvos do clube
        async function carregarDadosEditaveisSalvos(nomeClube) {
            try {
                const response = await fetch(`/api/admin/estatisticas-editaveis/${nomeClube}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_key')}`
                    }
                });
                
                const result = await response.json();
                if (result.success && result.data) {
                    const dados = result.data;
                    
                    // Preencher campos edit√°veis com dados salvos
                    if (dados.elencoTotal) {
                        document.getElementById('elencoTotal').value = dados.elencoTotal;
                        mostrarCadeadoSePreenchido('elencoTotal');
                    }
                    if (dados.pctProvaveis) {
                        document.getElementById('pctProvaveis').value = dados.pctProvaveis;
                        mostrarCadeadoSePreenchido('pctProvaveis');
                    }
                    if (dados.valorElenco) {
                        document.getElementById('valorElenco').value = dados.valorElenco;
                        mostrarCadeadoSePreenchido('valorElenco');
                    }
                    if (dados.ratingMedio) {
                        document.getElementById('ratingMedio').value = dados.ratingMedio;
                        mostrarCadeadoSePreenchido('ratingMedio');
                    }
                    if (dados.chutesPorJogo) {
                        document.getElementById('chutesPorJogo').value = dados.chutesPorJogo;
                    }
                    if (dados.posseBola) {
                        document.getElementById('posseBola').value = dados.posseBola;
                    }
                    if (dados.tendencia) {
                        document.getElementById('tendencia').value = dados.tendencia;
                    }
                    if (dados.desfalques) {
                        document.getElementById('desfalques').value = dados.desfalques;
                    }
                    if (dados.motivacao) {
                        document.getElementById('motivacao').value = dados.motivacao;
                    }
                    if (dados.proximosJogos) {
                        document.getElementById('proximosJogos').value = dados.proximosJogos;
                    }
                    
                    console.log(`‚úÖ Dados edit√°veis de ${nomeClube} carregados com sucesso!`);
                } else {
                    console.log(`‚ÑπÔ∏è Sem dados edit√°veis salvos para ${nomeClube}`);
                }
                
            } catch (error) {
                console.log(`‚ÑπÔ∏è Erro ao carregar dados edit√°veis: ${error.message}`);
            }
        }

        async function carregarDadosJogosClube(nomeClube) {
            try {
                // Mapear nome do clube para o formato usado nos arquivos
                let clubeArquivo = nomeClube.toLowerCase();
                
                // Lista de clubes com dados de jogos dispon√≠veis
                const clubesDisponiveis = ['flamengo', 'corinthians', 'palmeiras', 'cruzeiro', 'mirassol', 'bahia',
                    'botafogo', 'fluminense', 'sao-paulo', 'gremio', 'red-bull-bragantino',
                    'atletico-mg', 'ceara', 'vasco', 'internacional', 'santos', 'juventude', 
                    'vitoria', 'fortaleza', 'sport-recife'];
                
                if (!clubesDisponiveis.includes(clubeArquivo)) {
                    console.log(`‚ÑπÔ∏è [JOGOS] Clube ${clubeArquivo} n√£o tem dados de jogos dispon√≠veis`);
                    return;
                }
                
                console.log(`üìä [JOGOS] Carregando estat√≠sticas de jogos para: ${clubeArquivo}`);
                
                // Tentar primeiro a nova API de estat√≠sticas
                try {
                    const response = await fetch(`/api/br/estatisticas/${clubeArquivo}`);
                    const data = await response.json();
                    
                    if (data.success && data.total_jogos > 0) {
                        console.log(`‚úÖ [JOGOS] Estat√≠sticas carregadas via API:`, data);
                        preencherDadosJogosNovo(data);
                        return;
                    } else {
                        console.log(`‚ö†Ô∏è [JOGOS] API retornou erro ou sem dados:`, data);
                    }
                } catch (apiError) {
                    console.log(`‚ö†Ô∏è [JOGOS] Erro na API principal:`, apiError.message);
                }
                
                // Fallback: usar API de jogos do admin
                console.log(`üîÑ [JOGOS] Tentando API alternativa: /api/admin/jogos/${clubeArquivo}`);
                try {
                    const adminResponse = await fetch(`/api/admin/jogos/${clubeArquivo}`);
                    const adminData = await adminResponse.json();
                    
                    if (adminData.success && adminData.data.estatisticas) {
                        console.log(`‚úÖ [JOGOS] Dados carregados via API admin:`, adminData.data.estatisticas);
                        preencherDadosJogosNovo(adminData.data.estatisticas);
                    } else {
                        console.log(`‚ÑπÔ∏è [JOGOS] API admin tamb√©m falhou:`, adminData);
                    }
                } catch (adminError) {
                    console.log(`‚ùå [JOGOS] Erro na API admin:`, adminError.message);
                }
                
            } catch (error) {
                console.log(`‚ùå [JOGOS] Erro geral ao carregar dados de jogos: ${error.message}`);
            }
        }

        // Preencher campos com dados calculados dos jogos (NOVA API)
        function preencherDadosJogosNovo(data) {
            console.log('üîÑ [JOGOS] Preenchendo campos com dados da nova API:', data);
            console.log('üîç [DEBUG] Estrutura completa dos dados:', JSON.stringify(data, null, 2));
            
            // CAMPOS BLOQUEADOS VERDES - Dados calculados dos jogos
            if (data.total_jogos > 0) {
                // PPG e Aproveitamento
                console.log('üîç [DEBUG] Dados Casa/Fora:', {
                    ppg_casa: data.ppg_casa,
                    ppg_fora: data.ppg_fora,
                    aproveitamento_casa: data.aproveitamento_casa,
                    aproveitamento_fora: data.aproveitamento_fora
                });
                
                // PPG com valida√ß√£o
                const ppgCasa = (data.ppg_casa !== undefined && data.ppg_casa !== null) ? data.ppg_casa.toFixed(2) : '0.00';
                const ppgFora = (data.ppg_fora !== undefined && data.ppg_fora !== null) ? data.ppg_fora.toFixed(2) : '0.00';
                preencherCampo('ppgCasa', ppgCasa);
                preencherCampo('ppgFora', ppgFora);
                
                // Aproveitamento com valida√ß√£o
                const aprovCasa = (data.aproveitamento_casa !== undefined && data.aproveitamento_casa !== null) ? data.aproveitamento_casa.toFixed(1) + '%' : '0.0%';
                const aprovFora = (data.aproveitamento_fora !== undefined && data.aproveitamento_fora !== null) ? data.aproveitamento_fora.toFixed(1) + '%' : '0.0%';
                preencherCampo('aproveitamentoCasa', aprovCasa);
                preencherCampo('aproveitamentoFora', aprovFora);
                
                // Resultados
                preencherCampo('vitorias', data.vitorias);
                preencherCampo('empates', data.empates);
                preencherCampo('derrotas', data.derrotas);
                
                // Gols
                preencherCampo('golsMarcados', data.gols_marcados || 0);
                preencherCampo('golsSofridos', data.gols_sofridos || 0);
                preencherCampo('saldoGols', data.saldo_gols || 0);
                
                // Jogos sem sofrer gols
                console.log('üîç [DEBUG] Clean Sheets dados:', {
                    clean_sheets: data.clean_sheets,
                    pct_clean_sheets: data.pct_clean_sheets,
                    total_jogos: data.total_jogos
                });
                
                preencherCampo('cleanSheets', data.clean_sheets || 0);
                
                // Calcular percentual manualmente se necess√°rio
                let percentual = data.pct_clean_sheets || 0;
                if (percentual === 0 && data.clean_sheets > 0 && data.total_jogos > 0) {
                    percentual = (data.clean_sheets / data.total_jogos) * 100;
                    console.log('üîß [DEBUG] Calculando percentual manualmente:', {
                        clean_sheets: data.clean_sheets,
                        total_jogos: data.total_jogos,
                        percentual_calculado: percentual
                    });
                }
                
                preencherCampo('percentualCleanSheets', percentual.toFixed(1) + '%');
                
                // Sequ√™ncia Atual e Forma Recente
                console.log('üîç [DEBUG] Forma Recente:', {
                    sequencia_atual: data.sequencia_atual,
                    pontos_ultimos_5: data.pontos_ultimos_5,
                    ultimos_5_resultados: data.ultimos_5_resultados,
                    tem_ultimos_5: !!data.ultimos_5_resultados,
                    tipo_ultimos_5: typeof data.ultimos_5_resultados
                });
                
                // Calcular Pontos dos √öltimos 5 Jogos
                let pontosUltimos5 = (data.pontos_ultimos_5 !== undefined && data.pontos_ultimos_5 !== null) ? data.pontos_ultimos_5 : 0;
                
                // Se n√£o tem pontos calculados, calcular baseado nos dados dispon√≠veis
                if (pontosUltimos5 === 0) {
                    if (data.ultimos_5_resultados) {
                        // M√©todo 1: Usar ultimos_5_resultados se dispon√≠vel
                        const resultados = data.ultimos_5_resultados.toString();
                        pontosUltimos5 = 0;
                        
                        for (let i = 0; i < resultados.length; i++) {
                            const resultado = resultados[i].toUpperCase();
                            if (resultado === 'V') {
                                pontosUltimos5 += 3; // Vit√≥ria = 3 pontos
                            } else if (resultado === 'E') {
                                pontosUltimos5 += 1; // Empate = 1 ponto
                            }
                        }
                        
                        console.log('üéØ [DEBUG] Pontos calculados via ultimos_5_resultados:', {
                            ultimos_5_resultados: data.ultimos_5_resultados,
                            pontos_calculados: pontosUltimos5
                        });
                    } else {
                        // M√©todo 2: Estimativa baseada no desempenho geral (Flamengo tem bom desempenho)
                        const totalJogos = data.total_jogos || 23;
                        const vitorias = data.vitorias || 15;
                        const empates = data.empates || 6;
                        
                        // Calcular percentual de vit√≥rias e empates
                        const pctVitorias = vitorias / totalJogos;
                        const pctEmpates = empates / totalJogos;
                        
                        // Estimar √∫ltimos 5 jogos baseado no desempenho
                        const vitoriasEst = Math.round(pctVitorias * 5);
                        const empatesEst = Math.round(pctEmpates * 5);
                        const derrotasEst = 5 - vitoriasEst - empatesEst;
                        
                        pontosUltimos5 = (vitoriasEst * 3) + (empatesEst * 1);
                        
                        console.log('üéØ [DEBUG] Pontos estimados baseado no desempenho:', {
                            total_jogos: totalJogos,
                            vitorias: vitorias,
                            empates: empates,
                            pct_vitorias: (pctVitorias * 100).toFixed(1) + '%',
                            estimativa_ultimos_5: `${vitoriasEst}V + ${empatesEst}E + ${derrotasEst}D`,
                            pontos_calculados: pontosUltimos5
                        });
                    }
                }
                
                // Efici√™ncia Ofensiva = (M√©dia Gols √∑ Chutes por Jogo) √ó 100
                let eficienciaOfensiva = '0.0%';
                
                console.log('üéØ [DEBUG] === IN√çCIO C√ÅLCULO EFICI√äNCIA OFENSIVA ===');
                console.log('üéØ [DEBUG] Dados recebidos:', data);
                console.log('üéØ [DEBUG] Verificando condi√ß√µes para Efici√™ncia Ofensiva:', {
                    'data.media_gols_marcados': data.media_gols_marcados,
                    'typeof media_gols': typeof data.media_gols_marcados,
                    'data.total_jogos': data.total_jogos,
                    'typeof total_jogos': typeof data.total_jogos,
                    'condicao_media_gols': !!data.media_gols_marcados,
                    'condicao_total_jogos': data.total_jogos > 0,
                    'condicao_final': !!(data.media_gols_marcados && data.total_jogos > 0)
                });
                
                // Calcular m√©dia de gols se n√£o vier calculada
                const mediaGolsMarcados = data.media_gols_marcados || (data.gols_marcados / data.total_jogos);
                
                console.log('üéØ [DEBUG] M√©dia de gols calculada:', {
                    media_gols_marcados_original: data.media_gols_marcados,
                    gols_marcados: data.gols_marcados,
                    total_jogos: data.total_jogos,
                    media_calculada: mediaGolsMarcados
                });
                
                // Condi√ß√£o mais robusta - verificar se existe e √© maior que 0
                if (mediaGolsMarcados > 0 && data.total_jogos > 0) {
                    // Tentar buscar chutes por jogo do campo, sen√£o usar dados conhecidos por clube
                    let chutesPorJogo = parseFloat(document.getElementById('chutesPorJogo')?.value);
                    
                    // Se n√£o veio do input, usa base conhecida por clube (valida√ß√£o robusta)
                    if (!Number.isFinite(chutesPorJogo) || chutesPorJogo <= 0) {
                        const dadosChutes = {
                            'flamengo': 5.7,
                            'corinthians': 3.6,
                            'palmeiras': 4.2,
                            'gremio': 3.8,
                            'santos': 4.1
                        };
                        
                        const clubeAtual = window.CLUBE_ATUAL || document.getElementById('clubeEstatisticas')?.value?.toLowerCase();
                        chutesPorJogo = dadosChutes[clubeAtual] ?? 12; // Fallback seguro
                        
                        // Opcional: j√° mostrar o que foi usado
                        preencherCampo('chutesPorJogo', chutesPorJogo);
                        
                        console.log('üéØ [DEBUG] Chutes por jogo definido:', {
                            clubeAtual: clubeAtual,
                            chutesPorJogo: chutesPorJogo,
                            fonte: dadosChutes[clubeAtual] ? 'dados_conhecidos' : 'fallback_padrao'
                        });
                    }
                    
                    const mediaGols = mediaGolsMarcados;
                    const eficiencia = (mediaGols / chutesPorJogo) * 100;
                    eficienciaOfensiva = eficiencia.toFixed(1) + '%';
                    
                    console.log('üéØ [DEBUG] Efici√™ncia Ofensiva - C√°lculo Final:', {
                        mediaGols: mediaGols,
                        chutesPorJogo: chutesPorJogo,
                        eficiencia: eficiencia,
                        resultado: eficienciaOfensiva,
                        clubeAtual: window.CLUBE_ATUAL,
                        formula: `${mediaGols} √∑ ${chutesPorJogo} √ó 100 = ${eficiencia.toFixed(1)}%`
                    });
                }
                
                // Solidez Defensiva baseada em gols sofridos e clean sheets
                let solidezDefensiva = 'Regular';
                if (data.media_gols_sofridos !== undefined && data.pct_clean_sheets !== undefined) {
                    const mediaGolsSofridos = data.media_gols_sofridos;
                    const pctCleanSheets = data.pct_clean_sheets;
                    
                    if (mediaGolsSofridos < 0.8 && pctCleanSheets > 40) {
                        solidezDefensiva = 'Excelente';
                    } else if (mediaGolsSofridos < 1.2 && pctCleanSheets > 25) {
                        solidezDefensiva = 'Boa';
                    } else if (mediaGolsSofridos < 1.8 && pctCleanSheets > 15) {
                        solidezDefensiva = 'Regular';
                    } else {
                        solidezDefensiva = 'Fraca';
                    }
                }
                
                console.log('üéØ [DEBUG] === PREENCHENDO CAMPOS ===');
                console.log('üéØ [DEBUG] Valores a preencher:', {
                    eficienciaOfensiva: eficienciaOfensiva,
                    solidezDefensiva: solidezDefensiva,
                    pontosUltimos5: pontosUltimos5,
                    pontosUltimos5_tipo: typeof pontosUltimos5
                });
                
                preencherCampo('eficienciaOfensiva', eficienciaOfensiva);
                preencherCampo('solidezDefensiva', solidezDefensiva);
                preencherCampo('pontosUltimos5', pontosUltimos5);
                
                // Verificar se realmente foi preenchido
                setTimeout(() => {
                    const campoEficiencia = document.getElementById('eficienciaOfensiva');
                    console.log('üéØ [DEBUG] Campo ap√≥s preenchimento:', {
                        elemento: !!campoEficiencia,
                        valor: campoEficiencia?.value,
                        eficienciaCalculada: eficienciaOfensiva
                    });
                }, 100);
                
                // Marcar campos como dados de jogos (verde)
                marcarCampoComoJogos('ppgCasa', ppgCasa);
                marcarCampoComoJogos('ppgFora', ppgFora);
                marcarCampoComoJogos('aproveitamentoCasa', aprovCasa);
                marcarCampoComoJogos('aproveitamentoFora', aprovFora);
                marcarCampoComoJogos('vitorias', data.vitorias);
                marcarCampoComoJogos('empates', data.empates);
                marcarCampoComoJogos('derrotas', data.derrotas);
                marcarCampoComoJogos('golsMarcados', data.gols_marcados || 0);
                marcarCampoComoJogos('golsSofridos', data.gols_sofridos || 0);
                marcarCampoComoJogos('saldoGols', data.saldo_gols || 0);
                marcarCampoComoJogos('cleanSheets', data.clean_sheets || 0);
                marcarCampoComoJogos('percentualCleanSheets', percentual.toFixed(1) + '%');
                marcarCampoComoJogos('eficienciaOfensiva', eficienciaOfensiva);
                marcarCampoComoJogos('solidezDefensiva', solidezDefensiva);
                marcarCampoComoJogos('pontosUltimos5', pontosUltimos5);
                
                // Log final para verificar se os campos foram preenchidos
                console.log('üîç [DEBUG] Valores finais preenchidos:', {
                    eficienciaOfensiva: eficienciaOfensiva,
                    solidezDefensiva: solidezDefensiva,
                    pontosUltimos5: pontosUltimos5,
                    campo_eficiencia_valor: document.getElementById('eficienciaOfensiva')?.value,
                    campo_solidez_valor: document.getElementById('solidezDefensiva')?.value
                });
                
                console.log(`‚úÖ [JOGOS] Dados preenchidos para clube com ${data.total_jogos} jogos`);
            }
        }


        // Preencher campos com dados calculados dos jogos (API ANTIGA - MANTER COMPATIBILIDADE)
        function preencherDadosJogos(estatisticas) {
            // CAMPOS BLOQUEADOS VERDES - Dados calculados dos jogos
            if (estatisticas.ppg) {
                document.getElementById('ppg').value = estatisticas.ppg;
                marcarCampoComoJogos('ppg');
            }
            
            if (estatisticas.ppg_casa) {
                document.getElementById('ppgCasa').value = estatisticas.ppg_casa;
                marcarCampoComoJogos('ppgCasa');
            }
            
            if (estatisticas.ppg_fora) {
                document.getElementById('ppgFora').value = estatisticas.ppg_fora;
                marcarCampoComoJogos('ppgFora');
            }
            
            if (estatisticas.aproveitamento_casa !== undefined && estatisticas.aproveitamento_casa !== null) {
                document.getElementById('aproveitamentoCasa').value = estatisticas.aproveitamento_casa.toFixed(1) + '%';
                marcarCampoComoJogos('aproveitamentoCasa');
            }
            
            if (estatisticas.aproveitamento_fora !== undefined && estatisticas.aproveitamento_fora !== null) {
                document.getElementById('aproveitamentoFora').value = estatisticas.aproveitamento_fora.toFixed(1) + '%';
                marcarCampoComoJogos('aproveitamentoFora');
            }
            
            if (estatisticas.pct_vitorias) {
                document.getElementById('percentualVitorias').value = estatisticas.pct_vitorias;
                marcarCampoComoJogos('percentualVitorias');
            }
            
            if (estatisticas.media_gols_marcados) {
                document.getElementById('mediaGols').value = estatisticas.media_gols_marcados;
                marcarCampoComoJogos('mediaGols');
            }
            
            if (estatisticas.media_gols_sofridos) {
                document.getElementById('mediaSofridos').value = estatisticas.media_gols_sofridos;
                marcarCampoComoJogos('mediaSofridos');
            }
            
            if (estatisticas.clean_sheets !== undefined) {
                document.getElementById('cleanSheets').value = estatisticas.clean_sheets;
                marcarCampoComoJogos('cleanSheets');
            }
            
            if (estatisticas.pct_clean_sheets !== undefined) {
                document.getElementById('percentualCleanSheets').value = estatisticas.pct_clean_sheets.toFixed(1) + '%';
                marcarCampoComoJogos('percentualCleanSheets');
            }
            
            if (estatisticas.pontos_ultimos_5 !== undefined && estatisticas.pontos_ultimos_5 !== null) {
                document.getElementById('pontosUltimos5').value = estatisticas.pontos_ultimos_5;
                marcarCampoComoJogos('pontosUltimos5');
            }
            
            if (estatisticas.sequencia_atual !== undefined && estatisticas.sequencia_atual !== null && estatisticas.sequencia_atual !== '') {
                document.getElementById('sequenciaAtual').value = estatisticas.sequencia_atual;
                marcarCampoComoJogos('sequenciaAtual');
            }
            
            // ‚úÖ ADICIONAR - Forma recente (√∫ltimos 5 resultados)
            if (estatisticas.ultimos_5_resultados) {
                document.getElementById('formaUltimos5').value = estatisticas.ultimos_5_resultados;
                marcarCampoComoJogos('formaUltimos5');
            }
        }

        // Marcar campo como derivado da tabela de jogos (cadeado verde)
        function marcarCampoComoJogos(fieldId, valor = null) {
            const field = document.getElementById(fieldId);
            if (field) {
                // Preencher valor se fornecido
                if (valor !== null) {
                    field.value = valor;
                }
                
                field.classList.remove('campo-editavel', 'campo-calculado', 'campo-pendente');
                field.classList.add('campo-bloqueado');
                field.readOnly = true;
                
                // Adicionar prote√ß√£o extra contra edi√ß√£o
                field.addEventListener('keydown', bloquearEdicao);
                field.addEventListener('paste', bloquearEdicao);
                field.addEventListener('input', bloquearEdicao);
                
                // Mostrar cadeado de prote√ß√£o autom√°tico
                mostrarCadeadoSePreenchido(fieldId);
                
                console.log(`üîí [PLANILHA] Campo ${fieldId} preenchido automaticamente: ${valor}`);
            }
        }

        // Marcar campo como pendente de atualiza√ß√£o
        function marcarCampoPendente(fieldId, valor) {
            const field = document.getElementById(fieldId);
            if (field) {
                // Preencher com valor padr√£o/exemplo
                field.value = valor;
                
                // Aplicar estilo visual de campo pendente
                field.classList.remove('campo-editavel', 'campo-bloqueado', 'campo-calculado');
                field.classList.add('campo-pendente');
                field.readOnly = false;
                
                // Atualizar √≠cone para indicar que precisa ser preenchido
                const label = field.closest('.campo-grupo')?.querySelector('label');
                if (label) {
                    const icon = label.querySelector('i');
                    if (icon) {
                        icon.className = 'fas fa-exclamation-triangle';
                        icon.style.color = '#fbbf24'; // Amarelo de alerta
                        icon.title = 'Campo precisa ser atualizado com dados reais';
                    }
                }
                
                console.log(`‚ö†Ô∏è [PENDENTE] Campo ${fieldId} marcado para atualiza√ß√£o`);
            }
        }

        // Carregar valor do elenco de dados reais
        async function carregarValorElenco(nomeClube) {
            console.log(`üîç [DEBUG] Iniciando carregarValorElenco para: ${nomeClube}`);
            
            try {
                const response = await fetch('./static/valor_elenco/mapeamento_clubes.json');
                console.log(`üîç [DEBUG] Response status: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log(`üîç [DEBUG] Dados carregados:`, data);
                
                // Normalizar nome do clube para busca
                const clubeNormalizado = nomeClube.toLowerCase().replace(/\s+/g, '_');
                console.log(`üîç [DEBUG] Clube normalizado: ${clubeNormalizado}`);
                
                // Buscar no mapeamento
                let clubeEncontrado = null;
                for (const [key, clube] of Object.entries(data.mapeamento)) {
                    console.log(`üîç [DEBUG] Testando key: ${key} vs ${clubeNormalizado}`);
                    if (key === clubeNormalizado || 
                        clube.nomes_alternativos.some(alt => 
                            alt.toLowerCase().includes(nomeClube.toLowerCase()) ||
                            nomeClube.toLowerCase().includes(alt.toLowerCase())
                        )) {
                        clubeEncontrado = clube;
                        console.log(`‚úÖ [DEBUG] Clube encontrado:`, clubeEncontrado);
                        break;
                    }
                }
                
                if (clubeEncontrado) {
                    // Preencher campo com valor real
                    const field = document.getElementById('valorElenco');
                    console.log(`üîç [DEBUG] Campo valorElenco encontrado:`, field);
                    
                    if (field) {
                        field.value = clubeEncontrado.valor_elenco_euros;
                        field.classList.remove('campo-pendente', 'campo-editavel');
                        field.classList.add('campo-calculado');
                        field.readOnly = true;
                        
                        // Atualizar √≠cone para calculadora
                        const label = field.closest('tr')?.querySelector('td strong');
                        if (label) {
                            const icon = label.querySelector('i');
                            if (icon) {
                                icon.className = 'fas fa-calculator';
                                icon.style.color = '#60a5fa'; // Azul
                                icon.title = `Valor real do elenco: ‚Ç¨${clubeEncontrado.valor_elenco_euros}M (Posi√ß√£o mundial: ${clubeEncontrado.posicao_mundial}¬∫)`;
                            }
                        }
                        
                        console.log(`üí∞ [VALOR ELENCO] ${clubeEncontrado.nome_oficial}: ‚Ç¨${clubeEncontrado.valor_elenco_euros} milh√µes (${clubeEncontrado.posicao_mundial}¬∫ mundial)`);
                        
                        // Verifica√ß√£o final
                        setTimeout(() => {
                            const finalCheck = document.getElementById('valorElenco');
                            console.log(`üîç [DEBUG] Verifica√ß√£o final - Campo valorElenco:`, {
                                element: finalCheck,
                                value: finalCheck?.value,
                                classList: finalCheck?.classList.toString(),
                                style: finalCheck?.style.cssText,
                                visible: finalCheck?.offsetHeight > 0
                            });
                        }, 100);
                        
                    } else {
                        console.error(`‚ùå [DEBUG] Campo valorElenco n√£o encontrado!`);
                    }
                } else {
                    console.log(`‚ÑπÔ∏è [VALOR ELENCO] Clube ${nomeClube} n√£o encontrado na base de dados mundial`);
                }
                
            } catch (error) {
                console.error(`‚ùå [VALOR ELENCO] Erro ao carregar dados: ${error.message}`);
            }
        }

        // Fun√ß√£o para bloquear tentativas de edi√ß√£o
        function bloquearEdicao(event) {
            event.preventDefault();
            event.stopPropagation();
            
            // Mostrar alerta visual
            const field = event.target;
            const originalBorder = field.style.border;
            field.style.border = '2px solid #dc3545';
            field.style.boxShadow = '0 0 8px rgba(220, 53, 69, 0.6)';
            
            // Restaurar estilo ap√≥s 1 segundo
            setTimeout(() => {
                field.style.border = originalBorder;
                field.style.boxShadow = '';
            }, 1000);
            
            console.log('üö´ Tentativa de edi√ß√£o bloqueada em campo protegido');
            return false;
        }

        // Preencher com dados reais da classifica√ß√£o
        function preencherDadosReais(dadosClube) {
            // CAMPOS BLOQUEADOS - Dados da classifica√ß√£o (SOMENTE LEITURA)
            const camposClassificacao = [
                'posicaoAtual', 'pontosTotal', 'jogosDisputados', 'vitorias', 
                'empates', 'derrotas', 'golsMarcados', 'golsSofridos', 'formaUltimos5'
            ];
            
            // Preencher e bloquear campos da classifica√ß√£o
            document.getElementById('posicaoAtual').value = dadosClube.posicao || '';
            document.getElementById('pontosTotal').value = dadosClube.pontos || '';
            document.getElementById('jogosDisputados').value = dadosClube.jogos || '';
            document.getElementById('vitorias').value = dadosClube.vitorias || '';
            document.getElementById('empates').value = dadosClube.empates || '';
            document.getElementById('derrotas').value = dadosClube.derrotas || '';
            document.getElementById('golsMarcados').value = dadosClube.gols_pro || '';
            document.getElementById('golsSofridos').value = dadosClube.gols_contra || '';
            document.getElementById('formaUltimos5').value = dadosClube.ultimos_jogos || '';
            
            // GARANTIR que todos os campos da classifica√ß√£o sejam SOMENTE LEITURA
            camposClassificacao.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.readOnly = true;
                    field.classList.add('campo-bloqueado');
                    field.classList.remove('campo-editavel');
                    console.log(`üîí [CLASSIFICA√á√ÉO] Campo ${fieldId} bloqueado para edi√ß√£o`);
                }
            });
            
            // CAMPOS EDIT√ÅVEIS - Dados complementares (valores padr√£o)
            // Marcar campos que precisam ser atualizados com dados reais
            marcarCampoPendente('chutesPorJogo', 14.2);
            marcarCampoPendente('posseBola', 58.3);
            // ‚úÖ REMOVIDO - Esses campos ser√£o preenchidos AUTOMATICAMENTE pelos dados dos jogos
            // Jogos sem sofrer gols, PPG Casa/Fora, Aproveitamento, Pontos √öltimos 5, Sequ√™ncia
            // ser√£o calculados pela fun√ß√£o carregarDadosJogosClube() se houver dados dispon√≠veis
            // Marcar campos cr√≠ticos que precisam ser atualizados
            marcarCampoPendente('tendencia', 'Est√°vel');
            marcarCampoPendente('elencoTotal', 40);
            marcarCampoPendente('pctProvaveis', 42.5);
            marcarCampoPendente('valorElenco', 85.0);
            marcarCampoComoJogos('ratingMedio', 4.6);
            marcarCampoPendente('desfalques', 'Nenhum desfalque importante');
            marcarCampoPendente('motivacao', `${dadosClube.zona || 'Meio da tabela'} - Posi√ß√£o ${dadosClube.posicao}`);
            marcarCampoPendente('proximosJogos', 'A definir');
            
            // Calcular campos autom√°ticos
            calcularPPG();
            calcularPercentuais();
            calcularMedias();
            calcularCleanSheets();
            
            console.log(`‚úÖ Dados de ${dadosClube.time} carregados com sucesso!`);
        }

        // Preencher dados de exemplo do Corinthians
        function preencherDadosCorinthians() {
            document.getElementById('posicaoAtual').value = 10;
            document.getElementById('pontosTotal').value = 29;
            document.getElementById('jogosDisputados').value = 24;
            document.getElementById('vitorias').value = 7;
            document.getElementById('empates').value = 8;
            document.getElementById('derrotas').value = 9;
            document.getElementById('golsMarcados').value = 28;
            document.getElementById('golsSofridos').value = 28;
            
            // Marcar campos que precisam ser atualizados com dados reais
            // Dados ofensivos espec√≠ficos do Corinthians (da planilha)
            marcarCampoComoJogos('chutesPorJogo', 10.9);
            marcarCampoComoJogos('posseBola', 53.7);
            marcarCampoComoJogos('passesCertos', 342);
            marcarCampoPendente('tendencia', 'Irregular');
            marcarCampoPendente('elencoTotal', 32);
            marcarCampoPendente('pctProvaveis', 38.5);
            marcarCampoPendente('valorElenco', 110.45);
            marcarCampoComoJogos('ratingMedio', 3.8);
            marcarCampoPendente('desfalques', 'Yuri Alberto (suspenso)');
            marcarCampoPendente('motivacao', 'Luta contra rebaixamento - situa√ß√£o delicada');
            marcarCampoPendente('proximosJogos', 'FLA(f), PAL(c), BOT(f)');
            
            // Calcular campos autom√°ticos
            calcularPPG();
            calcularPercentuais();
            calcularMedias();
            calcularCleanSheets();
        }

        // Preencher dados de exemplo do Flamengo
        function preencherDadosFlamengo() {
            document.getElementById('posicaoAtual').value = 2;
            document.getElementById('pontosTotal').value = 58;
            document.getElementById('jogosDisputados').value = 28;
            document.getElementById('vitorias').value = 17;
            document.getElementById('empates').value = 7;
            document.getElementById('derrotas').value = 4;
            document.getElementById('golsMarcados').value = 52;
            document.getElementById('golsSofridos').value = 32;
            // Dados ofensivos espec√≠ficos do Flamengo (da planilha)
            marcarCampoComoJogos('chutesPorJogo', 14.7);
            marcarCampoComoJogos('posseBola', 59.8);
            marcarCampoComoJogos('passesCertos', 412);
            marcarCampoPendente('tendencia', 'Est√°vel');
            marcarCampoPendente('elencoTotal', 40);
            marcarCampoPendente('pctProvaveis', 42.5);
            marcarCampoPendente('valorElenco', 85.0);
            marcarCampoComoJogos('ratingMedio', 4.6);
            marcarCampoPendente('desfalques', 'Arrascaeta (les√£o), Vi√±a (suspenso)');
            marcarCampoPendente('motivacao', 'Briga pelo t√≠tulo - 6 pts do l√≠der');
            marcarCampoPendente('proximosJogos', 'COR(f), PAL(c), BOT(f)');
            
            // Calcular campos autom√°ticos
            calcularPPG();
            calcularPercentuais();
            calcularMedias();
            calcularCleanSheets();
        }

        // Calcular PPG (Pontos por Jogo)
        function calcularPPG() {
            const pontos = parseFloat(document.getElementById('pontosTotal').value) || 0;
            const jogos = parseFloat(document.getElementById('jogosDisputados').value) || 0;
            
            if (jogos > 0) {
                const ppg = (pontos / jogos).toFixed(2);
                document.getElementById('ppg').value = ppg;
            } else {
                document.getElementById('ppg').value = '';
            }
        }

        // Calcular percentuais
        function calcularPercentuais() {
            const vitorias = parseFloat(document.getElementById('vitorias').value) || 0;
            const empates = parseFloat(document.getElementById('empates').value) || 0;
            const derrotas = parseFloat(document.getElementById('derrotas').value) || 0;
            const total = vitorias + empates + derrotas;
            
            if (total > 0) {
                const pctVitorias = ((vitorias / total) * 100).toFixed(1);
                document.getElementById('percentualVitorias').value = pctVitorias + '%';
            } else {
                document.getElementById('percentualVitorias').value = '';
            }
        }

        // Calcular m√©dias de gols
        function calcularMedias() {
            const jogos = parseFloat(document.getElementById('jogosDisputados').value) || 0;
            const golsMarcados = parseFloat(document.getElementById('golsMarcados').value) || 0;
            const golsSofridos = parseFloat(document.getElementById('golsSofridos').value) || 0;
            
            if (jogos > 0) {
                const mediaGolsMarcados = (golsMarcados / jogos).toFixed(2);
                const mediaGolsSofridos = (golsSofridos / jogos).toFixed(2);
                
                document.getElementById('mediaGols').value = mediaGolsMarcados;
                document.getElementById('mediaSofridos').value = mediaGolsSofridos;
            } else {
                document.getElementById('mediaGols').value = '';
                document.getElementById('mediaSofridos').value = '';
            }
        }

        // Calcular percentual de jogos sem sofrer gols (apenas se n√£o houver dados dos jogos)
        function calcularCleanSheets() {
            const percentualField = document.getElementById('percentualCleanSheets');
            
            // Se j√° tem dados dos jogos (campo verde), n√£o sobrescrever
            if (percentualField.classList.contains('campo-jogos')) {
                return;
            }
            
            const jogos = parseFloat(document.getElementById('jogosDisputados').value) || 0;
            const cleanSheets = parseFloat(document.getElementById('cleanSheets').value) || 0;
            
            console.log('üîß [CALC] Calculando percentual manual:', {
                jogos: jogos,
                cleanSheets: cleanSheets
            });
            
            if (jogos > 0) {
                const pctCleanSheets = ((cleanSheets / jogos) * 100).toFixed(1);
                percentualField.value = pctCleanSheets + '%';
                console.log('‚úÖ [CALC] Percentual calculado:', pctCleanSheets + '%');
            } else {
                percentualField.value = '0.0%';
                console.log('‚ö†Ô∏è [CALC] Sem jogos para calcular percentual');
            }
        }

        // Salvar estat√≠sticas (incluindo campos edit√°veis)
        async function salvarEstatisticas() {
            const clubeSelecionado = document.getElementById('clubeEstatisticas').value;
            
            if (!clubeSelecionado) {
                mostrarErro('Selecione um clube primeiro!');
                return;
            }

            // Coletar dados dos campos edit√°veis
            const dadosEditaveis = {
                clube: clubeSelecionado,
                elencoTotal: document.getElementById('elencoTotal').value,
                pctProvaveis: document.getElementById('pctProvaveis').value,
                valorElenco: document.getElementById('valorElenco').value,
                ratingMedio: document.getElementById('ratingMedio').value,
                chutesPorJogo: document.getElementById('chutesPorJogo').value,
                posseBola: document.getElementById('posseBola').value,
                tendencia: document.getElementById('tendencia').value,
                desfalques: document.getElementById('desfalques').value,
                motivacao: document.getElementById('motivacao').value,
                proximosJogos: document.getElementById('proximosJogos').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/estatisticas-editaveis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        admin_key: localStorage.getItem('admin_key'),
                        dados: dadosEditaveis
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    mostrarSucesso(`Estat√≠sticas do ${clubeSelecionado} salvas com sucesso!`);
                    console.log('üìä Estat√≠sticas salvas para:', clubeSelecionado);
                } else {
                    mostrarErro('Erro ao salvar: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao salvar estat√≠sticas:', error);
                mostrarErro('Erro ao salvar estat√≠sticas');
            }
        }

        // Fun√ß√µes removidas: limparFormulario, previewEstatisticas, verHistorico
        // Mantida apenas a fun√ß√£o salvarEstatisticas por ser √∫til

        // === INTEGRA√á√ÉO COM PLANILHA DE CLUBES ===
        function abrirPlanilhaClubes() {
            // Abrir planilha em nova aba
            const planilhaUrl = './models/EstatisticasElenco/planilha_clubes_futebol.html';
            const planilhaWindow = window.open(planilhaUrl, '_blank', 'width=1400,height=900,scrollbars=yes,resizable=yes');
            
            if (planilhaWindow) {
                console.log('üìä [PLANILHA] Abrindo planilha de clubes...');
                
                // Verificar se h√° dados salvos da planilha
                const dadosPlantel = localStorage.getItem('estatisticasPlantel');
                if (dadosPlantel) {
                    try {
                        const dados = JSON.parse(dadosPlantel);
                        console.log('üìä [PLANILHA] Dados encontrados:', dados);
                        
                        // Mostrar notifica√ß√£o
                        mostrarSucesso(`üìä Planilha aberta! Dados dispon√≠veis: ${dados.celulasProtegidas || 0} campos protegidos`);
                        
                        // Opcional: Preencher campos da Central Admin com dados da planilha
                        preencherDadosPlanilha(dados);
                        
                    } catch (error) {
                        console.error('‚ùå [PLANILHA] Erro ao processar dados:', error);
                    }
                } else {
                    mostrarInfo('üìä Planilha aberta! Edite os dados e salve para sincronizar com a Central Admin.');
                }
            } else {
                mostrarErro('‚ùå N√£o foi poss√≠vel abrir a planilha. Verifique se o pop-up foi bloqueado.');
            }
        }

        // Fun√ß√£o para preencher dados da planilha na Central Admin
        function preencherDadosPlanilha(dados) {
            const clubeSelecionado = document.getElementById('clubeEstatisticas').value;
            
            if (!clubeSelecionado) {
                mostrarInfo('üí° Selecione um clube para sincronizar os dados da planilha.');
                return;
            }
            
            // Procurar dados do clube selecionado na planilha
            let clubeEncontrado = null;
            Object.values(dados.dadosEditados || {}).forEach(tabela => {
                const clube = tabela.find(c => 
                    c.clube.toLowerCase().includes(clubeSelecionado.toLowerCase()) ||
                    clubeSelecionado.toLowerCase().includes(c.clube.toLowerCase())
                );
                if (clube && !clubeEncontrado) {
                    clubeEncontrado = clube;
                }
            });
            
            if (clubeEncontrado) {
                console.log('üìä [SYNC] Sincronizando dados do clube:', clubeEncontrado);
                
                // === SINCRONIZA√á√ÉO AUTOM√ÅTICA - ESTAT√çSTICA PLANTEL ===
                if (clubeEncontrado.plantel) {
                    const field = document.getElementById('elencoTotal');
                    if (field && !field.readOnly) {
                        field.value = clubeEncontrado.plantel;
                        marcarCampoComoJogos('elencoTotal');
                        mostrarCadeadoSePreenchido('elencoTotal');
                    }
                }
                
                if (clubeEncontrado.valorTotal) {
                    const field = document.getElementById('valorElenco');
                    if (field && !field.readOnly) {
                        // Extrair n√∫mero do valor (ex: "‚Ç¨ 195.90 mi." -> 195.90)
                        const valorNumerico = clubeEncontrado.valorTotal
                            .replace(/[‚Ç¨\s]/g, '')
                            .replace('mi.', '')
                            .replace(',', '.');
                        field.value = valorNumerico;
                        marcarCampoComoJogos('valorElenco');
                        mostrarCadeadoSePreenchido('valorElenco');
                    }
                }
                
                if (clubeEncontrado.valorMedio) {
                    const field = document.getElementById('ratingMedio');
                    if (field && !field.readOnly) {
                        // Extrair n√∫mero do valor m√©dio (ex: "‚Ç¨ 6.32 mi." -> 6.32)
                        const valorMedioNumerico = clubeEncontrado.valorMedio
                            .replace(/[‚Ç¨\s]/g, '')
                            .replace('mi.', '')
                            .replace(',', '.');
                        field.value = valorMedioNumerico;
                        marcarCampoComoJogos('ratingMedio');
                        mostrarCadeadoSePreenchido('ratingMedio');
                    }
                }
                
                // === SINCRONIZA√á√ÉO AUTOM√ÅTICA - DADOS OFENSIVOS ===
                if (clubeEncontrado.chutesJogo) {
                    const field = document.getElementById('chutesPorJogo');
                    if (field && !field.readOnly) {
                        field.value = clubeEncontrado.chutesJogo;
                        marcarCampoComoJogos('chutesPorJogo');
                        mostrarCadeadoSePreenchido('chutesPorJogo');
                    }
                }
                
                if (clubeEncontrado.posseBola) {
                    const field = document.getElementById('posseBola');
                    if (field && !field.readOnly) {
                        field.value = clubeEncontrado.posseBola.replace('%', '');
                        marcarCampoComoJogos('posseBola');
                        mostrarCadeadoSePreenchido('posseBola');
                    }
                }
                
                if (clubeEncontrado.passesCertos) {
                    const field = document.getElementById('passesCertos');
                    if (field && !field.readOnly) {
                        field.value = clubeEncontrado.passesCertos;
                        marcarCampoComoJogos('passesCertos');
                        mostrarCadeadoSePreenchido('passesCertos');
                    }
                }
                
                // Mostrar resumo da sincroniza√ß√£o
                const dadosSincronizados = [];
                if (clubeEncontrado.plantel) dadosSincronizados.push(`üìä Plantel: ${clubeEncontrado.plantel}`);
                if (clubeEncontrado.valorTotal) dadosSincronizados.push(`üí∞ Valor: ${clubeEncontrado.valorTotal}`);
                if (clubeEncontrado.chutesJogo) dadosSincronizados.push(`‚öΩ Chutes: ${clubeEncontrado.chutesJogo}/jogo`);
                if (clubeEncontrado.posseBola) dadosSincronizados.push(`üìä Posse: ${clubeEncontrado.posseBola}`);
                if (clubeEncontrado.passesCertos) dadosSincronizados.push(`üîÑ Passes: ${clubeEncontrado.passesCertos}`);
                
                mostrarSucesso(`‚úÖ ${clubeEncontrado.clube} - Dados sincronizados automaticamente!\n\n${dadosSincronizados.join('\n')}\n\nüîí Campos protegidos com cadeados`);
            } else {
                mostrarInfo(`‚ÑπÔ∏è Clube "${clubeSelecionado}" n√£o encontrado na planilha editada.`);
            }
        }

        // Fun√ß√£o para sincronizar dados ofensivos da planilha
        function sincronizarDadosOfensivos() {
            console.log('‚öΩ [SYNC] Bot√£o Dados Ofensivos clicado - Usando sincroniza√ß√£o principal...');
            
            // Verificar se h√° dados da planilha
            const dadosPlantel = localStorage.getItem('estatisticasPlantel');
            if (!dadosPlantel) {
                mostrarInfo('üìä Dados n√£o encontrados!\n\nüí° Para sincronizar:\n1. Abra a planilha (bot√£o "üìä Planilha")\n2. Edite os dados do clube\n3. Salve na planilha\n4. Tente novamente');
                return;
            }
            
            try {
                const dados = JSON.parse(dadosPlantel);
                // Usar a fun√ß√£o principal que j√° faz tudo
                preencherDadosPlanilha(dados);
            } catch (error) {
                console.error('‚ùå [SYNC] Erro ao processar dados:', error);
                mostrarErro('‚ùå Erro ao processar dados da planilha.');
            }
        }

        // Fun√ß√£o para preencher dados autom√°ticos da planilha
        async function preencherDadosAutomaticosPlanilha(clubeSelecionado) {
            console.log(`üìä [AUTO] Preenchendo dados autom√°ticos da planilha para: ${clubeSelecionado}`);
            
            // Primeiro, tentar dados da planilha (localStorage)
            const dadosPlantel = localStorage.getItem('estatisticasPlantel');
            if (dadosPlantel) {
                try {
                    const dados = JSON.parse(dadosPlantel);
                    preencherDadosPlanilha(dados);
                    return; // Se encontrou na planilha, usar esses dados
                } catch (error) {
                    console.error('‚ùå Erro ao processar dados da planilha:', error);
                }
            }
            
            // Se n√£o h√° dados da planilha, usar dados hardcoded por clube
            if (clubeSelecionado.toLowerCase().includes('flamengo')) {
                console.log('üî¥ [AUTO] Preenchendo dados do Flamengo...');
                marcarCampoComoJogos('chutesPorJogo', 5.7);   // DADOS REAIS FOOTMOB 2025
                marcarCampoComoJogos('posseBola', 62.2);       // DADOS REAIS FOOTMOB 2025
                marcarCampoComoJogos('passesCertos', 509);     // DADOS REAIS FOOTMOB 2025
                marcarCampoComoJogos('elencoTotal', 31);
                marcarCampoComoJogos('valorElenco', 195.90);
                marcarCampoComoJogos('ratingMedio', 6.32); // Valor m√©dio por jogador
                
            } else if (clubeSelecionado.toLowerCase().includes('corinthians')) {
                console.log('‚ö´ [AUTO] Preenchendo dados do Corinthians...');
                marcarCampoComoJogos('chutesPorJogo', 3.6);   // DADOS REAIS FOOTMOB 2025
                marcarCampoComoJogos('posseBola', 55.9);       // DADOS REAIS FOOTMOB 2025
                marcarCampoComoJogos('passesCertos', 414);     // DADOS REAIS FOOTMOB 2025
                marcarCampoComoJogos('elencoTotal', 32);
                marcarCampoComoJogos('valorElenco', 110.45);
                marcarCampoComoJogos('ratingMedio', 3.45); // Valor m√©dio por jogador
                
            } else {
                console.log(`‚ÑπÔ∏è [AUTO] Clube ${clubeSelecionado} n√£o possui dados autom√°ticos configurados`);
            }
        }

        // Fun√ß√£o para verificar dados da planilha automaticamente
        function verificarDadosPlanilha() {
            const dados = localStorage.getItem('estatisticasPlantel');
            if (dados) {
                try {
                    const plantelData = JSON.parse(dados);
                    const timestamp = new Date(plantelData.timestamp);
                    const agora = new Date();
                    const diffMinutos = Math.floor((agora - timestamp) / (1000 * 60));
                    
                    if (diffMinutos < 60) { // Dados recentes (menos de 1 hora)
                        console.log(`üìä [PLANILHA] Dados dispon√≠veis (${diffMinutos}min atr√°s):`, plantelData);
                        return plantelData;
                    }
                } catch (error) {
                    console.error('‚ùå [PLANILHA] Erro ao verificar dados:', error);
                }
            }
            return null;
        }

        // === SISTEMA DE AJUDA EDUCATIVO ===
        const helpContent = {
            ppg: {
                title: "PPG - Pontos Por Jogo",
                icon: "üìä",
                definition: "M√©dia de pontos conquistados por partida disputada. √â um dos principais indicadores de desempenho de uma equipe.",
                formula: "PPG = Total de Pontos √∑ Total de Jogos",
                examples: [
                    { value: "2.22", label: "Flamengo atual" },
                    { value: "3.00", label: "Time perfeito" }
                ],
                interpretation: "Escala de Interpreta√ß√£o:",
                scale: [
                    { range: "2.5+", label: "Excelente", class: "excellent" },
                    { range: "2.0-2.4", label: "Muito Bom", class: "good" },
                    { range: "1.5-1.9", label: "M√©dio", class: "average" },
                    { range: "<1.5", label: "Ruim", class: "poor" }
                ]
            },
            cleansheet: {
                title: "Jogos sem sofrer gols - Solidez Defensiva",
                icon: "üõ°Ô∏è",
                definition: "N√∫mero de partidas onde o time n√£o sofreu nenhum gol. Indica a solidez defensiva da equipe.",
                formula: "Jogos sem sofrer gols = Partidas com 0 gols sofridos",
                examples: [
                    { value: "12", label: "Flamengo (exemplo)" },
                    { value: "15", label: "Defesa s√≥lida" }
                ],
            },
            eficiencia_ofensiva: {
                title: "‚öΩ Efici√™ncia Ofensiva (%)",
                icon: "‚öΩ",
                definition: "Percentual que indica a capacidade do time de converter oportunidades em gols. Mostra o qu√£o eficiente √© o time nas finaliza√ß√µes.",
                formula: "Efici√™ncia Ofensiva = (M√©dia de Gols por Jogo √∑ Chutes por Jogo) √ó 100",
                calculation: "C√°lculo Autom√°tico com Cadeado Verde üîí",
                examples: [
                    { value: "36.7%", label: "Flamengo (2.09 gols √∑ 5.7 chutes)" },
                    { value: "15.2%", label: "Excelente finaliza√ß√£o" },
                    { value: "8.5%", label: "Finaliza√ß√£o regular" },
                    { value: "4.2%", label: "Finaliza√ß√£o ruim" }
                ],
                interpretation: "Faixas de Interpreta√ß√£o:",
                ranges: [
                    { range: "Acima de 15%", label: "üî• Excelente", class: "excellent", desc: "Finaliza√ß√£o excepcional" },
                    { range: "10% - 15%", label: "‚úÖ Boa", class: "good", desc: "Boa efici√™ncia ofensiva" },
                    { range: "5% - 10%", label: "‚ö†Ô∏è Regular", class: "average", desc: "Efici√™ncia mediana" },
                    { range: "Abaixo de 5%", label: "‚ùå Ruim", class: "poor", desc: "Precisa melhorar finaliza√ß√£o" }
                ]
            },
            solidez_defensiva: {
                title: "üõ°Ô∏è Solidez Defensiva",
                icon: "üõ°Ô∏è",
                definition: "Classifica√ß√£o qualitativa da defesa baseada na m√©dia de gols sofridos por jogo e percentual de jogos sem sofrer gols (clean sheets).",
                formula: "Baseado em: M√©dia de Gols Sofridos por Jogo + % de Clean Sheets",
                calculation: "C√°lculo Autom√°tico com Cadeado Verde üîí",
                examples: [
                    { value: "Excelente", label: "Flamengo (0.48 gols sofridos + 56.5% clean sheets)" },
                    { value: "Boa", label: "Defesa consistente" },
                    { value: "Regular", label: "Defesa mediana" },
                    { value: "Fraca", label: "Defesa vulner√°vel" }
                ],
                interpretation: "Crit√©rios de Classifica√ß√£o:",
                ranges: [
                    { range: "üî• Excelente", label: "< 0.8 gols/jogo + > 40% clean sheets", class: "excellent", desc: "Defesa excepcional" },
                    { range: "‚úÖ Boa", label: "0.8-1.2 gols/jogo + > 25% clean sheets", class: "good", desc: "Defesa s√≥lida" },
                    { range: "‚ö†Ô∏è Regular", label: "1.2-1.8 gols/jogo + > 15% clean sheets", class: "average", desc: "Defesa mediana" },
                    { range: "‚ùå Fraca", label: "> 1.8 gols/jogo + < 15% clean sheets", class: "poor", desc: "Defesa vulner√°vel" }
                ]
            },
            cleansheet_old: {
                interpretation: "Interpreta√ß√£o por temporada (38 jogos):",
                scale: [
                    { range: "15+", label: "Defesa Excelente", class: "excellent" },
                    { range: "10-14", label: "Defesa Boa", class: "good" },
                    { range: "6-9", label: "Defesa M√©dia", class: "average" },
                    { range: "<6", label: "Defesa Fr√°gil", class: "poor" }
                ]
            },
            ppg_casa: {
                title: "PPG Casa - Pontos Por Jogo em Casa",
                icon: "üè†",
                definition: "M√©dia de pontos conquistados especificamente nos jogos disputados em casa (como mandante). Indica a for√ßa do time no seu pr√≥prio est√°dio.",
                formula: "PPG Casa = Pontos em Casa √∑ Jogos em Casa",
                examples: [
                    { value: "2.31", label: "Flamengo (exemplo)" },
                    { value: "2.50", label: "Forte mandante" }
                ],
                interpretation: "Interpreta√ß√£o do desempenho em casa:",
                scale: [
                    { range: "2.5+", label: "Fortaleza Absoluta", class: "excellent" },
                    { range: "2.0-2.4", label: "Mandante Forte", class: "good" },
                    { range: "1.5-1.9", label: "Mandante M√©dio", class: "average" },
                    { range: "<1.5", label: "Casa Fr√°gil", class: "poor" }
                ]
            },
            ppg_fora: {
                title: "PPG Fora - Pontos Por Jogo Fora de Casa",
                icon: "‚úàÔ∏è",
                definition: "M√©dia de pontos conquistados especificamente nos jogos disputados fora de casa (como visitante). Indica a capacidade do time de pontuar longe de seus dom√≠nios.",
                formula: "PPG Fora = Pontos Fora √∑ Jogos Fora",
                examples: [
                    { value: "1.83", label: "Flamengo (exemplo)" },
                    { value: "2.00", label: "Bom visitante" }
                ],
                interpretation: "Interpreta√ß√£o do desempenho fora:",
                scale: [
                    { range: "2.0+", label: "Visitante Excepcional", class: "excellent" },
                    { range: "1.5-1.9", label: "Visitante Bom", class: "good" },
                    { range: "1.0-1.4", label: "Visitante M√©dio", class: "average" },
                    { range: "<1.0", label: "Visitante Fraco", class: "poor" }
                ]
            }
        };

        function mostrarAjuda(termo) {
            console.log('üîç [DEBUG] mostrarAjuda chamada para:', termo);
            
            // Debug para novos campos
            if (termo === 'eficiencia_ofensiva' || termo === 'solidez_defensiva') {
                console.log('üéØ [DEBUG] Abrindo modal para novo campo:', termo);
            }
            
            const content = helpContent[termo];
            if (!content) {
                console.error('‚ùå [DEBUG] Conte√∫do n√£o encontrado para:', termo);
                alert('‚ùå Conte√∫do n√£o encontrado para: ' + termo);
                return;
            }
            console.log('‚úÖ [DEBUG] Conte√∫do encontrado:', content.title);

            const modal = document.getElementById('helpModal');
            const titleText = document.getElementById('helpModalTitleText');
            const body = document.getElementById('helpModalBody');

            titleText.textContent = content.title;

            body.innerHTML = `
                <div class="help-definition" style="margin-bottom: 20px;">
                    <h3 style="color: #00E38C; margin-bottom: 10px;">${content.icon} ${content.title}</h3>
                    <p style="font-size: 16px; line-height: 1.6;">${content.definition}</p>
                </div>

                <div class="help-formula" style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <h4 style="color: #FFD700; margin-bottom: 8px;">üìä F√≥rmula de C√°lculo:</h4>
                    <code style="font-size: 14px; color: #E0E0E0;">${content.formula}</code>
                </div>

                ${content.calculation ? `
                    <div class="help-calculation" style="margin-bottom: 20px; padding: 12px; background: rgba(0,227,140,0.2); border-radius: 8px; border-left: 4px solid #00E38C;">
                        <h4 style="color: #00E38C; margin-bottom: 5px;">üîí Tipo de Campo:</h4>
                        <p style="color: #00E38C; font-weight: bold; margin: 0;">${content.calculation}</p>
                    </div>
                ` : ''}

                <div class="help-examples" style="margin-bottom: 20px;">
                    <h4 style="color: #FFD700; margin-bottom: 12px;">üí° Exemplos Pr√°ticos:</h4>
                    ${content.examples ? content.examples.map(ex => `
                        <div class="help-example" style="margin: 8px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <div class="help-example-value" style="font-weight: bold; color: #FFD700; font-size: 16px;">${ex.value}</div>
                            <div class="help-example-label" style="color: #E0E0E0; margin-top: 4px;">${ex.label}</div>
                        </div>
                    `).join('') : ''}
                </div>

                <div class="help-interpretation">
                    <h4 style="color: #FFD700; margin-bottom: 12px;">${content.interpretation || 'Interpreta√ß√£o:'}</h4>
                    ${content.ranges ? `
                        <div class="interpretation-ranges">
                            ${content.ranges.map(range => `
                                <div class="range-item ${range.class}" style="margin: 10px 0; padding: 12px; border-left: 4px solid #00E38C; background: rgba(255,255,255,0.08); border-radius: 6px;">
                                    <div style="font-weight: bold; font-size: 16px; color: #FFD700; margin-bottom: 4px;">${range.range}</div>
                                    <div style="margin: 4px 0; color: #E0E0E0;">${range.label}</div>
                                    ${range.desc ? `<div style="font-size: 14px; opacity: 0.8; color: #B0B0B0; margin-top: 6px;">${range.desc}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    ${content.scale ? `
                        <div class="help-scale">
                            ${content.scale.map(item => `
                                <div class="help-scale-item help-scale-${item.class}" style="margin: 8px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                    <strong style="color: #FFD700;">${item.range}</strong><br>
                                    <span style="color: #E0E0E0;">${item.label}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;

            modal.style.display = 'block';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.zIndex = '99999';
            document.body.style.overflow = 'hidden'; // Prevenir scroll
            console.log('‚úÖ [DEBUG] Modal exibido com sucesso para:', termo);
            
            // Teste adicional - for√ßar visibilidade
            setTimeout(() => {
                const modalTest = document.getElementById('helpModal');
                console.log('üîç [DEBUG] Estado do modal ap√≥s 100ms:', {
                    display: modalTest.style.display,
                    visibility: modalTest.style.visibility,
                    opacity: modalTest.style.opacity,
                    zIndex: modalTest.style.zIndex
                });
            }, 100);
        }

        function fecharAjuda() {
            const modal = document.getElementById('helpModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restaurar scroll
        }

        // Fechar modal clicando fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target === modal) {
                fecharAjuda();
            }
        }

        // Fechar modal com ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                fecharAjuda();
            }
        });

        // === DADOS DOS JOGOS DO FLAMENGO ===
        const jogosFlamengo = [
            {data: '2025-03-29', timeCasa: 'Fla', golsCasa: 1, golsVisitante: 1, timeVisitante: 'Int', local: 'Rio de Janeiro - RJ', resultado: 'Empate', pontos: 1},
            {data: '2025-04-06', timeCasa: 'Vit', golsCasa: 1, golsVisitante: 2, timeVisitante: 'Fla', local: 'Salvador - BA', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-04-13', timeCasa: 'Gr√™', golsCasa: 0, golsVisitante: 2, timeVisitante: 'Fla', local: 'Porto Alegre - RS', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-04-16', timeCasa: 'Fla', golsCasa: 6, golsVisitante: 0, timeVisitante: 'Juv', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-04-19', timeCasa: 'Vas', golsCasa: 0, golsVisitante: 0, timeVisitante: 'Fla', local: 'Rio de Janeiro - RJ', resultado: 'Empate', pontos: 1},
            {data: '2025-04-27', timeCasa: 'Fla', golsCasa: 4, golsVisitante: 0, timeVisitante: 'Cor', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-05-04', timeCasa: 'Cru', golsCasa: 2, golsVisitante: 1, timeVisitante: 'Fla', local: 'Belo Horizonte - MG', resultado: 'Derrota', pontos: 0},
            {data: '2025-05-10', timeCasa: 'Fla', golsCasa: 1, golsVisitante: 0, timeVisitante: 'Bah', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-05-18', timeCasa: 'Fla', golsCasa: 0, golsVisitante: 0, timeVisitante: 'Bot', local: 'Rio de Janeiro - RJ', resultado: 'Empate', pontos: 1},
            {data: '2025-05-25', timeCasa: 'Pal', golsCasa: 0, golsVisitante: 2, timeVisitante: 'Fla', local: 'Sao Paulo - SP', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-06-01', timeCasa: 'Fla', golsCasa: 5, golsVisitante: 0, timeVisitante: 'For', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-07-12', timeCasa: 'Fla', golsCasa: 2, golsVisitante: 0, timeVisitante: 'S√£o', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-07-16', timeCasa: 'San', golsCasa: 1, golsVisitante: 0, timeVisitante: 'Fla', local: 'Santos - SP', resultado: 'Derrota', pontos: 0},
            {data: '2025-07-20', timeCasa: 'Fla', golsCasa: 1, golsVisitante: 0, timeVisitante: 'Flu', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-07-23', timeCasa: 'Red', golsCasa: 1, golsVisitante: 2, timeVisitante: 'Fla', local: 'Braganca Paulista - SP', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-07-27', timeCasa: 'Fla', golsCasa: 1, golsVisitante: 0, timeVisitante: 'Atl', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-08-03', timeCasa: 'Cea', golsCasa: 1, golsVisitante: 1, timeVisitante: 'Fla', local: 'Fortaleza - CE', resultado: 'Empate', pontos: 1},
            {data: '2025-08-09', timeCasa: 'Fla', golsCasa: 2, golsVisitante: 1, timeVisitante: 'Mir', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-08-17', timeCasa: 'Int', golsCasa: 1, golsVisitante: 3, timeVisitante: 'Fla', local: 'Rio - Porto Alegre', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-08-25', timeCasa: 'Fla', golsCasa: 8, golsVisitante: 0, timeVisitante: 'Vit', local: 'Rio de Janeiro - RJ', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-08-31', timeCasa: 'Fla', golsCasa: 1, golsVisitante: 1, timeVisitante: 'Gr√™', local: 'Rio de Janeiro - RJ', resultado: 'Empate', pontos: 1},
            {data: '2025-09-14', timeCasa: 'Juv', golsCasa: 0, golsVisitante: 2, timeVisitante: 'Fla', local: 'Caxias do Sul - RS', resultado: 'Vit√≥ria', pontos: 3},
            {data: '2025-09-21', timeCasa: 'Fla', golsCasa: 1, golsVisitante: 1, timeVisitante: 'Vas', local: 'Rio de Janeiro - RJ', resultado: 'Empate', pontos: 1}
        ];

        // === FUN√á√ïES DA TABELA DE JOGOS ===
        async function abrirTabelaJogos() {
            const modal = document.getElementById('jogosModal');
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Obter clube selecionado
            const clubeSelecionado = document.getElementById('clubeEstatisticas').value;
            let clubeArquivo = clubeSelecionado.toLowerCase();
            
            // Mapear nome do clube para o formato usado nos arquivos
            if (clubeArquivo.includes('flamengo')) {
                clubeArquivo = 'flamengo';
            } else if (clubeArquivo.includes('corinthians')) {
                clubeArquivo = 'corinthians';
            }
            
            console.log(`üìä [MODAL] Abrindo tabela de jogos para: ${clubeArquivo}`);
            
            // Carregar jogos da API do clube selecionado
            await carregarJogosDoClube(clubeArquivo);
        }

        function fecharTabelaJogos() {
            const modal = document.getElementById('jogosModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Vari√°vel global para armazenar jogos carregados
        let jogosCarregados = [];
        let clubeAtual = '';

        // Fun√ß√£o auxiliar para preencher campos
        function preencherCampo(campoId, valor) {
            const campo = document.getElementById(campoId);
            if (campo) {
                campo.value = valor;
            } else {
                console.warn(`Campo n√£o encontrado: ${campoId}`);
            }
        }

        async function carregarJogosDoClube(clube) {
            try {
                console.log(`üìä [JOGOS] Carregando jogos de ${clube}...`);
                
                const response = await fetch(`/api/admin/jogos/${clube}`);
                const data = await response.json();
                
                if (data.success) {
                    jogosCarregados = data.data.jogos;
                    clubeAtual = clube;
                    console.log(`‚úÖ [JOGOS] ${jogosCarregados.length} jogos carregados para ${clube}`);
                    
                    // Atualizar t√≠tulo do modal com nome amig√°vel
                    const tituloModal = document.getElementById('jogosModalTitle');
                    if (tituloModal) {
                        // Mapear nomes de clubes para exibi√ß√£o amig√°vel
                        const nomesAmigaveis = {
                            'flamengo': 'üî• Flamengo',
                            'corinthians': '‚ö´ Corinthians', 
                            'palmeiras': 'üü¢ Palmeiras',
                            'sao-paulo': 'üî¥ S√£o Paulo',
                            'santos': '‚ö™ Santos',
                            'gremio': 'üîµ Gr√™mio',
                            'internacional': 'üî¥ Internacional',
                            'atletico-mg': '‚ö´ Atl√©tico-MG',
                            'cruzeiro': 'üîµ Cruzeiro',
                            'botafogo': '‚ö´ Botafogo',
                            'fluminense': 'üü¢ Fluminense',
                            'vasco': '‚ö´ Vasco',
                            'bahia': 'üîµ Bahia',
                            'vitoria': 'üî¥ Vit√≥ria',
                            'fortaleza': 'üî¥ Fortaleza',
                            'ceara': '‚ö´ Cear√°',
                            'sport-recife': 'üî¥ Sport',
                            'juventude': 'üü¢ Juventude',
                            'mirassol': 'üü° Mirassol',
                            'red-bull-bragantino': 'üî¥ Red Bull Bragantino'
                        };
                        
                        const nomeAmigavel = nomesAmigaveis[clube.toLowerCase()] || clube.toUpperCase();
                        tituloModal.textContent = `Hist√≥rico de Jogos - ${nomeAmigavel}`;
                    }
                    
                    carregarJogosNaTabela();
                    atualizarResumoEstatistico();
                } else {
                    console.error('‚ùå [JOGOS] Erro ao carregar jogos:', data.error);
                    alert('Erro ao carregar jogos: ' + data.error);
                }
                
            } catch (error) {
                console.error('‚ùå [JOGOS] Erro na requisi√ß√£o:', error);
                alert('Erro ao conectar com o servidor');
            }
        }

        function carregarJogosNaTabela() {
            const tbody = document.getElementById('jogosTableBody');
            if (!tbody) {
                console.warn('‚ö†Ô∏è [DEBUG] Elemento jogosTableBody n√£o encontrado');
                return;
            }
            tbody.innerHTML = '';
            
            jogosCarregados.forEach((jogo, index) => {
                const row = document.createElement('tr');
                row.style.cssText = 'border-bottom: 1px solid #333; color: white;';
                
                const placar = `${jogo.gols_casa} x ${jogo.gols_visitante}`;
                
                // Converter data para formato v√°lido (aceita DD/MM/YYYY e YYYY-MM-DD)
                let dataFormatada = 'Data inv√°lida';
                if (jogo.data) {
                    try {
                        let dataConvertida;
                        
                        if (jogo.data.includes('/')) {
                            // Formato brasileiro: DD/MM/YYYY
                            const partesData = jogo.data.split('/');
                            if (partesData.length === 3) {
                                dataConvertida = new Date(`${partesData[1]}/${partesData[0]}/${partesData[2]}`);
                            }
                        } else if (jogo.data.includes('-')) {
                            // Formato ISO: YYYY-MM-DD
                            dataConvertida = new Date(jogo.data);
                        }
                        
                        if (dataConvertida && !isNaN(dataConvertida.getTime())) {
                            dataFormatada = dataConvertida.toLocaleDateString('pt-BR');
                        }
                    } catch (e) {
                        console.warn('Erro ao formatar data:', jogo.data, e);
                    }
                }
                
                row.innerHTML = `
                    <td style="padding: 10px; text-align: center;">${dataFormatada}</td>
                    <td style="padding: 10px; text-align: center; font-weight: bold;">${jogo.time_casa}</td>
                    <td style="padding: 10px; text-align: center; font-weight: bold; color: #00E38C;">${placar}</td>
                    <td style="padding: 10px; text-align: center; font-weight: bold;">${jogo.time_visitante}</td>
                    <td style="padding: 10px; text-align: center; font-size: 12px;">${jogo.local}</td>
                    <td style="padding: 10px; text-align: center;">
                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; 
                                     background: ${jogo.resultado === 'Vit√≥ria' ? '#28a745' : jogo.resultado === 'Empate' ? '#ffc107' : '#dc3545'}; 
                                     color: white;">${jogo.resultado}</span>
                    </td>
                    <td style="padding: 10px; text-align: center; font-weight: bold; color: #00E38C;">${jogo.pontos}</td>
                    <td style="padding: 10px; text-align: center;">
                        <button onclick="editarJogo(${index})" style="background: #17a2b8; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-right: 5px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="removerJogo(${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function atualizarResumoEstatistico() {
            const totalJogos = jogosCarregados.length;
            const vitorias = jogosCarregados.filter(j => j.resultado === 'Vit√≥ria').length;
            const empates = jogosCarregados.filter(j => j.resultado === 'Empate').length;
            const derrotas = jogosCarregados.filter(j => j.resultado === 'Derrota').length;
            const totalPontos = jogosCarregados.reduce((sum, j) => sum + j.pontos, 0);
            const ppg = totalJogos > 0 ? (totalPontos / totalJogos).toFixed(2) : '0.00';
            
            document.getElementById('totalJogos').textContent = totalJogos;
            document.getElementById('totalVitorias').textContent = vitorias;
            document.getElementById('totalEmpates').textContent = empates;
            document.getElementById('totalDerrotas').textContent = derrotas;
            document.getElementById('ppgCalculado').textContent = ppg;
        }

        function adicionarNovoJogo() {
            alert('Funcionalidade de adicionar novo jogo ser√° implementada em breve!');
        }

        function editarJogo(index) {
            alert(`Editar jogo ${index + 1} ser√° implementado em breve!`);
        }

        async function removerJogo(index) {
            if (confirm('Tem certeza que deseja remover este jogo?')) {
                try {
                    console.log(`üóëÔ∏è [JOGOS] Removendo jogo ${index} de ${clubeAtual}...`);
                    
                    const response = await fetch(`/api/admin/jogos/${clubeAtual}/${index}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        console.log('‚úÖ [JOGOS] Jogo removido com sucesso');
                        // Recarregar jogos da API
                        await carregarJogosDoClube(clubeAtual);
                    } else {
                        console.error('‚ùå [JOGOS] Erro ao remover jogo:', data.error);
                        alert('Erro ao remover jogo: ' + data.error);
                    }
                    
                } catch (error) {
                    console.error('‚ùå [JOGOS] Erro na requisi√ß√£o:', error);
                    alert('Erro ao conectar com o servidor');
                }
            }
        }

        // === FUN√á√ÉO PARA ATUALIZAR DASHBOARD (uso interno apenas) ===
        async function atualizarDashboard() {
            try {
                console.log('üìä [DASHBOARD] Atualizando estat√≠sticas...');
                
                // Verificar se os elementos existem
                const totalEl = document.getElementById('totalClubes');
                const serieAEl = document.getElementById('serieAClubes');
                const serieBEl = document.getElementById('serieBClubes');
                const ultimaSyncEl = document.getElementById('ultimaSync');
                
                console.log('üîç [DASHBOARD] Elementos encontrados:', {
                    totalClubes: !!totalEl,
                    serieAClubes: !!serieAEl,
                    serieBClubes: !!serieBEl,
                    ultimaSync: !!ultimaSyncEl
                });
                
                const response = await fetch(`${API_BASE}/api/admin/dashboard-stats`);
                const data = await response.json();
                
                console.log('üì° [DASHBOARD] Resposta da API:', data);
                
                if (data.success) {
                    const stats = data.data;
                    
                    // Atualizar n√∫meros
                    if (totalEl) totalEl.textContent = stats.total_clubes || 0;
                    if (serieAEl) serieAEl.textContent = stats.serie_a || 0;
                    if (serieBEl) serieBEl.textContent = stats.serie_b || 0;
                    
                    // Atualizar √∫ltima sincroniza√ß√£o
                    if (ultimaSyncEl) {
                        if (stats.ultima_sincronizacao) {
                            const dataObj = new Date(stats.ultima_sincronizacao);
                            const dataFormatada = dataObj.toLocaleString('pt-BR', {
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            ultimaSyncEl.textContent = dataFormatada;
                        } else {
                            ultimaSyncEl.textContent = 'Nunca';
                        }
                    }
                    
                    console.log('‚úÖ [DASHBOARD] Estat√≠sticas atualizadas:', {
                        total: stats.total_clubes,
                        serieA: stats.serie_a,
                        serieB: stats.serie_b,
                        ultimaSync: stats.ultima_sincronizacao
                    });
                } else {
                    console.error('‚ùå [DASHBOARD] Erro:', data.error);
                }
                
            } catch (error) {
                console.error('‚ùå [DASHBOARD] Erro ao atualizar:', error);
            }
        }

        // === SISTEMA DE CADEADO MANUAL ===
        function toggleLock(fieldId) {
            const field = document.getElementById(fieldId);
            const lockIcon = document.querySelector(`[data-field="${fieldId}"]`);
            
            if (!field || !lockIcon) return;
            
            if (field.readOnly) {
                // Desbloquear campo
                field.readOnly = false;
                field.classList.remove('campo-bloqueado-manual');
                field.classList.add('campo-editavel');
                lockIcon.className = 'fas fa-unlock campo-lock-toggle';
                lockIcon.title = 'Clique para bloquear campo';
                lockIcon.style.color = '#1e40af';
                console.log(`üîì Campo ${fieldId} desbloqueado`);
            } else {
                // Bloquear campo (s√≥ se tiver valor)
                if (field.value && field.value.trim() !== '') {
                    field.readOnly = true;
                    field.classList.remove('campo-editavel', 'campo-pendente');
                    field.classList.add('campo-bloqueado-manual');
                    lockIcon.className = 'fas fa-lock campo-lock-toggle';
                    lockIcon.title = 'Clique para desbloquear campo';
                    lockIcon.style.color = '#1e40af';
                    console.log(`üîí Campo ${fieldId} bloqueado com valor: ${field.value}`);
                } else {
                    alert('‚ö†Ô∏è Preencha o campo antes de bloquear!');
                }
            }
        }

        // Mostrar cadeado quando campo for preenchido
        function mostrarCadeadoSePreenchido(fieldId) {
            const field = document.getElementById(fieldId);
            const lockIcon = document.querySelector(`[data-field="${fieldId}"]`);
            
            if (field && lockIcon) {
                if (field.value && field.value.trim() !== '' && !field.readOnly) {
                    lockIcon.style.display = 'block';
                } else if (!field.value || field.value.trim() === '') {
                    lockIcon.style.display = 'none';
                }
            }
        }

        // Adicionar listeners para mostrar cadeado
        function adicionarListenersCadeado() {
            const camposComCadeado = ['elencoTotal', 'pctProvaveis', 'valorElenco', 'ratingMedio', 'chutesPorJogo', 'posseBola', 'passesCertos'];
            
            camposComCadeado.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    // Remover listeners existentes para evitar duplica√ß√£o
                    field.removeEventListener('input', mostrarCadeadoSePreenchido);
                    field.removeEventListener('blur', mostrarCadeadoSePreenchido);
                    
                    // Adicionar novos listeners
                    field.addEventListener('input', () => mostrarCadeadoSePreenchido(fieldId));
                    field.addEventListener('blur', () => mostrarCadeadoSePreenchido(fieldId));
                    // Verificar no carregamento
                    mostrarCadeadoSePreenchido(fieldId);
                }
            });
        }
        
        // Fun√ß√£o para re-anexar event listeners de uma se√ß√£o espec√≠fica
        function rehookEvents(sectionId) {
            console.log(`üîÑ [LISTENERS] Re-anexando event listeners da se√ß√£o: ${sectionId}`);
            
            const section = $(sectionId);
            if (!section) {
                console.warn(`‚ö†Ô∏è [LISTENERS] Se√ß√£o ${sectionId} n√£o encontrada`);
                return;
            }
            
            // Re-anexar listeners de cadeado para esta se√ß√£o
            adicionarListenersCadeadoSection(sectionId);
            
            // Re-anexar outros listeners conforme necess√°rio
            // (adicionar aqui outros listeners espec√≠ficos da se√ß√£o)
            
            console.log(`‚úÖ [LISTENERS] Event listeners da se√ß√£o ${sectionId} re-anexados com sucesso`);
        }
        
        // Fun√ß√£o para re-anexar todos os event listeners ap√≥s mudan√ßas no DOM
        function reanexarEventListeners() {
            console.log('üîÑ [LISTENERS] Re-anexando event listeners ap√≥s mudan√ßa no DOM...');
            
            // Re-anexar listeners de cadeado
            adicionarListenersCadeado();
            
            // Re-anexar outros listeners conforme necess√°rio
            // (adicionar aqui outros listeners que precisam ser re-anexados)
            
            console.log('‚úÖ [LISTENERS] Event listeners re-anexados com sucesso');
        }
        
        // Fun√ß√£o para adicionar listeners de cadeado em uma se√ß√£o espec√≠fica
        function adicionarListenersCadeadoSection(sectionId) {
            const camposComCadeado = ['elencoTotal', 'pctProvaveis', 'valorElenco', 'ratingMedio', 'chutesPorJogo', 'posseBola', 'passesCertos'];
            
            camposComCadeado.forEach(fieldId => {
                const field = $section(sectionId, fieldId) || $(fieldId);
                if (field) {
                    // Remover listeners existentes para evitar duplica√ß√£o
                    field.removeEventListener('input', mostrarCadeadoSePreenchido);
                    field.removeEventListener('blur', mostrarCadeadoSePreenchido);
                    
                    // Adicionar novos listeners
                    field.addEventListener('input', () => mostrarCadeadoSePreenchido(fieldId));
                    field.addEventListener('blur', () => mostrarCadeadoSePreenchido(fieldId));
                    // Verificar no carregamento
                    mostrarCadeadoSePreenchido(fieldId);
                }
            });
        }

        // === ESTADO GLOBAL ===
        window.ADMIN_STATE = {
            currentSection: null,
            formData: {},
            lastSaved: null,
            isDirty: false
        };
        
        // Fun√ß√µes para gerenciar estado
        const saveState = (sectionId, data) => {
            window.ADMIN_STATE.currentSection = sectionId;
            window.ADMIN_STATE.formData[sectionId] = data;
            window.ADMIN_STATE.lastSaved = new Date().toISOString();
            window.ADMIN_STATE.isDirty = false;
        };
        
        const loadState = (sectionId) => {
            return window.ADMIN_STATE.formData[sectionId] || {};
        };
        
        const syncDOMToState = (sectionId) => {
            const data = {};
            const section = $(sectionId);
            if (section) {
                const inputs = section.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.id) {
                        data[input.id] = input.value;
                    }
                });
            }
            saveState(sectionId, data);
        };
        
        const syncStateToDOM = (sectionId) => {
            const data = loadState(sectionId);
            const section = $(sectionId);
            if (section) {
                Object.entries(data).forEach(([id, value]) => {
                    const element = $(id);
                    if (element && 'value' in element) {
                        element.value = value;
                    }
                });
            }
        };

        // === HELPERS SEGUROS ===
        const $ = (id) => document.getElementById(id);
        const val = (id, fallback = '') => {
            const el = $(id);
            return el && 'value' in el ? el.value : fallback;
        };
        
        // Helper para selecionar elementos dentro de uma se√ß√£o espec√≠fica
        const $section = (sectionId, fieldName) => {
            const section = $(sectionId);
            if (!section) return null;
            return section.querySelector(`[data-field="${fieldName}"]`);
        };
        
        const valSection = (sectionId, fieldName, fallback = '') => {
            const el = $section(sectionId, fieldName);
            return el && 'value' in el ? el.value : fallback;
        };
        
        // === LISTENER DELEGADO PARA SALVAR JOGOS ===
        document.addEventListener('click', function(e) {
            const btn = e.target.closest('[data-action="save-jogo"]');
            if (!btn) return;

            console.log(`üéØ [LISTENER] Bot√£o clicado encontrado:`, btn);
            console.log(`üéØ [LISTENER] Dataset atual:`, btn.dataset);
            
            const idx = Number(btn.dataset.jogo || 1);
            console.log(`üéØ [LISTENER] √çndice extra√≠do: ${idx} (tipo: ${typeof idx})`);
            console.log(`üéØ [LISTENER] Salvando jogo ${idx}`);
            salvarAnaliseRapida(idx);
        });

        // === FUN√á√ÉO PARA ATUALIZAR √çNDICE DO JOGO ===
        function atualizarIndiceJogo(idx) {
            console.log(`üîÑ [√çNDICE] Iniciando atualiza√ß√£o para jogo ${idx}`);
            
            const btn = document.getElementById('btn-salvar-jogo');
            if (btn) {
                console.log(`üîÑ [√çNDICE] Bot√£o encontrado, atualizando dataset.jogo de "${btn.dataset.jogo}" para "${idx}"`);
                btn.dataset.jogo = String(idx);
                
                const rotulo = btn.querySelector('.rotulo-arquivo');
                if (rotulo) {
                    console.log(`üîÑ [√çNDICE] R√≥tulo encontrado, atualizando de "${rotulo.textContent}" para "jogo_${idx}.json"`);
                    rotulo.textContent = `jogo_${idx}.json`;
                } else {
                    console.warn(`‚ö†Ô∏è [√çNDICE] R√≥tulo .rotulo-arquivo n√£o encontrado no bot√£o`);
                }
            } else {
                console.error(`‚ùå [√çNDICE] Bot√£o btn-salvar-jogo n√£o encontrado!`);
            }
            
            const hiddenNome = document.getElementById('nomeArquivo');
            if (hiddenNome) {
                hiddenNome.value = `jogo_${idx}.json`;
                console.log(`üîÑ [√çNDICE] Hidden input atualizado para "jogo_${idx}.json"`);
            } else {
                console.warn(`‚ö†Ô∏è [√çNDICE] Hidden input nomeArquivo n√£o encontrado`);
            }
            
            console.log(`‚úÖ [√çNDICE] Atualiza√ß√£o conclu√≠da para jogo ${idx}`);
        }

        // === FUN√á√ÉO PARA COLETAR DADOS DO FORMUL√ÅRIO ATUAL ===
        function coletarDadosJogoAtual() {
            // Usar getters seguros para evitar erros
            const getValue = (id) => {
                const el = document.getElementById(id);
                return el ? el.value : '';
            };
            
            return {
                numero: getValue('jogo-analise-select'),
                time_casa: getValue('time-casa-admin'),
                time_fora: getValue('time-fora-admin'),
                arena: getValue('arena-admin'),
                campeonato: getValue('campeonato-admin'),
                dia: getValue('dia-admin'),
                escudo_casa: getValue('escudo-casa-path'),
                escudo_fora: getValue('escudo-fora-path'),
                probabilidade_casa: getValue('prob-col1-admin'),
                probabilidade_empate: getValue('prob-colX-admin'),
                probabilidade_fora: getValue('prob-col2-admin'),
                recomendacao: getValue('recomendacao-admin'),
                conclusao_analista: getValue('conclusao-analista-admin'),
                confrontos_sequence: getValue('confrontos-sequence-admin'),
                posicao_casa: getValue('posicao-casa-admin'),
                posicao_fora: getValue('posicao-fora-admin'),
                confronto_direto: getValue('confronto-direto-admin'),
                fator_casa: getValue('fator-casa-admin'),
                fator_fora: getValue('fator-fora-admin'),
                analise_posicao: getValue('analise-posicao-admin'),
                analise_posicao_tabelas: getValue('analise-posicao-tabelas-admin'),
                analise_confronto_direto: getValue('analise-confronto-direto-admin'),
                analise_fator_casa: getValue('analise-fator-casa-admin'),
                sincronizado_em: new Date().toISOString()
            };
        }

        // === NOVA FUN√á√ÉO DE SALVAR (SEM CLOSURE) ===
        async function salvarAnaliseRapida(idx) {
            console.log(`üíæ [SALVAR] Iniciando salvamento do jogo ${idx}`);
            
            try {
                // 1) Coleta de dados do formul√°rio atual
                const payload = coletarDadosJogoAtual();
                
                // 2) Nome de arquivo derivado do √≠ndice
                const nomeArquivo = `jogo_${idx}.json`;
                
                // 3) POST para o backend (estrutura esperada pelo backend)
                const response = await fetch('/api/admin/analise/salvar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        metadados: {
                            jogo_numero: idx.toString(),
                            concurso_numero: '1215'
                        },
                        dados: payload,
                        admin_key: ADMIN_KEY
                    }),
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå [SALVAR] Falha ao salvar:', errorText);
                    alert(`‚ùå Falha ao salvar: ${errorText}`);
                    return;
                }
                
                const result = await response.json();
                console.log(`‚úÖ [SALVAR] Sucesso: ${nomeArquivo}`, result);
                alert(`‚úÖ Salvo com sucesso: ${nomeArquivo}`);
                
            } catch (error) {
                console.error('‚ùå [SALVAR] Erro:', error);
                alert(`‚ùå Erro ao salvar: ${error.message}`);
            }
        }

        // === INICIALIZA√á√ÉO ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîê Central Admin - Loteca Inteligente carregada');
            console.log('üí° Chave padr√£o:', ADMIN_KEY);
            
            // Inicializar sistema de cadeados
            setTimeout(() => {
                adicionarListenersCadeado();
            }, 500);
            
            // Atualizar dashboard na inicializa√ß√£o (com delay para garantir que a p√°gina carregou)
            setTimeout(() => {
                console.log('‚è∞ [DASHBOARD] Iniciando atualiza√ß√£o ap√≥s delay...');
                atualizarDashboard();
            }, 1000);
            
            // Carregar aba Jogos Loteca por padr√£o (com delay para garantir que a p√°gina carregou)
            setTimeout(() => {
                console.log('üéÆ [LOTECA] Iniciando carregamento da aba Jogos Loteca...');
                carregarListaConcursos();
                carregarUltimoConcurso();
                
                // Atualizar dropdown da aba An√°lise R√°pida
                setTimeout(() => {
                    console.log('üîÑ [INIT] Atualizando dropdown da aba An√°lise R√°pida...');
                    atualizarDropdownAnaliseRapida();
                }, 500);
                carregarInformacoesConcursoSalvas();
            }, 1500);
            
            // Configurar listener para mudan√ßa de campeonato na aba Classifica√ß√£o
            const campeonatoSelect = document.getElementById('campeonatoSelect');
            if (campeonatoSelect) {
                campeonatoSelect.addEventListener('change', function() {
                    // Campeonato alterado para: {this.value}
                    carregarClassificacao();
                });
            }
        });

        // === FUN√á√ïES DA LOTECA ===

        // Dados dos jogos atuais (baseados no site)
        let jogosAtuais = [
            { id: 1, coluna1: "CORINTHIANS/SP", coluna2: "FLAMENGO/RJ", data: "Domingo" },
            { id: 2, coluna1: "FORTALEZA/CE", coluna2: "SPORT/PE", data: "S√°bado" },
            { id: 3, coluna1: "JUVENTUDE/RS", coluna2: "INTERNACIONAL/RS", data: "S√°bado" },
            { id: 4, coluna1: "VASCO DA GAMA/RJ", coluna2: "CRUZEIRO/MG", data: "S√°bado" },
            { id: 5, coluna1: "ATHLETICO/PR", coluna2: "OPERARIO/PR", data: "S√°bado" },
            { id: 6, coluna1: "ATLETICO/MG", coluna2: "MIRASSOL/SP", data: "S√°bado" },
            { id: 7, coluna1: "GREMIO/RS", coluna2: "VITORIA/BA", data: "Domingo" },
            { id: 8, coluna1: "ASTON VILLA", coluna2: "FULHAM", data: "Domingo" },
            { id: 9, coluna1: "BAHIA/BA", coluna2: "PALMEIRAS/SP", data: "Domingo" },
            { id: 10, coluna1: "FLUMINENSE/RJ", coluna2: "BOTAFOGO/RJ", data: "Domingo" },
            { id: 11, coluna1: "CRICIUMA/SC", coluna2: "PAYSANDU/PA", data: "Domingo" },
            { id: 12, coluna1: "NEW CASTLE", coluna2: "ARSENAL", data: "Domingo" },
            { id: 13, coluna1: "BRAGANTINO/SP", coluna2: "SANTOS/SP", data: "Domingo" },
            { id: 14, coluna1: "BARCELONA", coluna2: "REAL SOCIEDAD", data: "Domingo" }
        ];

        // Lista de todos os times dispon√≠veis no banco
        let timesDisponiveis = [];

        async function carregarTimesDisponiveis() {
            try {
                console.log('üìä [LOTECA] Carregando times dispon√≠veis...');
                
                const response = await fetch(`${API_BASE}/api/admin/clubes`, {
                    headers: {
                        'Authorization': localStorage.getItem('admin_key') || ADMIN_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    timesDisponiveis = data.clubes || [];
                    console.log(`‚úÖ [LOTECA] ${timesDisponiveis.length} times carregados`);
                } else {
                    console.error('‚ùå [LOTECA] Erro ao carregar times');
                    // Times de fallback
                    timesDisponiveis = [
                        { nome: "CORINTHIANS/SP" }, { nome: "FLAMENGO/RJ" },
                        { nome: "FORTALEZA/CE" }, { nome: "SPORT/PE" },
                        // ... outros times se necess√°rio
                    ];
                }
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao carregar times:', error);
                timesDisponiveis = [];
            }
        }

        function carregarJogosAtuais() {
            console.log('üéÆ [LOTECA] Carregando jogos atuais...');
            console.log('üìã [LOTECA] Jogos dispon√≠veis:', jogosAtuais);
            
            const tbody = document.getElementById('lotecaJogos');
            if (!tbody) {
                console.error('‚ùå [LOTECA] Elemento lotecaJogos n√£o encontrado!');
                return;
            }

            tbody.innerHTML = '';

            jogosAtuais.forEach((jogo, index) => {
                console.log(`üéØ [LOTECA] Processando jogo ${index + 1}:`, jogo);
                
                const tr = document.createElement('tr');
                tr.style.border = '1px solid #0066cc';
                
                // Usar estrutura correta (time_casa/time_fora ou coluna1/coluna2)
                const timeCasa = jogo.time_casa || jogo.coluna1 || '';
                const timeFora = jogo.time_fora || jogo.coluna2 || '';
                const numeroJogo = jogo.numero || jogo.id || 1;
                
                console.log(`‚öΩ [LOTECA] Jogo ${numeroJogo}: ${timeCasa} vs ${timeFora}`);
                
                tr.innerHTML = `
                    <td style="padding: 8px; text-align: center; border: 1px solid #0066cc; font-weight: bold;">
                        ${numeroJogo}
                    </td>
                    <td style="padding: 8px; border: 1px solid #0066cc;">
                        <input type="text" class="loteca-input" id="coluna1_${numeroJogo}" 
                               value="${timeCasa}" 
                               onchange="atualizarJogo(${numeroJogo}, 'coluna1', this.value)"
                               style="width: 100%; border: 1px solid #ddd; padding: 5px; border-radius: 3px;">
                    </td>
                    <td style="padding: 8px; text-align: center; border: 1px solid #0066cc; font-weight: bold; color: #0066cc;">
                        x
                    </td>
                    <td style="padding: 8px; border: 1px solid #0066cc;">
                        <input type="text" class="loteca-input" id="coluna2_${numeroJogo}" 
                               value="${timeFora}" 
                               onchange="atualizarJogo(${numeroJogo}, 'coluna2', this.value)"
                               style="width: 100%; border: 1px solid #ddd; padding: 5px; border-radius: 3px;">
                    </td>
                    <td style="padding: 8px; border: 1px solid #0066cc;">
                        <select class="loteca-select" id="data_${numeroJogo}" 
                                onchange="atualizarJogo(${numeroJogo}, 'data', this.value)"
                                style="width: 100%; border: 1px solid #ddd; padding: 5px; border-radius: 3px;">
                            <option value="S√°bado" ${jogo.data === 'S√°bado' ? 'selected' : ''}>S√°bado</option>
                            <option value="Domingo" ${jogo.data === 'Domingo' ? 'selected' : ''}>Domingo</option>
                            <option value="Segunda" ${jogo.data === 'Segunda' ? 'selected' : ''}>Segunda</option>
                            <option value="Ter√ßa" ${jogo.data === 'Ter√ßa' ? 'selected' : ''}>Ter√ßa</option>
                            <option value="Quarta" ${jogo.data === 'Quarta' ? 'selected' : ''}>Quarta</option>
                            <option value="Quinta" ${jogo.data === 'Quinta' ? 'selected' : ''}>Quinta</option>
                            <option value="Sexta" ${jogo.data === 'Sexta' ? 'selected' : ''}>Sexta</option>
                        </select>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });

            console.log('‚úÖ [LOTECA] 14 jogos carregados na tabela');
            
            // ATUALIZAR DROPDOWN DA ABA "PLANILHA AN√ÅLISE R√ÅPIDA"
            atualizarDropdownAnaliseRapida();
        }

        // Nova fun√ß√£o para carregar concurso espec√≠fico
        // FUN√á√ÉO PARA ABRIR SELETOR DE ARQUIVO CSV
        function abrirSeletorCSV() {
            // Mostrar mensagem para o usu√°rio navegar at√© a pasta correta
            mostrarNotificacao('üìÅ Navegue at√©: backend/Concursos_CEF/', 'info');
            
            // Criar um novo input file
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.style.display = 'none';
            
            // Adicionar evento para processar o arquivo selecionado
            input.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const fileName = this.files[0].name;
                    const filePath = this.files[0].webkitRelativePath || 'Arquivo selecionado';
                    
                    console.log('üìÅ [CSV] Arquivo selecionado:', fileName);
                    console.log('üìÅ [CSV] Caminho completo:', filePath);
                    
                    // Verificar se o arquivo est√° na pasta correta
                    if (filePath.includes('Concursos_CEF') || filePath.includes('concurso_loteca')) {
                        console.log('‚úÖ [CSV] Arquivo est√° na pasta correta!');
                        
                        // Processar o arquivo
                        const file = this.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const csvContent = e.target.result;
                                processarCSVLoteca(csvContent, fileName);
                            } catch (error) {
                                console.error('‚ùå [CSV] Erro ao processar arquivo:', error);
                                mostrarNotificacao('‚ùå Erro ao processar arquivo CSV!', 'error');
                            }
                        };
                        reader.readAsText(file, 'UTF-8');
                    } else {
                        console.log('‚ö†Ô∏è [CSV] Arquivo pode n√£o estar na pasta correta');
                        mostrarNotificacao('‚ö†Ô∏è Certifique-se de que o arquivo est√° em backend/Concursos_CEF/', 'warning');
                        
                        // Processar mesmo assim
                        const file = this.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const csvContent = e.target.result;
                                processarCSVLoteca(csvContent, fileName);
                            } catch (error) {
                                console.error('‚ùå [CSV] Erro ao processar arquivo:', error);
                                mostrarNotificacao('‚ùå Erro ao processar arquivo CSV!', 'error');
                            }
                        };
                        reader.readAsText(file, 'UTF-8');
                    }
                }
            });
            
            // Adicionar ao DOM temporariamente e clicar
            document.body.appendChild(input);
            input.click();
            
            // Remover do DOM ap√≥s o clique
            setTimeout(() => {
                if (document.body.contains(input)) {
                    document.body.removeChild(input);
                }
            }, 100);
        }
        
        // FUN√á√ÉO PARA ATUALIZAR DROPDOWN DA ABA "PLANILHA AN√ÅLISE R√ÅPIDA"
        function atualizarDropdownAnaliseRapida() {
            try {
                console.log('üîÑ [DROPDOWN] Atualizando dropdown da aba An√°lise R√°pida...');
                
                const dropdown = document.getElementById('jogo-analise-select');
                if (!dropdown) {
                    console.log('‚ö†Ô∏è [DROPDOWN] Dropdown n√£o encontrado');
                    return;
                }
                
                // PRIORIDADE 1: Usar dados do arquivo JSON salvo (jogosAtuais)
                if (jogosAtuais && jogosAtuais.length > 0) {
                    console.log('üìä [DROPDOWN] Usando dados do arquivo JSON salvo:', jogosAtuais);
                    
                    // Limpar op√ß√µes existentes (exceto a primeira)
                    while (dropdown.children.length > 1) {
                        dropdown.removeChild(dropdown.lastChild);
                    }
                    
                    // Adicionar jogos do arquivo JSON
                    jogosAtuais.forEach(jogo => {
                        const option = document.createElement('option');
                        option.value = jogo.numero || jogo.id;
                        
                        // Formatar nome dos times
                        const timeCasa = jogo.time_casa || jogo.coluna1 || '';
                        const timeFora = jogo.time_fora || jogo.coluna2 || '';
                        
                        option.textContent = `JOGO ${jogo.numero || jogo.id} - ${timeCasa} vs ${timeFora}`;
                        dropdown.appendChild(option);
                        
                        console.log(`‚úÖ [DROPDOWN] Op√ß√£o ${jogo.numero || jogo.id} adicionada: ${option.textContent}`);
                    });
                    
                    console.log(`‚úÖ [DROPDOWN] ${jogosAtuais.length} jogos carregados do arquivo JSON!`);
                    return;
                }
                
                // PRIORIDADE 2: Fallback - usar dados da tabela (m√©todo antigo)
                console.log('üìä [DROPDOWN] Usando dados da tabela (fallback)...');
                
                // Atualizar cada op√ß√£o do dropdown com os dados da tabela
                for (let i = 1; i <= 14; i++) {
                    const timeCasa = document.getElementById(`coluna1_${i}`)?.value || '';
                    const timeFora = document.getElementById(`coluna2_${i}`)?.value || '';
                    
                    const opcao = dropdown.querySelector(`option[value="${i}"]`);
                    if (opcao && timeCasa && timeFora) {
                        opcao.textContent = `JOGO ${i} - ${timeCasa} vs ${timeFora}`;
                        console.log(`‚úÖ [DROPDOWN] Op√ß√£o ${i} atualizada: ${opcao.textContent}`);
                    }
                }
                
                console.log('‚úÖ [DROPDOWN] Dropdown da aba An√°lise R√°pida atualizado!');
                
            } catch (error) {
                console.error('‚ùå [DROPDOWN] Erro ao atualizar dropdown:', error);
            }
        }
        
        // FUN√á√ÉO PARA SINCRONIZAR COM A TABELA DA ABA "JOGOS DA LOTECA"
        function sincronizarComTabelaLoteca(jogoSelecionado) {
            try {
                console.log(`üîÑ [SINCRONIZA√á√ÉO] Sincronizando Jogo ${jogoSelecionado} com tabela da Loteca...`);
                
                // Buscar dados da tabela da aba "Jogos da Loteca"
                const timeCasa = document.getElementById(`coluna1_${jogoSelecionado}`)?.value || '';
                const timeFora = document.getElementById(`coluna2_${jogoSelecionado}`)?.value || '';
                const dataJogo = document.getElementById(`data_${jogoSelecionado}`)?.value || '';
                
                console.log(`üìä [SINCRONIZA√á√ÉO] Dados encontrados: ${timeCasa} vs ${timeFora} (${dataJogo})`);
                
                // SUBSTITUI√á√ÉO AUTOM√ÅTICA COMPLETA DE TODOS OS CAMPOS
                if (timeCasa && timeFora) {
                    console.log(`üîÑ [SUBSTITUI√á√ÉO] Substituindo dados antigos pelos novos: ${timeCasa} vs ${timeFora}`);
                    
                    // 1. CAMPOS B√ÅSICOS - SUBSTITUI√á√ÉO AUTOM√ÅTICA
                    const timeCasaEl = document.getElementById('time-casa-admin');
                    const timeForaEl = document.getElementById('time-fora-admin');
                    
                    if (timeCasaEl) timeCasaEl.value = timeCasa;
                    if (timeForaEl) timeForaEl.value = timeFora;
                    
                    // 2. IDENTIFICAR CLUBES E SUBSTITUIR ESCUDOS AUTOMATICAMENTE
                    const escudos = identificarEscudosClubes(timeCasa, timeFora);
                    if (escudos.casa) {
                        const escudoCasaEl = document.getElementById('escudo-casa-path');
                        if (escudoCasaEl) {
                            escudoCasaEl.value = escudos.casa;
                            console.log(`üõ°Ô∏è [SUBSTITUI√á√ÉO] Escudo casa substitu√≠do: ${escudos.casa}`);
                        }
                    }
                    if (escudos.fora) {
                        const escudoForaEl = document.getElementById('escudo-fora-path');
                        if (escudoForaEl) {
                            escudoForaEl.value = escudos.fora;
                            console.log(`üõ°Ô∏è [SUBSTITUI√á√ÉO] Escudo fora substitu√≠do: ${escudos.fora}`);
                        }
                    }
                    
                    // 3. SUBSTITUIR ARENA E CAMPEONATO AUTOMATICAMENTE
                    const infoJogo = identificarInfoJogo(timeCasa, timeFora, dataJogo);
                    if (infoJogo.arena) {
                        const arenaEl = document.getElementById('arena-admin');
                        if (arenaEl) {
                            arenaEl.value = infoJogo.arena;
                            console.log(`üèüÔ∏è [SUBSTITUI√á√ÉO] Arena substitu√≠da: ${infoJogo.arena}`);
                        }
                    }
                    if (infoJogo.campeonato) {
                        const campeonatoEl = document.getElementById('campeonato-admin');
                        if (campeonatoEl) {
                            campeonatoEl.value = infoJogo.campeonato;
                            console.log(`üèÜ [SUBSTITUI√á√ÉO] Campeonato substitu√≠do: ${infoJogo.campeonato}`);
                        }
                    }
                    if (infoJogo.dia) {
                        const diaEl = document.getElementById('dia-admin');
                        if (diaEl) {
                            diaEl.value = infoJogo.dia;
                            console.log(`üìÖ [SUBSTITUI√á√ÉO] Dia substitu√≠do: ${infoJogo.dia}`);
                        }
                    }
                    
                    // 4. LIMPAR CAMPOS DE AN√ÅLISE PARA NOVA AN√ÅLISE
                    const probCasa = document.getElementById('prob-col1-admin');
                    const probEmpate = document.getElementById('prob-colX-admin');
                    const probFora = document.getElementById('prob-col2-admin');
                    const recomendacao = document.getElementById('recomendacao-admin');
                    const conclusao = document.getElementById('conclusao-analista-admin');
                    
                    if (probCasa) probCasa.value = '';
                    if (probEmpate) probEmpate.value = '';
                    if (probFora) probFora.value = '';
                    if (recomendacao) recomendacao.value = '';
                    if (conclusao) conclusao.value = '';
                    
                    console.log(`‚úÖ [SUBSTITUI√á√ÉO] Todos os campos substitu√≠dos automaticamente!`);
                    console.log(`üîÑ [SUBSTITUI√á√ÉO] Dados antigos removidos, prontos para nova an√°lise!`);
                }
                
                // Atualizar op√ß√£o do dropdown para refletir os times atuais
                const opcaoDropdown = document.querySelector(`#jogo-analise-select option[value="${jogoSelecionado}"]`);
                if (opcaoDropdown && timeCasa && timeFora) {
                    opcaoDropdown.textContent = `JOGO ${jogoSelecionado} - ${timeCasa} vs ${timeFora}`;
                    console.log(`‚úÖ [SINCRONIZA√á√ÉO] Dropdown atualizado: ${opcaoDropdown.textContent}`);
                }
                
                console.log(`‚úÖ [SINCRONIZA√á√ÉO] Jogo ${jogoSelecionado} sincronizado com sucesso!`);
                
            } catch (error) {
                console.error(`‚ùå [SINCRONIZA√á√ÉO] Erro ao sincronizar Jogo ${jogoSelecionado}:`, error);
            }
        }
        
        // FUN√á√ÉO PARA IDENTIFICAR ESCUDOS DOS CLUBES
        function identificarEscudosClubes(timeCasa, timeFora) {
            const escudos = { casa: '', fora: '' };
            
            // Mapeamento de times para escudos
            const mapeamentoEscudos = {
                'PONTE PRETA/SP': '/static/escudos/PON_Ponte_Preta/Ponte_Preta.png',
                'GUARANI/RJ': '/static/escudos/GUA_Guarani/Guarani.png',
                'FORTALEZA/CE': '/static/escudos/FOR_Fortaleza/Fortaleza.png',
                'SPORT/PE': '/static/escudos/SPT_Sport/Sport.png',
                'JUVENTUDE/RS': '/static/escudos/JUV_Juventude/Juventude.png',
                'INTERNACIONAL/RS': '/static/escudos/INT_Internacional/Internacional.png',
                'VASCO DA GAMA/RJ': '/static/escudos/VAS_Vasco/Vasco.png',
                'CRUZEIRO/MG': '/static/escudos/CRU_Cruzeiro/Cruzeiro.png',
                'ATHLETICO/PR': '/static/escudos/ATL_Athletico/Athletico.png',
                'OPERARIO/PR': '/static/escudos/OPE_Operario/Operario.png',
                'ATLETICO/MG': '/static/escudos/ATM_Atletico_MG/Atletico_MG.png',
                'MIRASSOL/SP': '/static/escudos/MIR_Mirassol/Mirassol.png',
                'GREMIO/RS': '/static/escudos/GRE_Gremio/Gremio.png',
                'VITORIA/BA': '/static/escudos/VIT_Vitoria/Vitoria.png',
                'BAHIA/BA': '/static/escudos/BAH_Bahia/Bahia.png',
                'PALMEIRAS/SP': '/static/escudos/PAL_Palmeiras/Palmeiras.png',
                'FLUMINENSE/RJ': '/static/escudos/FLU_Fluminense/Fluminense.png',
                'BOTAFOGO/RJ': '/static/escudos/BOT_Botafogo/Botafogo.png',
                'CRICIUMA/SC': '/static/escudos/CRI_Criciuma/Criciuma.png',
                'PAYSANDU/PA': '/static/escudos/PAY_Paysandu/Paysandu.png',
                'BRAGANTINO/SP': '/static/escudos/BRA_Bragantino/Bragantino.png',
                'SANTOS/SP': '/static/escudos/SAN_Santos/Santos.png',
                'ESTONIA': '/static/escudos/EST_Estonia/Estonia.png',
                'ITALIA': '/static/escudos/ITA_Italia/Italia.png',
                'BULGARIA': '/static/escudos/BUL_Bulgaria/Bulgaria.png',
                'TURQUIA': '/static/escudos/TUR_Turquia/Turquia.png',
                'ESPANHA': '/static/escudos/ESP_Espanha/Espanha.png',
                'GEORGIA': '/static/escudos/GEO_Georgia/Georgia.png',
                'SERVIA/SER': '/static/escudos/SER_Servia/Servia.png',
                'ALBANIA': '/static/escudos/ALB_Albania/Albania.png',
                'PORTUGAL': '/static/escudos/POR_Portugal/Portugal.png',
                'IRLANDA': '/static/escudos/IRL_Irlanda/Irlanda.png',
                'NOVORIZONTINO/SP': '/static/escudos/NOV_Novorizontino/Novorizontino.png',
                'HOLANDA': '/static/escudos/HOL_Holanda/Holanda.png',
                'FINLANDIA': '/static/escudos/FIN_Finlandia/Finlandia.png',
                'AMERICA/MG': '/static/escudos/AME_America_MG/America_MG.png',
                'CUIABA/MT': '/static/escudos/CUI_Cuiaba/Cuiaba.png',
                'CORITIBA/PR': '/static/escudos/COR_Coritiba/Coritiba.png',
                'ROMENIA': '/static/escudos/ROM_Romenia/Romenia.png',
                'AUSTRIA': '/static/escudos/AUT_Austria/Austria.png',
                'DINAMARCA': '/static/escudos/DIN_Dinamarca/Dinamarca.png',
                'GRECIA': '/static/escudos/GRE_Grecia/Grecia.png',
                'LITUANIA': '/static/escudos/LIT_Lituania/Lituania.png',
                'POLONIA': '/static/escudos/POL_Polonia/Polonia.png',
                'ASTON VILLA': '/static/escudos/AVL_Aston_Villa/Aston_Villa.png',
                'FULHAM': '/static/escudos/FUL_Fulham/Fulham.png',
                'NEW CASTLE': '/static/escudos/NEW_Newcastle/Newcastle.png',
                'ARSENAL': '/static/escudos/ARS_Arsenal/Arsenal.png',
                'BARCELONA': '/static/escudos/BAR_Barcelona/Barcelona.png',
                'REAL SOCIEDAD': '/static/escudos/RSO_Real_Sociedad/Real_Sociedad.png'
            };
            
            // Identificar escudos
            escudos.casa = mapeamentoEscudos[timeCasa.toUpperCase()] || '';
            escudos.fora = mapeamentoEscudos[timeFora.toUpperCase()] || '';
            
            console.log(`üõ°Ô∏è [ESCUDOS] ${timeCasa}: ${escudos.casa}`);
            console.log(`üõ°Ô∏è [ESCUDOS] ${timeFora}: ${escudos.fora}`);
            
            return escudos;
        }
        
        // FUN√á√ÉO PARA IDENTIFICAR INFORMA√á√ïES DO JOGO
        function identificarInfoJogo(timeCasa, timeFora, dataJogo) {
            const info = { arena: '', campeonato: '', dia: '' };
            
            // Mapeamento de arenas
            const mapeamentoArenas = {
                'PONTE PRETA/SP': 'Neo Qu√≠mica Arena',
                'GUARANI/RJ': 'Est√°dio do Guarani',
                'FORTALEZA/CE': 'Arena Castel√£o',
                'SPORT/PE': 'Arena Pernambuco',
                'JUVENTUDE/RS': 'Alfredo Jaconi',
                'INTERNACIONAL/RS': 'Beira-Rio',
                'VASCO DA GAMA/RJ': 'S√£o Janu√°rio',
                'CRUZEIRO/MG': 'Mineir√£o',
                'ATHLETICO/PR': 'Arena da Baixada',
                'OPERARIO/PR': 'Est√°dio do Oper√°rio',
                'ATLETICO/MG': 'Arena MRV',
                'MIRASSOL/SP': 'Est√°dio Jos√© Maria de Campos Maia',
                'GREMIO/RS': 'Arena do Gr√™mio',
                'VITORIA/BA': 'Barrad√£o',
                'BAHIA/BA': 'Arena Fonte Nova',
                'PALMEIRAS/SP': 'Allianz Parque',
                'FLUMINENSE/RJ': 'Maracan√£',
                'BOTAFOGO/RJ': 'Nilton Santos',
                'CRICIUMA/SC': 'Heriberto H√ºlse',
                'PAYSANDU/PA': 'Curuzu',
                'BRAGANTINO/SP': 'Nabi Abi Chedid',
                'SANTOS/SP': 'Vila Belmiro',
                'ESTONIA': 'A. Le Coq Arena',
                'ITALIA': 'Est√°dio Ol√≠mpico',
                'BULGARIA': 'Vasil Levski National Stadium',
                'TURQUIA': 'T√ºrk Telekom Stadium',
                'ESPANHA': 'Santiago Bernab√©u',
                'GEORGIA': 'Boris Paichadze Stadium',
                'SERVIA/SER': 'Stadion Rajko Mitiƒá',
                'ALBANIA': 'Arena Komb√´tare',
                'PORTUGAL': 'Est√°dio da Luz',
                'IRLANDA': 'Aviva Stadium',
                'NOVORIZONTINO/SP': 'Est√°dio Dr. Jorge Ismael de Biasi',
                'HOLANDA': 'Johan Cruyff Arena',
                'FINLANDIA': 'Helsinki Olympic Stadium',
                'AMERICA/MG': 'Independ√™ncia',
                'CUIABA/MT': 'Arena Pantanal',
                'CORITIBA/PR': 'Couto Pereira',
                'ROMENIA': 'Arena Na»õionalƒÉ',
                'AUSTRIA': 'Ernst Happel Stadium',
                'DINAMARCA': 'Parken Stadium',
                'GRECIA': 'Olympic Stadium',
                'LITUANIA': 'LFF Stadium',
                'POLONIA': 'National Stadium',
                'ASTON VILLA': 'Villa Park',
                'FULHAM': 'Craven Cottage',
                'NEW CASTLE': 'St. James\' Park',
                'ARSENAL': 'Emirates Stadium',
                'BARCELONA': 'Camp Nou',
                'REAL SOCIEDAD': 'Reale Arena'
            };
            
            // Identificar arena (baseada no time da casa)
            info.arena = mapeamentoArenas[timeCasa.toUpperCase()] || 'Arena n√£o identificada';
            info.campeonato = 'Brasileir√£o S√©rie A';
            info.dia = dataJogo || 'S√°bado';
            
            console.log(`üèüÔ∏è [INFO] Arena: ${info.arena}`);
            console.log(`üèÜ [INFO] Campeonato: ${info.campeonato}`);
            console.log(`üìÖ [INFO] Dia: ${info.dia}`);
            
            return info;
        }
        
        // FUN√á√ÉO PARA SALVAR DADOS AUTOMATICAMENTE
        async function salvarDadosJogosAutomaticamente() {
            try {
                console.log('üíæ [AUTO-SAVE] Salvando dados automaticamente...');
                
                const numeroConcurso = document.getElementById('numeroConcurso').value || '1215';
                const periodoApostas = document.getElementById('periodoApostas').value || '07/10/2025 a 08/10/2025';
                const realizacaoJogos = document.getElementById('realizacaoJogos').value || '27/09/2025 a 28/09/2025';

                // Preparar dados para salvar
                const dadosConcurso = {
                    numero: numeroConcurso,
                    periodo_apostas: periodoApostas,
                    realizacao_jogos: realizacaoJogos,
                    jogos: jogosAtuais,
                    timestamp: new Date().toISOString(),
                    origem: 'CSV_AUTO_SAVE'
                };

                // Salvar no localStorage para reten√ß√£o na p√°gina
                localStorage.setItem('ultimoConcursoCarregado', JSON.stringify(dadosConcurso));
                
                // SALVAR INFORMA√á√ïES DOS 3 CAMPOS DE CIMA
                const infoConcurso = {
                    numero: numeroConcurso,
                    periodoApostas: periodoApostas,
                    realizacaoJogos: realizacaoJogos,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('infoConcursoAtual', JSON.stringify(infoConcurso));
                
                console.log('üíæ [AUTO-SAVE] Dados salvos no localStorage');
                console.log('üíæ [AUTO-SAVE] Informa√ß√µes dos 3 campos salvas:', infoConcurso);

                // Salvar no servidor via API (se dispon√≠vel)
                try {
                    const response = await fetch(`${API_BASE}/api/admin/loteca/concurso`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dadosConcurso)
                    });

                    if (response.ok) {
                        console.log('üíæ [AUTO-SAVE] Dados salvos no servidor');
                        
                        // ATUALIZAR DROPDOWN DA ABA "PLANILHA AN√ÅLISE R√ÅPIDA"
                        console.log('üîÑ [AUTO-SAVE] Atualizando dropdown com novos jogos...');
                        atualizarDropdownAnaliseRapida();
                        
                    } else {
                        console.warn('‚ö†Ô∏è [AUTO-SAVE] Erro ao salvar no servidor, mas dados mantidos no localStorage');
                    }
                } catch (apiError) {
                    console.warn('‚ö†Ô∏è [AUTO-SAVE] API n√£o dispon√≠vel, dados mantidos no localStorage:', apiError);
                }

            } catch (error) {
                console.error('‚ùå [AUTO-SAVE] Erro ao salvar dados:', error);
            }
        }
        
        // FUN√á√ÉO PARA SALVAR DADOS MANUALMENTE (BOT√ÉO)
        async function salvarDadosManualmente() {
            try {
                console.log('üíæ [MANUAL-SAVE] Salvando dados manualmente...');
                console.log('üíæ [MANUAL-SAVE] jogosAtuais:', jogosAtuais);
                console.log('üíæ [MANUAL-SAVE] jogosAtuais.length:', jogosAtuais ? jogosAtuais.length : 'undefined');
                
                // Verificar se h√° jogos para salvar
                if (!jogosAtuais || jogosAtuais.length === 0) {
                    console.log('‚ùå [MANUAL-SAVE] Nenhum jogo carregado!');
                    mostrarNotificacao('‚ùå Nenhum jogo carregado para salvar!', 'error');
                    return;
                }
                
                const numeroConcurso = document.getElementById('numeroConcurso').value || '1215';
                const periodoApostas = document.getElementById('periodoApostas').value || '07/10/2025 a 08/10/2025';
                const realizacaoJogos = document.getElementById('realizacaoJogos').value || '27/09/2025 a 28/09/2025';

                // Preparar dados para salvar
                const dadosConcurso = {
                    numero: numeroConcurso,
                    periodo_apostas: periodoApostas,
                    realizacao_jogos: realizacaoJogos,
                    jogos: jogosAtuais,
                    timestamp: new Date().toISOString(),
                    origem: 'MANUAL_SAVE',
                    total_jogos: jogosAtuais.length
                };

                // 1. SALVAR NO LOCALSTORAGE (GARANTIA IMEDIATA)
                localStorage.setItem('ultimoConcursoCarregado', JSON.stringify(dadosConcurso));
                localStorage.setItem('concursoSalvo_' + numeroConcurso, JSON.stringify(dadosConcurso));
                
                // SALVAR INFORMA√á√ïES DOS 3 CAMPOS DE CIMA
                const infoConcurso = {
                    numero: numeroConcurso,
                    periodoApostas: periodoApostas,
                    realizacaoJogos: realizacaoJogos,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('infoConcursoAtual', JSON.stringify(infoConcurso));
                
                console.log('üíæ [MANUAL-SAVE] Dados salvos no localStorage');
                console.log('üíæ [MANUAL-SAVE] Informa√ß√µes dos 3 campos salvas:', infoConcurso);

                // 2. SALVAR NO SERVIDOR VIA API
                try {
                    console.log('üíæ [MANUAL-SAVE] Enviando para API:', `${API_BASE}/api/admin/loteca/concurso`);
                    console.log('üíæ [MANUAL-SAVE] Dados enviados:', dadosConcurso);
                    
                    const response = await fetch(`${API_BASE}/api/admin/loteca/concurso`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dadosConcurso)
                    });
                    
                    console.log('üíæ [MANUAL-SAVE] Response status:', response.status);
                    console.log('üíæ [MANUAL-SAVE] Response ok:', response.ok);

                    if (response.ok) {
                        const result = await response.json();
                        console.log('üíæ [MANUAL-SAVE] Dados salvos no servidor:', result);
                        mostrarNotificacao(`‚úÖ ${jogosAtuais.length} jogos salvos com sucesso!`, 'success');
                        
                        // ATUALIZAR DROPDOWN DA ABA "PLANILHA AN√ÅLISE R√ÅPIDA"
                        console.log('üîÑ [MANUAL-SAVE] Atualizando dropdown com novos jogos...');
                        atualizarDropdownAnaliseRapida();
                        
                    } else {
                        const error = await response.json();
                        console.error('‚ùå [MANUAL-SAVE] Erro do servidor:', error);
                        mostrarNotificacao('‚ö†Ô∏è Dados salvos localmente, mas erro no servidor!', 'warning');
                    }
                } catch (apiError) {
                    console.warn('‚ö†Ô∏è [MANUAL-SAVE] API n√£o dispon√≠vel:', apiError);
                    mostrarNotificacao('‚ö†Ô∏è Dados salvos apenas localmente!', 'warning');
                }

                // 3. SALVAR BACKUP ADICIONAL
                const backupKey = 'backup_concurso_' + numeroConcurso + '_' + Date.now();
                localStorage.setItem(backupKey, JSON.stringify(dadosConcurso));
                console.log('üíæ [MANUAL-SAVE] Backup criado:', backupKey);

                // 4. CONFIRMAR SALVAMENTO
                console.log('‚úÖ [MANUAL-SAVE] Salvamento conclu√≠do com sucesso!');
                
            } catch (error) {
                console.error('‚ùå [MANUAL-SAVE] Erro ao salvar dados:', error);
                mostrarNotificacao('‚ùå Erro ao salvar dados!', 'error');
            }
        }
        
        // FUN√á√ÉO PARA CARREGAR DADOS SALVOS AO INICIAR A P√ÅGINA
        function carregarDadosSalvos() {
            try {
                console.log('üìÇ [LOAD] Procurando dados salvos...');
                
                // Tentar carregar dados do √∫ltimo concurso
                let dadosSalvos = localStorage.getItem('ultimoConcursoCarregado');
                
                // Se n√£o encontrar, tentar carregar do concurso 1215
                if (!dadosSalvos) {
                    dadosSalvos = localStorage.getItem('concursoSalvo_1215');
                    console.log('üìÇ [LOAD] Tentando carregar concurso 1215...');
                }
                
                if (dadosSalvos) {
                    const dados = JSON.parse(dadosSalvos);
                    console.log('üìÇ [LOAD] Dados encontrados:', dados);
                    
                    // Atualizar campos do formul√°rio
                    if (dados.numero) {
                        document.getElementById('numeroConcurso').value = dados.numero;
                    }
                    if (dados.periodo_apostas) {
                        document.getElementById('periodoApostas').value = dados.periodo_apostas;
                    }
                    if (dados.realizacao_jogos) {
                        document.getElementById('realizacaoJogos').value = dados.realizacao_jogos;
                    }
                    
                    // Atualizar jogos
                    if (dados.jogos && dados.jogos.length > 0) {
                        jogosAtuais = dados.jogos;
                        carregarJogosAtuais();
                        console.log(`‚úÖ [LOAD] ${dados.jogos.length} jogos carregados do localStorage`);
                        
                        // Mostrar notifica√ß√£o de dados carregados
                        mostrarNotificacao(`üìÇ ${dados.jogos.length} jogos carregados automaticamente!`, 'info');
                    }
                    
                    // Atualizar display
                    atualizarDisplayConcurso();
                    
                    console.log('‚úÖ [LOAD] Dados salvos carregados com sucesso!');
                } else {
                    console.log('üìÇ [LOAD] Nenhum dado salvo encontrado');
                }
            } catch (error) {
                console.error('‚ùå [LOAD] Erro ao carregar dados salvos:', error);
            }
        }
        
        function processarCSVLoteca(csvContent, nomeArquivo) {
            try {
                console.log('üîÑ [CSV] Processando conte√∫do CSV...');
                
                const linhas = csvContent.split('\n').filter(linha => linha.trim());
                console.log(`üìä [CSV] ${linhas.length} linhas encontradas`);
                
                // Limpar jogos atuais
                jogosAtuais = [];
                
                // Processar cada linha (pular cabe√ßalho se existir)
                let inicioLinhas = 0;
                if (linhas[0] && (linhas[0].toLowerCase().includes('jogo') || linhas[0].toLowerCase().includes('coluna'))) {
                    inicioLinhas = 1; // Pular cabe√ßalho
                    console.log('üìã [CSV] Cabe√ßalho detectado, pulando primeira linha');
                }
                
                console.log(`üìã [CSV] Processando ${linhas.length - inicioLinhas} linhas de dados`);
                
                for (let i = inicioLinhas; i < linhas.length && i < inicioLinhas + 14; i++) {
                    const linha = linhas[i].trim();
                    if (!linha) continue;
                    
                    console.log(`üìù [CSV] Linha ${i + 1}: "${linha}"`);
                    
                    // Dividir por v√≠rgula ou ponto e v√≠rgula
                    const colunas = linha.split(/[,;]/).map(col => col.trim().replace(/"/g, ''));
                    
                    console.log(`üìä [CSV] Colunas encontradas: ${colunas.length} - [${colunas.join('] [')}]`);
                    
                    if (colunas.length >= 4) {
                        const numeroJogo = i - inicioLinhas + 1;
                        
                        // CORRIGIDO: Formato real do CSV da CEF (4 colunas)
                        // colunas[0] = N√∫mero do jogo (1, 2, 3...)
                        // colunas[1] = Time Casa (PONTE PRETA/SP, PALMEIRAS/SP...)
                        // colunas[2] = Time Fora (GUARANI/SP, JUVENTUDE/RS...)
                        // colunas[3] = Data (S√°bado, Domingo)
                        const timeCasa = colunas[1] || '';
                        const timeFora = colunas[2] || '';
                        const dataJogo = colunas[3] || 'S√°bado'; // Ler data real do CSV
                        
                        if (timeCasa && timeFora) {
                            jogosAtuais.push({
                                numero: numeroJogo,
                                time_casa: timeCasa.toUpperCase(),
                                time_fora: timeFora.toUpperCase(),
                                data: dataJogo
                            });
                            
                            console.log(`‚úÖ [CSV] Jogo ${numeroJogo}: ${timeCasa} vs ${timeFora} (${dataJogo})`);
                            console.log(`üìä [CSV] Colunas lidas: [1]="${colunas[1]}" [2]="${colunas[2]}" [3]="${colunas[3]}"`);
                        }
                    }
                }
                
                // Atualizar a tabela na p√°gina
                carregarJogosAtuais();
                
                // Atualizar n√∫mero do concurso se estiver no nome do arquivo
                if (nomeArquivo) {
                    const matchConcurso = nomeArquivo.match(/concurso[_-]?(\d+)/i);
                    if (matchConcurso) {
                        document.getElementById('numeroConcurso').value = matchConcurso[1];
                        console.log(`üéØ [CSV] N√∫mero do concurso atualizado para: ${matchConcurso[1]}`);
                    }
                }
                
                // SALVAR AUTOMATICAMENTE OS DADOS
                salvarDadosJogosAutomaticamente();
                
                mostrarNotificacao(`‚úÖ ${jogosAtuais.length} jogos carregados e salvos automaticamente!`, 'success');
                
            } catch (error) {
                console.error('‚ùå [CSV] Erro ao processar CSV:', error);
                mostrarNotificacao('‚ùå Erro ao processar arquivo CSV!', 'error');
            }
        }

        // FUN√á√ÉO REMOVIDA - n√£o mais necess√°ria
        /* async function carregarConcursoEspecifico() {
            try {
                const numeroConcurso = document.getElementById('numeroConcursoCarregar').value;
                
                if (!numeroConcurso) {
                    mostrarNotificacao('‚ùå Digite o n√∫mero do concurso!', 'error');
                    return;
                }
                
                console.log(`üîç [LOTECA] Carregando concurso ${numeroConcurso}...`);
                
                // Tentar carregar via API primeiro
                try {
                    const response = await fetch(`${API_BASE}/api/admin/loteca/concurso/${numeroConcurso}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        const dados = result.concurso;
                        console.log('üìä [LOTECA] Dados recebidos da API:', dados);
                        
                        // Atualizar campos do formul√°rio
                        document.getElementById('numeroConcurso').value = numeroConcurso;
                        document.getElementById('periodoApostas').value = dados?.concurso?.periodo_apostas || '';
                        document.getElementById('realizacaoJogos').value = dados?.concurso?.realizacao_jogos || '';
                        
                        // Atualizar jogos
                        if (dados?.jogos && dados.jogos.length > 0) {
                            jogosAtuais = dados.jogos;
                            console.log('üéÆ [LOTECA] Jogos carregados:', jogosAtuais);
                            carregarJogosAtuais();
                        } else {
                            console.warn('‚ö†Ô∏è [LOTECA] Nenhum jogo encontrado nos dados');
                        }
                        
                        console.log(`‚úÖ [LOTECA] Concurso ${numeroConcurso} carregado via API`);
                        mostrarNotificacao(`‚úÖ Concurso ${numeroConcurso} carregado com sucesso!`, 'success');
                        return;
                    }
                } catch (apiError) {
                    console.warn(`‚ö†Ô∏è [LOTECA] API falhou para concurso ${numeroConcurso}:`, apiError);
                }
                
                // Fallback: tentar carregar dados hardcoded se for concurso 1215
                if (numeroConcurso === '1215') {
                    console.log('üîÑ [LOTECA] Carregando dados hardcoded do concurso 1215...');
                    
                    const dadosHardcoded = {
                        numero: '1215',
                        periodo_apostas: '07/10/2025 a 08/10/2025',
                        realizacao_jogos: '27/09/2025 a 28/09/2025',
                        jogos: [
                            { numero: 1, time_casa: 'PONTE PRETA/SP', time_fora: 'GUARANI/RJ', data: 'S√°bado' },
                            { numero: 2, time_casa: 'FORTALEZA/CE', time_fora: 'SPORT/PE', data: 'S√°bado' },
                            { numero: 3, time_casa: 'JUVENTUDE/RS', time_fora: 'INTERNACIONAL/RS', data: 'S√°bado' },
                            { numero: 4, time_casa: 'VASCO DA GAMA/RJ', time_fora: 'CRUZEIRO/MG', data: 'S√°bado' },
                            { numero: 5, time_casa: 'ATHLETICO/PR', time_fora: 'OPERARIO/PR', data: 'S√°bado' },
                            { numero: 6, time_casa: 'ATLETICO/MG', time_fora: 'MIRASSOL/SP', data: 'S√°bado' },
                            { numero: 7, time_casa: 'GREMIO/RS', time_fora: 'VITORIA/BA', data: 'Domingo' },
                            { numero: 8, time_casa: 'ASTON VILLA', time_fora: 'FULHAM', data: 'Domingo' },
                            { numero: 9, time_casa: 'BAHIA/BA', time_fora: 'PALMEIRAS/SP', data: 'Domingo' },
                            { numero: 10, time_casa: 'FLUMINENSE/RJ', time_fora: 'BOTAFOGO/RJ', data: 'Domingo' },
                            { numero: 11, time_casa: 'CRICIUMA/SC', time_fora: 'PAYSANDU/PA', data: 'Domingo' },
                            { numero: 12, time_casa: 'NEW CASTLE', time_fora: 'ARSENAL', data: 'Domingo' },
                            { numero: 13, time_casa: 'BRAGANTINO/SP', time_fora: 'SANTOS/SP', data: 'Domingo' },
                            { numero: 14, time_casa: 'BARCELONA', time_fora: 'REAL SOCIEDAD', data: 'Domingo' }
                        ]
                    };
                    
                    // Atualizar campos
                    document.getElementById('numeroConcurso').value = dadosHardcoded.numero;
                    document.getElementById('periodoApostas').value = dadosHardcoded.periodo_apostas;
                    document.getElementById('realizacaoJogos').value = dadosHardcoded.realizacao_jogos;
                    
                    // Atualizar jogos
                    jogosAtuais = dadosHardcoded.jogos;
                    carregarJogosAtuais();
                    
                    console.log(`‚úÖ [LOTECA] Concurso 1215 carregado via dados hardcoded`);
                    mostrarNotificacao(`‚úÖ Concurso 1215 carregado com sucesso!`, 'success');
                } else {
                    mostrarNotificacao(`‚ùå Concurso ${numeroConcurso} n√£o encontrado!`, 'error');
                }
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao carregar concurso:', error);
                mostrarNotificacao('‚ùå Erro ao carregar concurso!', 'error');
            }
        } */


        function atualizarJogo(id, campo, valor) {
            console.log(`üîÑ [LOTECA] Atualizando jogo ${id}, campo ${campo}: ${valor}`);
            
            const jogo = jogosAtuais.find(j => j.id === id);
            if (jogo) {
                jogo[campo] = valor;
                console.log(`‚úÖ [LOTECA] Jogo ${id} atualizado`);
                
                // ATUALIZAR DROPDOWN DA ABA "PLANILHA AN√ÅLISE R√ÅPIDA"
                atualizarDropdownAnaliseRapida();
            }
        }

        // === FUN√á√ÉO PARA CARREGAR INFORMA√á√ïES SALVAS DO CONCURSO ===
        function carregarInformacoesConcursoSalvas() {
            try {
                console.log('üìÇ [LOTECA] Carregando informa√ß√µes salvas do concurso...');
                
                const infoSalva = localStorage.getItem('infoConcursoAtual');
                console.log('üìÇ [LOTECA] Dados salvos encontrados:', infoSalva);
                
                if (infoSalva) {
                    const info = JSON.parse(infoSalva);
                    console.log('üìÇ [LOTECA] Informa√ß√µes parseadas:', info);
                    
                    // Preencher campos
                    const numeroConcurso = document.getElementById('numeroConcurso');
                    const periodoApostas = document.getElementById('periodoApostas');
                    const realizacaoJogos = document.getElementById('realizacaoJogos');
                    
                    console.log('üìÇ [LOTECA] Campos encontrados:', {
                        numeroConcurso: !!numeroConcurso,
                        periodoApostas: !!periodoApostas,
                        realizacaoJogos: !!realizacaoJogos
                    });
                    
                    if (numeroConcurso) {
                        numeroConcurso.value = info.numero || '1213';
                        console.log('üìÇ [LOTECA] Campo n√∫mero preenchido:', numeroConcurso.value);
                    }
                    if (periodoApostas) {
                        periodoApostas.value = info.periodoApostas || '24/09/2025 at√© 15h do dia 27/09/2025';
                        console.log('üìÇ [LOTECA] Campo per√≠odo preenchido:', periodoApostas.value);
                    }
                    if (realizacaoJogos) {
                        realizacaoJogos.value = info.realizacaoJogos || '27/09/2025 a 28/09/2025';
                        console.log('üìÇ [LOTECA] Campo realiza√ß√£o preenchido:', realizacaoJogos.value);
                    }
                    
                    // Atualizar display
                    const displayConcurso = document.getElementById('displayConcurso');
                    const displayPeriodo = document.getElementById('displayPeriodo');
                    const displayRealizacao = document.getElementById('displayRealizacao');
                    
                    if (displayConcurso) displayConcurso.textContent = info.numero || '1213';
                    if (displayPeriodo) displayPeriodo.textContent = info.periodoApostas || '24/09/2025 at√© 15h do dia 27/09/2025';
                    if (displayRealizacao) displayRealizacao.textContent = info.realizacaoJogos || '27/09/2025 a 28/09/2025';
                    
                    console.log('‚úÖ [LOTECA] Informa√ß√µes do concurso carregadas:', info);
                } else {
                    console.log('‚ÑπÔ∏è [LOTECA] Nenhuma informa√ß√£o salva encontrada, usando valores padr√£o');
                }
            } catch (error) {
                console.error('‚ùå [LOTECA] Erro ao carregar informa√ß√µes salvas:', error);
            }
        }

        // === FUN√á√ÉO PARA ATUALIZAR INFORMA√á√ïES DO CONCURSO ===
        async function atualizarInformacoesConcurso() {
            try {
                console.log('üîÑ [LOTECA] Atualizando informa√ß√µes do concurso...');
                
                const numeroConcurso = document.getElementById('numeroConcurso').value;
                const periodoApostas = document.getElementById('periodoApostas').value;
                const realizacaoJogos = document.getElementById('realizacaoJogos').value;

                if (!numeroConcurso) {
                    mostrarNotificacao('‚ùå N√∫mero do concurso √© obrigat√≥rio!', 'error');
                    return;
                }

                if (!periodoApostas) {
                    mostrarNotificacao('‚ùå Per√≠odo de apostas √© obrigat√≥rio!', 'error');
                    return;
                }

                if (!realizacaoJogos) {
                    mostrarNotificacao('‚ùå Realiza√ß√£o dos jogos √© obrigat√≥ria!', 'error');
                    return;
                }

                // Atualizar display do volante
                const displayConcurso = document.getElementById('displayConcurso');
                const displayPeriodo = document.getElementById('displayPeriodo');
                const displayRealizacao = document.getElementById('displayRealizacao');

                if (displayConcurso) {
                    displayConcurso.textContent = numeroConcurso;
                }

                if (displayPeriodo) {
                    displayPeriodo.textContent = periodoApostas;
                }

                if (displayRealizacao) {
                    displayRealizacao.textContent = realizacaoJogos;
                }

                // Salvar no localStorage para persist√™ncia
                const infoConcurso = {
                    numero: numeroConcurso,
                    periodoApostas: periodoApostas,
                    realizacaoJogos: realizacaoJogos,
                    timestamp: new Date().toISOString()
                };

                localStorage.setItem('infoConcursoAtual', JSON.stringify(infoConcurso));

                // Mostrar sucesso
                mostrarNotificacao(`‚úÖ Informa√ß√µes do Concurso ${numeroConcurso} atualizadas com sucesso!`, 'success');

                console.log('‚úÖ [LOTECA] Informa√ß√µes do concurso atualizadas:', infoConcurso);

            } catch (error) {
                console.error('‚ùå [LOTECA] Erro ao atualizar informa√ß√µes:', error);
                mostrarNotificacao('‚ùå Erro ao atualizar informa√ß√µes do concurso!', 'error');
            }
        }

        // FUN√á√ÉO REMOVIDA - n√£o mais necess√°ria
        /* async function salvarJogosLoteca() {
            try {
                console.log('üíæ [LOTECA] Salvando concurso no servidor...');
                
                const numeroConcurso = document.getElementById('numeroConcurso').value;
                const periodoApostas = document.getElementById('periodoApostas').value;
                const realizacaoJogos = document.getElementById('realizacaoJogos').value;

                if (!numeroConcurso) {
                    mostrarNotificacao('‚ùå N√∫mero do concurso √© obrigat√≥rio!', 'error');
                    return;
                }

                // Coletar dados dos jogos da tabela
                const jogos = [];
                for (let i = 1; i <= 14; i++) {
                    const timeCasa = document.querySelector(`input[id="coluna1_${i}"]`)?.value || '';
                    const timeFora = document.querySelector(`input[id="coluna2_${i}"]`)?.value || '';
                    const dataJogo = document.querySelector(`select[id="data_${i}"]`)?.value || '';
                    
                    if (timeCasa && timeFora) {
                        jogos.push({
                            numero: i,
                            time_casa: timeCasa,
                            time_fora: timeFora,
                            data: dataJogo
                        });
                    }
                }

                // Preparar dados para salvar no servidor
                const dadosConcurso = {
                    numero: numeroConcurso,
                        periodo_apostas: periodoApostas,
                    realizacao_jogos: realizacaoJogos,
                    jogos: jogos,
                    timestamp: new Date().toISOString()
                };

                // Salvar no servidor via API
                const response = await fetch(`${API_BASE}/api/admin/loteca/concurso`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosConcurso)
                });

                const result = await response.json();

                if (result.success) {
                    // Salvar tamb√©m no localStorage para sincroniza√ß√£o imediata
                    localStorage.setItem('concursoAtual', JSON.stringify(dadosConcurso));
                    
                    console.log('‚úÖ [LOTECA] Concurso salvo no servidor!', dadosConcurso);
                    mostrarNotificacao(`‚úÖ Concurso ${numeroConcurso} salvo com sucesso no servidor!`, 'success');
                    
                    // Atualizar informa√ß√µes do concurso na interface
                    await atualizarInformacoesConcurso();
                    
                    // Notificar que os dados est√£o prontos para a p√°gina "An√°lise R√°pida"
                    mostrarNotificacao('üéØ Dados salvos no servidor! Acesse a p√°gina "An√°lise R√°pida" para ver as atualiza√ß√µes.', 'success');
                } else {
                    console.error('‚ùå [LOTECA] Erro do servidor:', result.message);
                    mostrarNotificacao(`‚ùå Erro ao salvar no servidor: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao salvar:', error);
                mostrarNotificacao('‚ùå Erro ao salvar concurso!', 'error');
            }
        } */

        // FUN√á√ÉO REMOVIDA - n√£o mais necess√°ria
        /* async function gerarAnalises() {
            try {
                console.log('üéØ [LOTECA] Gerando an√°lises autom√°ticas...');
                
                // Aqui voc√™ pode implementar a gera√ß√£o de an√°lises baseadas nos dados do banco
                mostrarNotificacao('üéØ An√°lises geradas!', 'success');
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao gerar an√°lises:', error);
                mostrarNotificacao('‚ùå Erro ao gerar an√°lises!', 'error');
            }
        } */

        // === FUN√á√ïES PARA GERENCIAMENTO DE CONCURSOS ===

        async function carregarListaConcursos() {
            try {
                console.log('üìã [LOTECA] Carregando lista de concursos...');
                
                const response = await fetch(`${API_BASE}/api/admin/loteca/concursos`);
                const result = await response.json();
                
                const select = document.getElementById('concursoSelect');
                if (select) {
                select.innerHTML = '<option value="">üîÑ Carregando concursos...</option>';
                } else {
                    console.log('‚ö†Ô∏è [LOTECA] Elemento concursoSelect n√£o encontrado (removido da interface)');
                    return;
                }
                
                if (result.success && result.concursos.length > 0) {
                    select.innerHTML = '<option value="">üìã Selecionar concurso...</option>';
                    
                    result.concursos.forEach(concurso => {
                        const option = document.createElement('option');
                        option.value = concurso.numero;
                        option.textContent = `Concurso ${concurso.numero} - ${concurso.data_sorteio} (${concurso.total_jogos} jogos)`;
                        select.appendChild(option);
                    });
                    
                    console.log(`‚úÖ [LOTECA] ${result.concursos.length} concursos carregados`);
                } else {
                    select.innerHTML = '<option value="">üì≠ Nenhum concurso encontrado</option>';
                    console.log('üì≠ [LOTECA] Nenhum concurso encontrado');
                }
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao carregar concursos:', error);
                const select = document.getElementById('concursoSelect');
                if (select) {
                select.innerHTML = '<option value="">‚ùå Erro ao carregar concursos</option>';
                }
            }
        }

        async function carregarConcursoSelecionado() {
            try {
                const numeroConcurso = document.getElementById('concursoSelect').value;
                
                if (!numeroConcurso) {
                    console.log('üì≠ [LOTECA] Nenhum concurso selecionado');
                    return;
                }
                
                console.log(`üìÇ [LOTECA] Carregando concurso ${numeroConcurso}...`);
                
                const response = await fetch(`/api/admin/loteca/concurso/${numeroConcurso}`);
                const result = await response.json();
                
                if (result.success) {
                    const dados = result.concurso;
                    
                    // Atualizar campos do formul√°rio
                    document.getElementById('numeroConcurso').value = dados.concurso.numero || numeroConcurso;
                    document.getElementById('dataSorteio').value = dados.concurso.data_sorteio || '';
                    document.getElementById('periodoApostas').value = dados.concurso.periodo_apostas || '';
                    
                    // Atualizar jogos
                    if (dados.jogos && dados.jogos.length > 0) {
                        jogosAtuais = dados.jogos;
                        carregarJogosAtuais();
                    }
                    
                    // Atualizar display
                    atualizarDisplayConcurso();
                    
                    console.log(`‚úÖ [LOTECA] Concurso ${numeroConcurso} carregado com sucesso`);
                    mostrarNotificacao(`üìÇ Concurso ${numeroConcurso} carregado!`, 'success');
                    
                } else {
                    console.error('‚ùå [LOTECA] Erro ao carregar concurso:', result.message);
                    mostrarNotificacao(`‚ùå Erro ao carregar concurso: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao carregar concurso:', error);
                mostrarNotificacao('‚ùå Erro ao carregar concurso!', 'error');
            }
        }

        async function criarNovoConcurso() {
            try {
                console.log('üÜï [LOTECA] Criando novo concurso...');
                
                // Buscar pr√≥ximo n√∫mero
                const response = await fetch(`${API_BASE}/api/admin/loteca/proximo-numero`);
                const result = await response.json();
                
                if (result.success) {
                    const proximoNumero = result.proximo_numero;
                    
                    // Limpar formul√°rio
                    document.getElementById('numeroConcurso').value = proximoNumero;
                    document.getElementById('dataSorteio').value = '';
                    document.getElementById('periodoApostas').value = '';
                    
                    // Limpar jogos
                    jogosAtuais = [];
                    carregarJogosAtuais();
                    
                    // Atualizar dropdown
                    document.getElementById('concursoSelect').value = '';
                    
                    // Atualizar display
                    atualizarDisplayConcurso();
                    
                    console.log(`üÜï [LOTECA] Novo concurso ${proximoNumero} criado`);
                    mostrarNotificacao(`üÜï Novo concurso ${proximoNumero} criado!`, 'success');
                    
                } else {
                    console.error('‚ùå [LOTECA] Erro ao obter pr√≥ximo n√∫mero:', result.message);
                    mostrarNotificacao(`‚ùå Erro ao criar novo concurso: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro ao criar novo concurso:', error);
                mostrarNotificacao('‚ùå Erro ao criar novo concurso!', 'error');
            }
        }

        async function carregarUltimoConcurso() {
            try {
                console.log('üîç [LOTECA] Carregando √∫ltimo concurso...');
                
                // Tentar carregar via API primeiro
                try {
                    const response = await fetch(`${API_BASE}/api/admin/loteca/concurso/1215`);
                const result = await response.json();
                
                if (result.success) {
                    const dados = result.concurso;
                        const numeroConcurso = dados?.metadados?.numero || dados?.concurso?.numero || '1215';
                    
                    // Atualizar campos
                    document.getElementById('numeroConcurso').value = numeroConcurso;
                        document.getElementById('periodoApostas').value = dados?.concurso?.periodo_apostas || '07/10/2025 a 08/10/2025';
                        document.getElementById('realizacaoJogos').value = dados?.concurso?.realizacao_jogos || '27/09/2025 a 28/09/2025';
                    
                    // Atualizar jogos
                        if (dados?.jogos && dados.jogos.length > 0) {
                        jogosAtuais = dados.jogos;
                        carregarJogosAtuais();
                    }
                    
                        console.log(`‚úÖ [LOTECA] Concurso ${numeroConcurso} carregado via API`);
                        return;
                    }
                } catch (apiError) {
                    console.warn('‚ö†Ô∏è [LOTECA] API falhou, usando dados hardcoded:', apiError);
                }
                
                // Fallback: usar dados hardcoded do concurso 1215
                console.log('üîÑ [LOTECA] Carregando dados hardcoded do concurso 1215...');
                
                const dadosHardcoded = {
                    numero: '1215',
                    periodo_apostas: '07/10/2025 a 08/10/2025',
                    realizacao_jogos: '27/09/2025 a 28/09/2025',
                    jogos: [
                        { numero: 1, time_casa: 'PONTE PRETA/SP', time_fora: 'GUARANI/RJ', data: 'S√°bado' },
                        { numero: 2, time_casa: 'FORTALEZA/CE', time_fora: 'SPORT/PE', data: 'S√°bado' },
                        { numero: 3, time_casa: 'JUVENTUDE/RS', time_fora: 'INTERNACIONAL/RS', data: 'S√°bado' },
                        { numero: 4, time_casa: 'VASCO DA GAMA/RJ', time_fora: 'CRUZEIRO/MG', data: 'S√°bado' },
                        { numero: 5, time_casa: 'ATHLETICO/PR', time_fora: 'OPERARIO/PR', data: 'S√°bado' },
                        { numero: 6, time_casa: 'ATLETICO/MG', time_fora: 'MIRASSOL/SP', data: 'S√°bado' },
                        { numero: 7, time_casa: 'GREMIO/RS', time_fora: 'VITORIA/BA', data: 'Domingo' },
                        { numero: 8, time_casa: 'ASTON VILLA', time_fora: 'FULHAM', data: 'Domingo' },
                        { numero: 9, time_casa: 'BAHIA/BA', time_fora: 'PALMEIRAS/SP', data: 'Domingo' },
                        { numero: 10, time_casa: 'FLUMINENSE/RJ', time_fora: 'BOTAFOGO/RJ', data: 'Domingo' },
                        { numero: 11, time_casa: 'CRICIUMA/SC', time_fora: 'PAYSANDU/PA', data: 'Domingo' },
                        { numero: 12, time_casa: 'NEW CASTLE', time_fora: 'ARSENAL', data: 'Domingo' },
                        { numero: 13, time_casa: 'BRAGANTINO/SP', time_fora: 'SANTOS/SP', data: 'Domingo' },
                        { numero: 14, time_casa: 'BARCELONA', time_fora: 'REAL SOCIEDAD', data: 'Domingo' }
                    ]
                };
                
                // Atualizar campos
                document.getElementById('numeroConcurso').value = dadosHardcoded.numero;
                document.getElementById('periodoApostas').value = dadosHardcoded.periodo_apostas;
                document.getElementById('realizacaoJogos').value = dadosHardcoded.realizacao_jogos;
                
                
                // Atualizar jogos
                jogosAtuais = dadosHardcoded.jogos;
                carregarJogosAtuais();
                
                console.log(`‚úÖ [LOTECA] Concurso 1215 carregado via dados hardcoded`);
                
            } catch (error) {
                console.error('üí• [LOTECA] Erro geral ao carregar concurso:', error);
                // Usar valores m√≠nimos
                document.getElementById('numeroConcurso').value = '1215';
                document.getElementById('periodoApostas').value = '07/10/2025 a 08/10/2025';
                document.getElementById('realizacaoJogos').value = '27/09/2025 a 28/09/2025';
            }
        }

        // FUN√á√ÉO REMOVIDA - n√£o mais necess√°ria
        
        // FUN√á√ÉO REMOVIDA - n√£o mais necess√°ria
        /* async function atualizarPaginaAnaliseRapida(concurso) {
            try {
                console.log('üîÑ [LOTECA] Atualizando p√°gina An√°lise R√°pida...');
                
                // Extrair dados do concurso (pode estar em diferentes estruturas)
                const dadosConcurso = concurso.concurso || concurso;
                const jogos = concurso.jogos || [];
                
                // Atualizar JOGO 1 se existir
                if (jogos && jogos.length > 0) {
                    const jogo1 = jogos.find(j => j.numero === 1);
                    if (jogo1) {
                        // Atualizar nomes dos times
                        const timeCasaNome = document.getElementById('time-casa-nome');
                        const timeForaNome = document.getElementById('time-fora-nome');
                        
                        if (timeCasaNome) timeCasaNome.textContent = jogo1.time_casa;
                        if (timeForaNome) timeForaNome.textContent = jogo1.time_fora;
                        
                        // Atualizar labels das probabilidades
                        const labelCol1 = document.querySelector('#probabilidades-jogo-1 .col1 .label');
                        const labelCol2 = document.querySelector('#probabilidades-jogo-1 .col2 .label');
                        
                        if (labelCol1) labelCol1.textContent = `Coluna 1 (${jogo1.time_casa})`;
                        if (labelCol2) labelCol2.textContent = `Coluna 2 (${jogo1.time_fora})`;
                        
                        // Atualizar escudos (se existirem)
                        const escudoCasa = document.querySelector('#analise-jogo-1 .team-info:first-child img');
                        const escudoFora = document.querySelector('#analise-jogo-1 .team-info:last-child img');
                        
                        if (escudoCasa) {
                            const nomeEscudoCasa = jogo1.time_casa.toLowerCase().replace(/\s+/g, '-');
                            escudoCasa.src = `/static/escudos/${nomeEscudoCasa}.png`;
                        }
                        
                        if (escudoFora) {
                            const nomeEscudoFora = jogo1.time_fora.toLowerCase().replace(/\s+/g, '-');
                            escudoFora.src = `/static/escudos/${nomeEscudoFora}.png`;
                        }
                        
                        console.log('‚úÖ [LOTECA] JOGO 1 atualizado:', jogo1);
                    }
                }
                
                // Atualizar informa√ß√µes do concurso
                if (dadosConcurso.numero) {
                    const displayConcurso = document.getElementById('displayConcurso');
                    if (displayConcurso) displayConcurso.textContent = dadosConcurso.numero;
                }
                
                if (dadosConcurso.periodo_apostas) {
                    const displayPeriodo = document.getElementById('displayPeriodo');
                    if (displayPeriodo) displayPeriodo.textContent = dadosConcurso.periodo_apostas;
                }
                
                if (dadosConcurso.realizacao_jogos) {
                    const displayRealizacao = document.getElementById('displayRealizacao');
                    if (displayRealizacao) displayRealizacao.textContent = dadosConcurso.realizacao_jogos;
                }
                
                console.log('‚úÖ [LOTECA] P√°gina An√°lise R√°pida atualizada!');
                
            } catch (error) {
                console.error('‚ùå [LOTECA] Erro ao atualizar p√°gina:', error);
                throw error;
            }
        } */

        // Inicializar ao carregar a aba
        function inicializarLoteca() {
            console.log('üéÆ [LOTECA] Inicializando sistema...');
            carregarTimesDisponiveis();
        }

        // === SISTEMA RANKING ESTAT√çSTICAS ===
        let dadosRankingGlobal = [];

        // Fun√ß√£o para carregar ranking completo
        async function carregarRankingCompleto() {
            console.log('üèÜ [RANKING] Carregando dados dos clubes...');
            
            const clubes = [
                'flamengo', 'palmeiras', 'cruzeiro', 'mirassol', 'bahia',
                'botafogo', 'fluminense', 'sao-paulo', 'gremio', 'red-bull-bragantino',
                'atletico-mg', 'ceara', 'corinthians', 'vasco', 'internacional',
                'santos', 'juventude', 'vitoria', 'fortaleza', 'sport-recife'
            ];
            
            const dadosRanking = [];
            
            for (const clube of clubes) {
                try {
                    const response = await fetch(`/api/br/estatisticas/${clube}`);
                    const stats = await response.json();
                    
                    if (stats.success) {
                        const ppgTotal = stats.pontos_total / stats.total_jogos;
                        
                        dadosRanking.push({
                            clube: clube,
                            nome_display: formatarNomeClube(clube),
                            pontos: stats.pontos_total,
                            jogos: stats.total_jogos,
                            ppg_total: ppgTotal,
                            ppg_casa: stats.ppg_casa,
                            ppg_fora: stats.ppg_fora,
                            aproveitamento_casa: stats.aproveitamento_casa,
                            aproveitamento_fora: stats.aproveitamento_fora,
                            vitorias: stats.vitorias || 0,
                            empates: stats.empates || 0,
                            derrotas: stats.derrotas || 0,
                            status: determinarStatusClube(ppgTotal)
                        });
                    }
                } catch (error) {
                    console.error(`‚ùå Erro ao carregar ${clube}:`, error);
                    // Adicionar dados padr√£o em caso de erro
                    dadosRanking.push({
                        clube: clube,
                        nome_display: formatarNomeClube(clube),
                        pontos: 0,
                        jogos: 0,
                        ppg_total: 0,
                        ppg_casa: 0,
                        ppg_fora: 0,
                        aproveitamento_casa: 0,
                        aproveitamento_fora: 0,
                        vitorias: 0,
                        empates: 0,
                        derrotas: 0,
                        status: { codigo: 'ERROR', descricao: 'Erro', cor: '#dc3545', classe: 'relegation-zone' }
                    });
                }
            }
            
            // Ordenar por PPG Total
            dadosRanking.sort((a, b) => b.ppg_total - a.ppg_total);
            
            // Adicionar posi√ß√µes
            dadosRanking.forEach((clube, index) => {
                clube.posicao = index + 1;
            });
            
            dadosRankingGlobal = dadosRanking;
            preencherTabelaRanking(dadosRanking);
            atualizarEstatisticasRanking(dadosRanking);
            
            console.log('‚úÖ [RANKING] Dados carregados com sucesso!', dadosRanking.length, 'clubes');
        }

        // Fun√ß√£o para formatar nome do clube
        function formatarNomeClube(clube) {
            const nomes = {
                'flamengo': 'CR Flamengo',
                'palmeiras': 'SE Palmeiras', 
                'cruzeiro': 'Cruzeiro EC',
                'mirassol': 'Mirassol FC',
                'bahia': 'EC Bahia',
                'botafogo': 'Botafogo FR',
                'fluminense': 'Fluminense FC',
                'sao-paulo': 'S√£o Paulo FC',
                'gremio': 'Gr√™mio FBPA',
                'red-bull-bragantino': 'RB Bragantino',
                'atletico-mg': 'Atl√©tico Mineiro',
                'ceara': 'Cear√° SC',
                'corinthians': 'SC Corinthians',
                'vasco': 'CR Vasco da Gama',
                'internacional': 'SC Internacional',
                'santos': 'Santos FC',
                'juventude': 'EC Juventude',
                'vitoria': 'EC Vit√≥ria',
                'fortaleza': 'Fortaleza EC',
                'sport-recife': 'Sport Recife'
            };
            return nomes[clube] || clube.charAt(0).toUpperCase() + clube.slice(1);
        }

        // Fun√ß√£o para determinar status do clube
        function determinarStatusClube(ppg) {
            if (ppg >= 1.60) {
                return { codigo: 'G5', descricao: 'Libertadores', cor: '#28a745', classe: 'g5-zone' };
            } else if (ppg >= 1.20) {
                return { codigo: 'MEIO', descricao: 'Meio de Tabela', cor: '#ffc107', classe: 'safe-zone' };
            } else if (ppg >= 0.90) {
                return { codigo: 'RISCO', descricao: 'Zona de Risco', cor: '#fd7e14', classe: 'danger-zone' };
            } else {
                return { codigo: 'ZONA', descricao: 'Rebaixamento', cor: '#dc3545', classe: 'relegation-zone' };
            }
        }

        // Fun√ß√£o para preencher tabela de ranking
        function preencherTabelaRanking(dados) {
            const tbody = document.getElementById('rankingBody');
            if (!tbody) {
                console.warn('‚ö†Ô∏è [DEBUG] Elemento rankingBody n√£o encontrado');
                return;
            }
            tbody.innerHTML = '';
            
            dados.forEach((clube, index) => {
                const row = document.createElement('tr');
                row.className = clube.status.classe;
                
                // Determinar √≠cone da posi√ß√£o
                let iconePos = '';
                if (index === 0) iconePos = 'üëë';
                else if (index === 1) iconePos = 'ü•à';
                else if (index === 2) iconePos = 'ü•â';
                else iconePos = `${index + 1}¬∫`;
                
                row.innerHTML = `
                    <td><strong>${iconePos}</strong></td>
                    <td class="clube-nome">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: ${clube.status.cor}; margin-right: 8px;"></div>
                            ${clube.nome_display}
                        </div>
                    </td>
                    <td><strong>${clube.pontos}</strong></td>
                    <td>${clube.jogos}</td>
                    <td class="ppg-destaque">${clube.ppg_total.toFixed(2)}</td>
                    <td>${clube.ppg_casa.toFixed(2)}</td>
                    <td>${clube.ppg_fora.toFixed(2)}</td>
                    <td>${clube.aproveitamento_casa.toFixed(1)}%</td>
                    <td>${clube.aproveitamento_fora.toFixed(1)}%</td>
                    <td>
                        <span class="status-badge status-${clube.status.classe.replace('-zone', '')}" style="background-color: ${clube.status.cor}20; color: ${clube.status.cor};">
                            ${clube.status.codigo}
                        </span>
                    </td>
                    <td>
                        <button class="btn-action btn-view" onclick="verDetalhesClube('${clube.clube}')" title="Ver detalhes">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Fun√ß√£o para atualizar estat√≠sticas do ranking
        function atualizarEstatisticasRanking(dados) {
            document.getElementById('totalClubes').textContent = dados.length;
            document.getElementById('ultimaAtualizacao').textContent = new Date().toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (dados.length > 0) {
                document.getElementById('liderAtual').textContent = dados[0].nome_display.split(' ')[0];
            }
            
            const zonaRebaixamento = dados.filter(clube => clube.status.codigo === 'ZONA').length;
            document.getElementById('zonaRebaixamento').textContent = zonaRebaixamento;
        }

        // Fun√ß√£o para atualizar ranking
        async function atualizarRanking() {
            const btn = event.target;
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
            btn.disabled = true;
            
            try {
                await carregarRankingCompleto();
                mostrarSucesso('‚úÖ Ranking atualizado com sucesso!');
            } catch (error) {
                console.error('‚ùå Erro ao atualizar ranking:', error);
                mostrarErro('‚ùå Erro ao atualizar ranking. Tente novamente.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Fun√ß√£o para ordenar ranking
        function ordenarRanking() {
            const criterio = document.getElementById('ordenarPor').value;
            
            let dadosOrdenados = [...dadosRankingGlobal];
            
            switch (criterio) {
                case 'pontos':
                    dadosOrdenados.sort((a, b) => b.pontos - a.pontos);
                    break;
                case 'ppg_casa':
                    dadosOrdenados.sort((a, b) => b.ppg_casa - a.ppg_casa);
                    break;
                case 'ppg_fora':
                    dadosOrdenados.sort((a, b) => b.ppg_fora - a.ppg_fora);
                    break;
                case 'aproveitamento_casa':
                    dadosOrdenados.sort((a, b) => b.aproveitamento_casa - a.aproveitamento_casa);
                    break;
                case 'aproveitamento_fora':
                    dadosOrdenados.sort((a, b) => b.aproveitamento_fora - a.aproveitamento_fora);
                    break;
                default: // ppg_total
                    dadosOrdenados.sort((a, b) => b.ppg_total - a.ppg_total);
            }
            
            // Reajustar posi√ß√µes
            dadosOrdenados.forEach((clube, index) => {
                clube.posicao = index + 1;
            });
            
            preencherTabelaRanking(dadosOrdenados);
        }

        // Fun√ß√£o para ver detalhes do clube
        function verDetalhesClube(clube) {
            // Mudar para aba clubes e selecionar o clube
            showTab('clubes');
            
            // Selecionar o clube no dropdown
            const selectClube = document.getElementById('clubeEstatisticas');
            if (selectClube) {
                selectClube.value = clube;
                carregarEstatisticasClube(); // Fun√ß√£o j√° existente
            }
            
            mostrarInfo(`üìä Visualizando detalhes de ${formatarNomeClube(clube)}`);
        }

        // Fun√ß√£o para exportar para Loteca X-Ray
        function exportarParaLoteca() {
            try {
                const dadosExport = {
                    ranking: dadosRankingGlobal,
                    timestamp: new Date().toISOString(),
                    total_clubes: dadosRankingGlobal.length,
                    lider: dadosRankingGlobal[0]?.nome_display || 'N/A',
                    zona_rebaixamento: dadosRankingGlobal.filter(c => c.status.codigo === 'ZONA').length
                };
                
                // Salvar no localStorage para uso no Loteca X-Ray
                localStorage.setItem('loteca_ranking_export', JSON.stringify(dadosExport));
                
                // Criar arquivo para download
                const blob = new Blob([JSON.stringify(dadosExport, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ranking_loteca_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                mostrarSucesso('üì§ Dados exportados com sucesso para o Loteca X-Ray!');
            } catch (error) {
                console.error('‚ùå Erro ao exportar:', error);
                mostrarErro('‚ùå Erro ao exportar dados. Tente novamente.');
            }
        }

        // Modificar fun√ß√£o showTab para carregar ranking quando necess√°rio
        const originalShowTab = showTab;
        showTab = function(tabName) {
            originalShowTab(tabName);
            
            // Carregar dados do ranking quando a aba for aberta
            if (tabName === 'ranking-estatisticas' && dadosRankingGlobal.length === 0) {
                setTimeout(() => {
                    carregarRankingCompleto();
                }, 100);
            }
        };

    </script>
</body>
</html>

